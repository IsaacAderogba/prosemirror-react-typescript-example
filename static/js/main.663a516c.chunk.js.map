{"version":3,"sources":["components/NavBar.tsx","components/WrappedRoute.tsx","../../full/dist/index.es.js","components/PageHeader.tsx","pages/FrontPage.tsx","../../minimal/dist/index.es.js","pages/MinimalPage.tsx","../../atlassian/dist/index.es.js","pages/AtlassianPage.tsx","routes.tsx","index.tsx"],"names":["NavBar","props","className","Container","Nav","Link","to","exact","activeClassName","styled","div","nav","NavLink","WrappedRoute","Component","component","rest","render","MainWrapper","MainContainer","main","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","__","this","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__makeTemplateObject","cooked","raw","defineProperty","value","hasRequiredPerformanceAPIs","EditorViewProvider","init","view","_editorView","get","Error","enumerable","configurable","getMarks","editorView","state","schema","marks","getNodes","nodes","execCommand","cmd","dispatch","focus","hasFocus","tr","scrollIntoView","blur","dom","stateToJSON","toJSON","plugins","replaceState","rawValue","EditorState","fromJSON","updateState","replaceDocument","shouldScrollToBottom","shouldAddToHistory","undefined","content","parsedNode","JSON","parse","err","console","error","type","isArray","push","version","parsedDoc","Node","check","message","stringify","parseRawValue","replaceWith","doc","nodeSize","selectionSet","setSelection","Selection","atStart","setMeta","EventDispatcher","listeners","on","event","cb","Set","add","off","has","delete","emit","data","forEach","destroy","PluginsProvider","dispatcher","publish","pluginKey","nextPluginState","name","subscribe","unsubscribe","PortalProvider","mounted","Map","pendingUpdates","container","set","update","remove","flush","_this","from","entries","map","_a","operation","values","unmountComponentAtNode","size","isPerformanceAPIAvailable","window","every","api","performance","LOG_LEVEL","measureMap","stopMeasure","measureName","onMeasureComplete","mark","start","measure","entry","getEntriesByName","pop","duration","startTime","now","clearMarks","clearMeasures","clearMeasure","AnalyticsProvider","shouldTrack","logToConsole","logLevel","logs","perf","debug","namespace","method","hasLevel","info","warn","stop","durationThreshold","level","lvl","startLog","pending","endLog","msg","getName","Math","round","EditorContext","createContext","portalProvider","viewProvider","pluginsProvider","analyticsProvider","useEditorContext","useContext","blockquote","group","defining","selectable","attrs","class","default","parseDOM","tag","toDOM","pmBlockquote","node","paragraph","text","toDebugString","em","inclusive","style","strong","getAttrs","fontWeight","test","splitBlock","selection","$from","$to","NodeSelection","isBlock","parentOffset","canSplit","pos","split","parent","atEnd","TextSelection","deleteSelection","deflt","depth","contentMatchAt","indexAfter","defaultType","types","can","mapping","isStuff","canReplace","index","Fragment","setNodeMarkup","before","createNewPmBlockQuote","empty","createAndFill","endOfBlock","end","insert","PluginKey","_super","PluginKey$1","basePluginKey","basePluginFactory","options","Plugin","_","activeNodes","activeMarks","pluginState","_oldState","newState","docChanged","storedMarks","$head","$anchor","activeMarks_1","getActiveMarks","m","includes","key","basePlugin","pmPlugins","plugin","history","keymap","baseKeymap","templateObject_1","ReactNodeView","getPos","reactComponentProps","reactComponent","handleRef","contentDOM","contains","appendChild","createContainerDOM","classList","createContentDOM","useListenProps","useEffect","renderReactComponent","createProps","componentProps","isInline","document","createElement","initialProps","forwardRef","React","ref","_decorations","setDomAttrs","element","keys","attr","setAttribute","ignoreMutation","mutation","target","fromComponent","BlockQuote","newProps","useState","StyledBlockQuote","BlockQuoteView","blockQuoteNodeView","blockquotePluginKey","blockQuotePluginFactory","blockQuoteActive","findSelectedNodeOfType","findParentNodeOfType","findBlockQuote","nodeViews","result","mac","ie","ie_version","gecko","chrome","chrome_version","android","ios","webkit","navigator","ieEdge","exec","userAgent","ieUpTo10","ie11up","platform","documentMode","parseInt","match","documentElement","makeKeyMapWithCommon","toggleBlockQuote","description","common","windows","makeKeymap","replace","blockQuotePlugin","keymapObj","shortcut","oldCmd","newCmd","bindKeymapWithCommand","keymapPlugin","pluginsOptions","Preset","some","pluginPreset","getEditorPlugins","excludes","editorPlugins","processEditorPlugins","removeExcludedPlugins","cache","pluginEntry","fn","filter","ranks","sortByOrder","item","a","indexOf","createPMPlugins","config","editorConfig","e","getOwnPropertySymbols","propertyIsEnumerable","__rest","sort","createSchema","createdMarks","markKeys","markGroups","markKey","join","fixExcludes","reduce","acc","createdNodes","Schema","SelectedState","validNode","getBlockNode","blockNode","getBlockNodeContent","blockNodeContent","prevNode_1","getInlineNodes","inlineNodes","inlineNode","useSsrLayoutEffect","useLayoutEffect","ReactEditorView","editorProps","EditorLayoutComponent","editorViewRef","useRef","_b","canDispatchTransactions","pluginName","_c","processPluginsList","prevProps","preset","createDefaultEditorPlugins","createEditorState","editorViewDOM","current","EditorView","mount","applyDevTools","createEditorView","dispatchTransaction","transaction","steps","step","slice","_loop_1","topLevelNode_1","resolve","find","findChangedNodesFromTransaction","validateNodes","oldEditorState","editorState","onDocumentEdit","invalidNodes","getDocStructure","log","editable","_state","disabled","attributes","createDirectEditorProps","onEditorReady","templateObject_1$1","templateObject_2","templateObject_3","SvgWrapper","span","Button","button","active","MarkButton","icon","onClick","Toolbar","currentMarks","setCurrentMarks","onBasePluginChange","newPluginState","TopRow","MdFormatBold","toggleMark","MdFormatItalic","templateObject_1$2","templateObject_2$1","templateObject_1$3","templateObject_2$2","Container$1","ContentArea","components","children","Editor","appearance","useMemo","analytics","Provider","PageHeader","href","displayName","EditorStore","currentEditorState","STORAGE_KEY","setEditorView","syncCurrentEditorState","localStorage","setItem","existing","getItem","stored","FrontPage","editorStore","debouncedSync","debounce","createNewBlockQuote","styleInject","css","insertAt","head","getElementsByTagName","firstChild","insertBefore","styleSheet","cssText","createTextNode","hole","createRef","append","decorations","putContentDomInRef","ReactDOM","editorRef","componentDidMount","forceUpdate","componentWillUnmount","shouldComponentUpdate","id","MinimalPage","__awaiter","thisArg","_arguments","P","generator","Promise","reject","fulfilled","next","rejected","done","then","__generator","body","f","y","g","label","sent","trys","ops","verb","Symbol","iterator","v","op","TypeError","__spreadArrays","il","r","k","j","jl","startMeasure","contentComponent","contentComponents","primaryToolbarComponent","primaryToolbarComponents","createParagraphNear","inlineContent","isTextblock","side","childCount","portalProviderAPI","eventDispatcher","hasContext","viewShouldUpdate","_handleRef","_viewShouldUpdate","domRef","createDomRef","getContentDOM","contentDOMWrapper","validUpdate","sameMarkup","nextNode","_props","browser","insertNewLine","moveUp","moveDown","enter","tab","space","escape","arrowKeysMap","ARROWLEFT","ARROWRIGHT","ARROWUP","ARROWDOWN","TooltipShortcut","formatShortcut","lastKey","toUpperCase","tooltip","memo","shortcutOverride","IconCode","width","height","fillRule","fill","x","rx","quickInsert","title","priority","keyshortcut","action","createChecked","threshold","weight","searchQuickInsertItems","quickInsertState","query","category","defaultItems","disableDefaultItems","lazyDefaultItems","providedItems","items","fuse","Fuse","Number","POSITIVE_INFINITY","search","find$1","list","iteratee","seen","l","it","dedupe","quickInsertPlugin","providerFactory","quickInsertItems","isElementBrowserModalOpen","itemsCache","concat","processItems","meta","getMeta","providerHandler","_name","providerPromise","provider","e_1","getItems","providerState","quickInsertPluginFactory","typeAhead","trigger","headless","_tr","getState","selectItem","N0","N200","N60A","typeAheadQuery","WithPluginState","context","notAppliedState","isSubscribed","handlePluginStateChange","propName","skipEqualityCheck","stateSubset","clearTimeout","setTimeout","setState","onContextUpdate","getPluginsStates","getEditorView","maybeProps","maybeContext","editorActions","_privateGetEditorView","getEventDispatcher","_privateGetEventDispatcher","pluginsStates","isPluginWithSubscribe","handler","subscribeToContextUpdates","_privateSubscribe","unsubscribeFromContextUpdates","_privateUnsubscribe","UNSAFE_componentWillReceiveProps","nextProps","contextTypes","PropTypes","object","createInputRule","isBlockNodeRule","inputRule","originalHandler","unsupportedMarks","hasUnsupportedMarkForBlockInputRule","hasUnsupportedMarkForInputRule","spec","code","defaultInputRuleHandler","InputRule","unsupportedMarksPresent","isUnsupportedMark","link","nodesBetween","isCodemark","isMarkTypeAllowedInCurrentSelection","markType","isMarkTypeAllowedInNode","$cursor","ranges","isCompatibleMarkType","isMarkTypeCompatibleWithMark","allowedInActiveMarks","pluginKey$1","findTypeAheadQuery","queryMark","isInSet","max","textContent","findQueryMark","dismissCommand","typeAheadHandler","dismiss","removeMark","removeStoredMark","ACTIONS","isChromeWithSelectionBug","insertSelectedItem","maybeNode","opts","isInputFragment","isText","safeInsert","layout","breakoutMark","breakout","newMarks","removeFromSet","normaliseNestedLayout","fragment","fromArray","getSelection","selectInlineNode","near","selectCurrentItem","mode","currentIndex","withTypeAheadQueryMarkPosition","insertFallbackCommand","selectByIndex","isQueryActive","createInitialPluginState","prevActiveState","isAllowed","itemsLoader","queryMarkPos","queryStarted","upKeyCount","downKeyCount","createPlugin","params","setCurrentItemIndex","newIndex","selectPrevActionHandler","selectNextActionHandler","itemsListUpdatedActionHandler","rangeHasMark","defaultActionHandler","selectCurrentActionHandler","updateQueryHandler","promise","itemsListUpdated","appendTransaction","_trs","newTr_1","forceSelect","handleDOMEvents","input","activeQuery","compositionend","replaceLastChar","replaceSelectionWith","isActive","newPluginState_1","nodeBefore","newPluginState_2","typeAheadMark","newPluginState_3","typeAheadItems","highlight","prevActive","queryChanged","getHighlight","cancel","promiseOfItems","canceled","catch","createItemsLoader","Date","inputRulePlugin","typeAheads","triggersRegex","customRegex","rules","inputRules","instrumentedInputRule","RegExp","typeAheadState","keymapPlugin$1","stopPropagation","isBody","elem","isTextNode","nodeType","getVerticalPlacement","boundariesElement","fitHeight","alignY","forcePlacement","parentElement","boundariesClientRect","getBoundingClientRect","boundariesHeight","boundariesTop","top","targetTop","targetHeight","spaceAbove","scrollTop","spaceBelow","getHorizontalPlacement","fitWidth","alignX","targetLeft","left","targetWidth","boundariesLeft","spaceLeft","spaceRight","getPopupXInsideParent","popupClientWidth","popupOffsetParentClientWidth","calculatePosition","placement","popup","offset","stick","allowOutOfBounds","rect","position","offsetParent","popupOffsetParent","offsetParentStyle","borderBottomWidth","verticalPlacement","horizontalPlacement","popupOffsetParentTop","popupOffsetParentLeft","popupOffsetParentRight","right","popupOffsetParentHeight","_d","targetRight","isPopupParentBody","verticalPosition","popupOffsetParentScrollTop","bottom","ceil","top_2","calculateVerticalPlacement","scrollParent","findOverflowScrollParent","newPos","scrollParentTop","topBoundary","scrollParentScrollTop","isBelowNodeBoundary","abs","calculateVerticalStickTop","topOffsetTop","targetEnd","clientHeight","scroll_1","top_1","calculateVerticalStickBottom","horizontalPosition","popupOffsetParentScrollLeft","calculateHorizontalPlacement","scrollLeft","clientWidth","validatePosition","getComputedStyle","overflow","overflowX","overflowY","Popup","overflowScrollParent","validPosition","initPopup","scheduledUpdatePosition","rafSchedule","updatePosition","onResize","onPositionCalculated","onPlacementChanged","calculatePlacement","cannotSetPopup","addEventListener","scrollElement","scrollableElement","removeEventListener","renderPopup","shouldRenderPopup","zIndex","ariaLabel","mountTo","createPortal","defaultProps","allowOutOfBound","gridSize","fontSizeSmall","templateObject_4","templateObject_5","templateObject_6","templateObject_7","templateObject_8","templateObject_9","templateObject_10","templateObject_11","templateObject_12","templateObject_13","templateObject_14","templateObject_3$1","templateObject_4$1","templateObject_5$1","templateObject_6$1","templateObject_7$1","templateObject_8$1","templateObject_9$1","templateObject_10$1","templateObject_11$1","templateObject_12$1","setCurrentIndex","themeNamespace","defaultTheme","afterItemSpacing","compact","beforeItemSpacing","borderRadius","outline","padding","background","secondaryText","selected","hover","dragging","isValidCssValue","getThemeStyle","maybeTheme","parentKey","theme","themeWithKeys","getItemState","stateName","stateStyles","getPadding","isCompact","paddingKey","_e","_f","adjustedTop","adjustedBottom","getHeightStyles","heightKey","getWidthStyles","widthKey","getInteractiveStyles","isDisabled","isDragging","isSelected","standardFocus","ItemBase","isHidden","BeforeAfterBase","Before","spaceKey","After","ContentWrapper","Content","allowMultiline","Description","descriptionFontSize","lineHeight","Item","setRef","rootComponent","linkComponent","styledRootElement","autoFocus","onKeyDown","onMouseEnter","onMouseLeave","role","dnd","otherProps","Root","dragHandleProps","patchedEventHandlers","defaultPrevented","onMouseDown","preventDefault","tabIndex","draggableProps","elemBefore","shouldAllowMultiline","elemAfter","GroupTitle","paddingType","templateObject_1$4","GroupTitleAfter","templateObject_3$2","gridSize$1","templateObject_4$2","GroupTitleText","templateObject_1$5","templateObject_2$3","templateObject_3$3","ItemGroup","innerRef","toString","Shortcut","selectedColor","IconFallback","x1","y1","x2","y2","stopColor","hidden","itemTheme","ItemIcon","templateObject_1$6","ItemBody","templateObject_2$4","ItemText","templateObject_3$4","ItemAfter","templateObject_4$3","TypeAheadItemsList","insertByIndex","ThemeProvider","TypeAheadItemComponent","divisor","templateObject_1$7","componentDidUpdate","offsetTop","offsetHeight","offsetParentHeight","direction","scrollIntoViewIfNeeded","onMouseMove","onHover","TypeAheadContent","TypeAhead","composing","handleKeyPress","handleMouseMove","isLoading","anchorElement","popupsMountPoint","popupsBoundariesElement","popupsScrollableElement","typeAheadPlugin","domAtPos","ex","childNodes","getPlugins","reconfigureState","HTMLElement","reconfigure","getDirectEditorProps","handleEditorViewRef","onEditorCreated","shouldFocus","focusTimeoutId","handleEditorFocus","onEditorDestroyed","editor","eventName","replaceDoc","editorState_1","prevEditorProps","createPluginsList","EditorActions","transformer","_privateRegisterEditor","contentTransformer","contentEncode","encode","bind","_privateUnregisterEditor","c","clear","appendText","lastChild","insertText","getChildContext","Children","only","childContextTypes","PortalProviderAPI","portals","setContext","hasReactContext","wrappedChildren","unstable_renderSubtreeIntoContainer","portal","PortalRenderer","handleUpdate","ProviderFactory","providers","subscribers","setProvider","isEmpty","notifyUpdated","removeProvider","handlers","splice","unsubscribeAll","hasProvider","whichTransitionEvent","el","transitions","transition","MozTransition","OTransition","WebkitTransition","templateObject_1$8","PluginsComponentsWrapper","PluginSlot","transitionEvent","forceComponentUpdate","propertyName","removeModeChangeListener","contentAreaRef","addModeChangeListener","containerElement","cloneElement","templateObject_1$9","templateObject_2$5","templateObject_1$a","templateObject_2$6","templateObject_3$5","Popups","DevIcon","extensionType","extensionKey","parameters","minWidth","editorDOMElement","popupsRef","quickInsertProvider","instance","_instance","AtlassianPage","performanceTracking","Routes","basename","process","path","getElementById"],"mappings":"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","file":"static/js/main.663a516c.chunk.js","sourcesContent":["import React from 'react'\nimport { NavLink } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { RouteComponentProps } from 'react-router'\n\ninterface IProps extends RouteComponentProps<{}> {\n  className?: string\n}\n\nexport function NavBar(props: IProps) {\n  const { className } = props\n  return (\n    <Container className={className}>\n      <Nav>\n        <Link to=\"/\" exact activeClassName=\"current\">Full</Link>\n        <Link to=\"/minimal\" activeClassName=\"current\">Minimal</Link>\n        <Link to=\"/atlassian\" activeClassName=\"current\">Atlassian</Link>\n      </Nav>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n  background: #551a8b;\n  box-shadow: 0 0 2px 2px rgba(0,0,0,0.18);\n  padding: 1rem;\n`\nconst Nav = styled.nav`\n  align-items: center;\n  display: flex;\n`\nconst Link = styled(NavLink)`\n  box-sizing: border-box;\n  color: #fff;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem 1rem;\n  text-decoration: none;\n  transition: 0.2s hover;\n  &:hover {\n    text-decoration: underline;\n  }\n  &.current {\n    font-weight: 600;\n  }\n`\n","import * as React from 'react'\nimport { Route, RouteProps, RouteComponentProps } from 'react-router'\nimport styled from 'styled-components'\n\nimport { NavBar } from './NavBar'\n\ntype ReactComponent = React.ComponentClass<any> | React.StatelessComponent<any>\n\ninterface IWrappedRoute extends RouteProps {\n  component: ReactComponent\n}\n\nconst renderNoMainContainerWrapper = (Component: ReactComponent) => (props: RouteComponentProps<any>) =>\n  <MainWrapper>\n    <NavBar {...props}/>\n    <Component {...props}/>\n  </MainWrapper>\n\nconst renderWrapper = (Component: ReactComponent) => (props: RouteComponentProps<any>) =>\n  <MainWrapper>\n    <NavBar {...props}/>\n    <MainContainer>\n      <Component {...props}/>\n    </MainContainer>\n  </MainWrapper>\n\nexport const NoMainContainerRoute = ({ component, ...rest } : IWrappedRoute) =>\n  <Route {...rest} render={renderNoMainContainerWrapper(component)}/>\n\nexport const WrappedRoute = ({ component, ...rest } : IWrappedRoute) =>\n  <Route {...rest} render={renderWrapper(component)}/>\n\nconst MainWrapper = styled.div`\n  background: snow;\n  min-height: 100vh;\n`\nconst MainContainer = styled.main`\n  margin: 40px auto 0 auto;\n  max-width: 680px;\n  padding-bottom: 20px;\n  @media only screen and (max-width: 720px) {\n    margin: 40px 20px 0 20px;\n    padding-bottom: 20px;\n  }\n`\n","import React, { createContext, useContext, useEffect, forwardRef, useState, useLayoutEffect, useRef, useMemo } from 'react';\nimport { EditorView } from 'prosemirror-view';\nexport { EditorView } from 'prosemirror-view';\nimport { EditorState, Selection, NodeSelection, TextSelection, PluginKey as PluginKey$1, Plugin } from 'prosemirror-state';\nexport { EditorState } from 'prosemirror-state';\nimport applyDevTools from 'prosemirror-dev-tools';\nimport { Node, Fragment, Schema } from 'prosemirror-model';\nimport { render, unmountComponentAtNode } from 'react-dom';\nimport { history } from 'prosemirror-history';\nimport { keymap } from 'prosemirror-keymap';\nimport { baseKeymap, toggleMark } from 'prosemirror-commands';\nimport { canSplit } from 'prosemirror-transform';\nimport styled from 'styled-components';\nimport { findSelectedNodeOfType, findParentNodeOfType } from 'prosemirror-utils';\nimport { MdFormatBold, MdFormatItalic } from 'react-icons/md';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nfunction __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n}\n\nfunction parseRawValue(value, schema) {\r\n    var parsedNode;\r\n    if (typeof value === 'string') {\r\n        try {\r\n            parsedNode = JSON.parse(value);\r\n        }\r\n        catch (err) {\r\n            // eslint-disable-next-line no-console\r\n            console.error(\"Error processing value: \" + value + \" isn't a valid JSON\");\r\n            return;\r\n        }\r\n    }\r\n    else {\r\n        parsedNode = value;\r\n    }\r\n    try {\r\n        // ProseMirror always require a child under doc\r\n        if (parsedNode.type === 'doc') {\r\n            if (Array.isArray(parsedNode.content) && parsedNode.content.length === 0) {\r\n                parsedNode.content.push({\r\n                    type: 'paragraph',\r\n                    content: [],\r\n                });\r\n            }\r\n            // Just making sure doc is always valid\r\n            if (!parsedNode.version) {\r\n                parsedNode.version = 1;\r\n            }\r\n        }\r\n        var parsedDoc = Node.fromJSON(schema, parsedNode);\r\n        // throws an error if the document is invalid\r\n        parsedDoc.check();\r\n        return parsedDoc;\r\n    }\r\n    catch (err) {\r\n        // eslint-disable-next-line no-console\r\n        console.error(\"Error processing document:\\n\" + err.message + \"\\n\\n\", JSON.stringify(parsedNode));\r\n        return;\r\n    }\r\n}\n\nvar EditorViewProvider = /** @class */ (function () {\r\n    function EditorViewProvider() {\r\n    }\r\n    EditorViewProvider.prototype.init = function (view) {\r\n        this._editorView = view;\r\n    };\r\n    Object.defineProperty(EditorViewProvider.prototype, \"editorView\", {\r\n        get: function () {\r\n            if (!this._editorView) {\r\n                throw Error('EditorViewProvider editorView accessed without editorView instance');\r\n            }\r\n            return this._editorView;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    EditorViewProvider.prototype.getMarks = function () {\r\n        return this.editorView.state.schema.marks;\r\n    };\r\n    EditorViewProvider.prototype.getNodes = function () {\r\n        return this.editorView.state.schema.nodes;\r\n    };\r\n    EditorViewProvider.prototype.execCommand = function (cmd) {\r\n        cmd(this.editorView.state, this.editorView.dispatch);\r\n        this.focus();\r\n    };\r\n    EditorViewProvider.prototype.focus = function () {\r\n        if (!this._editorView || this._editorView.hasFocus()) {\r\n            return false;\r\n        }\r\n        this._editorView.focus();\r\n        this._editorView.dispatch(this._editorView.state.tr.scrollIntoView());\r\n        return true;\r\n    };\r\n    EditorViewProvider.prototype.blur = function () {\r\n        if (!this._editorView || !this._editorView.hasFocus()) {\r\n            return false;\r\n        }\r\n        this._editorView.dom.blur();\r\n        return true;\r\n    };\r\n    EditorViewProvider.prototype.stateToJSON = function () {\r\n        var state = this.editorView.state.toJSON();\r\n        return __assign(__assign({}, state), { plugins: [] });\r\n    };\r\n    EditorViewProvider.prototype.replaceState = function (rawValue) {\r\n        var state = EditorState.fromJSON({\r\n            schema: this.editorView.state.schema,\r\n            plugins: this.editorView.state.plugins,\r\n        }, rawValue);\r\n        this.editorView.updateState(state);\r\n    };\r\n    EditorViewProvider.prototype.replaceDocument = function (rawValue, shouldScrollToBottom, shouldAddToHistory) {\r\n        if (shouldScrollToBottom === void 0) { shouldScrollToBottom = true; }\r\n        if (shouldAddToHistory === void 0) { shouldAddToHistory = true; }\r\n        if (!this.editorView || rawValue === undefined || rawValue === null) {\r\n            return false;\r\n        }\r\n        var state = this.editorView.state;\r\n        var schema = state.schema;\r\n        var content = parseRawValue(rawValue, schema);\r\n        if (!content) {\r\n            return false;\r\n        }\r\n        // In case of replacing a whole document, we only need a content of a top level node e.g. document.\r\n        var tr = state.tr.replaceWith(0, state.doc.nodeSize - 2, content.content);\r\n        if (!shouldScrollToBottom && !tr.selectionSet) {\r\n            // Restore selection at start of document instead of the end.\r\n            tr.setSelection(Selection.atStart(tr.doc));\r\n        }\r\n        if (shouldScrollToBottom) {\r\n            tr = tr.scrollIntoView();\r\n        }\r\n        if (!shouldAddToHistory) {\r\n            tr.setMeta('addToHistory', false);\r\n        }\r\n        this.editorView.dispatch(tr);\r\n        return true;\r\n    };\r\n    return EditorViewProvider;\r\n}());\n\n// https://bitbucket.org/atlassian/atlassian-frontend-mirror/src/master/editor/editor-core/src/event-dispatcher/index.ts\r\nvar EventDispatcher = /** @class */ (function () {\r\n    function EventDispatcher() {\r\n        this.listeners = {};\r\n    }\r\n    EventDispatcher.prototype.on = function (event, cb) {\r\n        if (!this.listeners[event]) {\r\n            this.listeners[event] = new Set();\r\n        }\r\n        this.listeners[event].add(cb);\r\n    };\r\n    EventDispatcher.prototype.off = function (event, cb) {\r\n        if (!this.listeners[event]) {\r\n            return;\r\n        }\r\n        if (this.listeners[event].has(cb)) {\r\n            this.listeners[event].delete(cb);\r\n        }\r\n    };\r\n    EventDispatcher.prototype.emit = function (event, data) {\r\n        if (!this.listeners[event]) {\r\n            return;\r\n        }\r\n        this.listeners[event].forEach(function (cb) { return cb(data); });\r\n    };\r\n    EventDispatcher.prototype.destroy = function () {\r\n        this.listeners = {};\r\n    };\r\n    return EventDispatcher;\r\n}());\n\nvar PluginsProvider = /** @class */ (function () {\r\n    function PluginsProvider() {\r\n        this.dispatcher = new EventDispatcher();\r\n    }\r\n    PluginsProvider.prototype.publish = function (pluginKey, nextPluginState) {\r\n        this.dispatcher.emit(pluginKey.name, nextPluginState);\r\n    };\r\n    PluginsProvider.prototype.subscribe = function (pluginKey, cb) {\r\n        this.dispatcher.on(pluginKey.name, cb);\r\n    };\r\n    PluginsProvider.prototype.unsubscribe = function (pluginKey, cb) {\r\n        this.dispatcher.off(pluginKey.name, cb);\r\n    };\r\n    return PluginsProvider;\r\n}());\n\n// import { createPortal } from 'react-dom'\r\nvar PortalProvider = /** @class */ (function () {\r\n    function PortalProvider() {\r\n        this.mounted = new Map();\r\n        this.pendingUpdates = new Map();\r\n        this.listeners = new Map();\r\n    }\r\n    PortalProvider.prototype.render = function (component, container) {\r\n        this.mounted.set(container, {\r\n            component: component,\r\n        });\r\n        this.pendingUpdates.set(container, {\r\n            type: 'CREATE'\r\n        });\r\n    };\r\n    PortalProvider.prototype.update = function (container, props) {\r\n        this.pendingUpdates.set(container, {\r\n            type: 'UPDATE',\r\n            props: props,\r\n        });\r\n    };\r\n    PortalProvider.prototype.remove = function (container) {\r\n        this.pendingUpdates.set(container, {\r\n            type: 'DELETE'\r\n        });\r\n    };\r\n    PortalProvider.prototype.flush = function () {\r\n        var _this = this;\r\n        var updated = Array.from(this.pendingUpdates.entries()).map(function (_a) {\r\n            var container = _a[0], operation = _a[1];\r\n            var values = _this.mounted.get(container);\r\n            if (!values)\r\n                return;\r\n            var component = values.component;\r\n            if (operation.type === 'CREATE') {\r\n                render(component, container);\r\n            }\r\n            else if (operation.type === 'UPDATE') {\r\n                var set = _this.listeners.get(container);\r\n                if (set) {\r\n                    set.forEach(function (cb) { return cb(operation.props); });\r\n                }\r\n            }\r\n            else if (operation.type === 'DELETE') {\r\n                unmountComponentAtNode(container);\r\n            }\r\n            _this.pendingUpdates.delete(container);\r\n            return values;\r\n        });\r\n    };\r\n    PortalProvider.prototype.subscribe = function (container, cb) {\r\n        var _a;\r\n        var set = (_a = this.listeners.get(container)) !== null && _a !== void 0 ? _a : new Set();\r\n        set.add(cb);\r\n        this.listeners.set(container, set);\r\n    };\r\n    PortalProvider.prototype.unsubscribe = function (container, cb) {\r\n        var set = this.listeners.get(container);\r\n        if (!set)\r\n            return;\r\n        if (set.has(cb)) {\r\n            set.delete(cb);\r\n        }\r\n        if (set.size === 0) {\r\n            this.listeners.delete(container);\r\n        }\r\n        else {\r\n            this.listeners.set(container, set);\r\n        }\r\n    };\r\n    PortalProvider.prototype.destroy = function () {\r\n        this.listeners = new Map();\r\n        Array.from(this.mounted.entries()).map(function (_a) {\r\n            var container = _a[0], values = _a[1];\r\n            unmountComponentAtNode(container);\r\n        });\r\n        this.mounted = new Map();\r\n        this.pendingUpdates = new Map();\r\n    };\r\n    return PortalProvider;\r\n}());\n\nvar hasRequiredPerformanceAPIs;\r\nfunction isPerformanceAPIAvailable() {\r\n    if (hasRequiredPerformanceAPIs === undefined) {\r\n        hasRequiredPerformanceAPIs =\r\n            typeof window !== 'undefined' &&\r\n                'performance' in window &&\r\n                [\r\n                    'measure',\r\n                    'clearMeasures',\r\n                    'clearMarks',\r\n                    'getEntriesByName',\r\n                    'getEntriesByType',\r\n                    'now',\r\n                ].every(function (api) { return !!performance[api]; });\r\n    }\r\n    return hasRequiredPerformanceAPIs;\r\n}\n\nvar measureMap = new Map();\r\nfunction startMeasure(measureName) {\r\n    if (!isPerformanceAPIAvailable()) {\r\n        return;\r\n    }\r\n    performance.mark(measureName + \"::start\");\r\n    measureMap.set(measureName, performance.now());\r\n}\r\nfunction stopMeasure(measureName, onMeasureComplete) {\r\n    if (!isPerformanceAPIAvailable()) {\r\n        return;\r\n    }\r\n    performance.mark(measureName + \"::end\");\r\n    var start = onMeasureComplete ? measureMap.get(measureName) : undefined;\r\n    try {\r\n        performance.measure(measureName, measureName + \"::start\", measureName + \"::end\");\r\n    }\r\n    catch (error) {\r\n    }\r\n    finally {\r\n        if (onMeasureComplete) {\r\n            var entry = performance.getEntriesByName(measureName).pop();\r\n            if (entry) {\r\n                onMeasureComplete(entry.duration, entry.startTime);\r\n            }\r\n            else if (start) {\r\n                onMeasureComplete(performance.now() - start, start);\r\n            }\r\n        }\r\n        clearMeasure(measureName);\r\n    }\r\n}\r\nfunction clearMeasure(measureName) {\r\n    if (!isPerformanceAPIAvailable()) {\r\n        return;\r\n    }\r\n    measureMap.delete(measureName);\r\n    performance.clearMarks(measureName + \"::start\");\r\n    performance.clearMarks(measureName + \"::end\");\r\n    performance.clearMeasures(measureName);\r\n}\n\nvar LOG_LEVEL;\r\n(function (LOG_LEVEL) {\r\n    LOG_LEVEL[\"debug\"] = \"debug\";\r\n    LOG_LEVEL[\"info\"] = \"info\";\r\n    LOG_LEVEL[\"warn\"] = \"warn\";\r\n    LOG_LEVEL[\"error\"] = \"error\";\r\n})(LOG_LEVEL || (LOG_LEVEL = {}));\r\nvar AnalyticsProvider = /** @class */ (function () {\r\n    function AnalyticsProvider(props) {\r\n        var _this = this;\r\n        if (props === void 0) { props = {}; }\r\n        this.shouldTrack = false;\r\n        this.logToConsole = false;\r\n        this.logLevel = LOG_LEVEL.error;\r\n        this.logs = {};\r\n        this.perf = {\r\n            debug: function (namespace, method) {\r\n                if (_this.hasLevel(LOG_LEVEL.debug)) {\r\n                    _this.measure(namespace, method, LOG_LEVEL.debug);\r\n                }\r\n            },\r\n            info: function (namespace, method) {\r\n                if (_this.hasLevel(LOG_LEVEL.info)) {\r\n                    _this.measure(namespace, method, LOG_LEVEL.info);\r\n                }\r\n            },\r\n            warn: function (namespace, method) {\r\n                if (_this.hasLevel(LOG_LEVEL.warn)) {\r\n                    _this.measure(namespace, method, LOG_LEVEL.warn);\r\n                }\r\n            },\r\n            error: function (namespace, method) {\r\n                if (_this.hasLevel(LOG_LEVEL.error)) {\r\n                    _this.measure(namespace, method, LOG_LEVEL.error);\r\n                }\r\n            },\r\n            stop: function (namespace, method, durationThreshold) {\r\n                if (durationThreshold === void 0) { durationThreshold = 0; }\r\n                _this.stopMeasure(namespace, method, durationThreshold);\r\n            }\r\n        };\r\n        var shouldTrack = props.shouldTrack, logToConsole = props.logToConsole, logLevel = props.logLevel;\r\n        if (shouldTrack)\r\n            this.shouldTrack = shouldTrack;\r\n        if (logToConsole)\r\n            this.logToConsole = logToConsole;\r\n        if (logLevel) {\r\n            if (logLevel === 'debug')\r\n                this.logLevel = LOG_LEVEL.debug;\r\n            else if (logLevel === 'info')\r\n                this.logLevel = LOG_LEVEL.info;\r\n            else if (logLevel === 'warn')\r\n                this.logLevel = LOG_LEVEL.warn;\r\n            else if (logLevel === 'error')\r\n                this.logLevel = LOG_LEVEL.error;\r\n        }\r\n    }\r\n    AnalyticsProvider.prototype.hasLevel = function (level) {\r\n        var lvl = this.logLevel;\r\n        switch (level) {\r\n            case 'debug':\r\n                return lvl === 'debug';\r\n            case 'info':\r\n                return lvl === 'debug' || lvl === 'info';\r\n            case 'warn':\r\n                return lvl === 'debug' || lvl === 'info' || lvl === 'warn';\r\n            case 'error':\r\n                return lvl === 'debug' || lvl === 'info' || lvl === 'warn' || lvl === 'error';\r\n            default:\r\n                return false;\r\n        }\r\n    };\r\n    AnalyticsProvider.prototype.startLog = function (namespace, method, level) {\r\n        var _a;\r\n        if (namespace in this.logs) {\r\n            if (method in this.logs[namespace]) {\r\n                this.logs[namespace][method].pending = true;\r\n            }\r\n            else {\r\n                this.logs[namespace][method] = {\r\n                    logs: [],\r\n                    level: level,\r\n                    pending: true\r\n                };\r\n            }\r\n        }\r\n        else {\r\n            this.logs[namespace] = (_a = {},\r\n                _a[method] = {\r\n                    logs: [],\r\n                    level: level,\r\n                    pending: true\r\n                },\r\n                _a);\r\n        }\r\n    };\r\n    AnalyticsProvider.prototype.endLog = function (namespace, method, msg) {\r\n        if (namespace in this.logs) {\r\n            if (method in this.logs[namespace]) {\r\n                this.logs[namespace][method].pending = false;\r\n                this.logs[namespace][method].logs.push(msg);\r\n                var lvl = this.logs[namespace][method].level;\r\n                if (lvl === 'debug')\r\n                    console.debug(msg);\r\n                else if (lvl === 'info')\r\n                    console.info(msg);\r\n                else if (lvl === 'warn')\r\n                    console.warn(msg);\r\n                else if (lvl === 'error')\r\n                    console.error(msg);\r\n            }\r\n            else {\r\n                throw Error(\"Stopping measurement for namespace '\" + namespace + \"' with non-existent method: \" + method);\r\n            }\r\n        }\r\n        else {\r\n            throw Error(\"Stopping measurement for non-existent namespace: \" + namespace);\r\n        }\r\n    };\r\n    AnalyticsProvider.prototype.getName = function (namespace, method) {\r\n        return namespace + \"::\" + method;\r\n    };\r\n    AnalyticsProvider.prototype.measure = function (namespace, method, level) {\r\n        if (this.shouldTrack && this.logToConsole) {\r\n            this.startLog(namespace, method, level);\r\n            startMeasure(this.getName(namespace, method));\r\n        }\r\n    };\r\n    AnalyticsProvider.prototype.stopMeasure = function (namespace, method, durationThreshold) {\r\n        var _this = this;\r\n        if (durationThreshold === void 0) { durationThreshold = 0; }\r\n        stopMeasure(this.getName(namespace, method), function (duration, start) {\r\n            if (_this.shouldTrack && _this.logToConsole && durationThreshold <= duration) {\r\n                var msg = _this.getName(namespace, method) + \" took \" + Math.round(duration) + \" ms\";\r\n                _this.endLog(namespace, method, msg);\r\n            }\r\n        });\r\n    };\r\n    return AnalyticsProvider;\r\n}());\n\nvar EditorContext = createContext({\r\n    portalProvider: new PortalProvider(),\r\n    viewProvider: new EditorViewProvider(),\r\n    pluginsProvider: new PluginsProvider(),\r\n    analyticsProvider: new AnalyticsProvider(),\r\n});\r\nvar useEditorContext = function () { return useContext(EditorContext); };\n\nvar doc = {\r\n    content: 'block+',\r\n};\n\nvar blockquote = {\r\n    content: 'paragraph+',\r\n    group: 'block',\r\n    defining: true,\r\n    selectable: false,\r\n    attrs: {\r\n        class: { default: '' },\r\n    },\r\n    parseDOM: [{ tag: 'blockquote' }],\r\n    toDOM: function () {\r\n        return ['blockquote', 0];\r\n    },\r\n};\r\nvar pmBlockquote = {\r\n    content: 'paragraph+',\r\n    group: 'block',\r\n    defining: true,\r\n    selectable: false,\r\n    attrs: {\r\n        class: { default: 'pm-blockquote' },\r\n    },\r\n    parseDOM: [{ tag: 'blockquote' }],\r\n    toDOM: function (node) {\r\n        return ['blockquote', node.attrs, 0];\r\n    },\r\n};\n\n/**\r\n * NOTE: Need this because TS is too smart and inline everything.\r\n * So we need to give them separate identity.\r\n * Probably there's a way to solve it but that will need time and exploration.\r\n * // http://bit.ly/2raXFX5\r\n * type T1 = X | Y\r\n * type T2 = A | T1 | B // T2 = A | X | Y | B\r\n */\r\n// export type ParagraphWithMarksDefinition =\r\n//   | ParagraphWithAlignmentDefinition\r\n//   | ParagraphWithIndentationDefinition;\r\nvar paragraph = {\r\n    content: 'inline*',\r\n    group: 'block',\r\n    selectable: false,\r\n    // marks:\r\n    // 'strong code em link strike subsup textColor underline unsupportedMark unsupportedNodeAttribute',\r\n    parseDOM: [{ tag: 'p' }],\r\n    toDOM: function () {\r\n        return ['p', 0];\r\n    },\r\n};\n\nvar text = {\r\n    group: 'inline',\r\n    toDebugString: process.env.NODE_ENV !== 'production' ? undefined : function () { return 'text_node'; },\r\n};\n\n// # What do marks exist?\r\n//\r\n// Marks are categorised into different groups. One motivation for this was to allow the `code` mark\r\n// to exclude other marks, without needing to explicitly name them. Explicit naming requires the\r\n// named mark to exist in the schema. This is undesirable because we want to construct different\r\n// schemas that have different sets of nodes/marks.\r\n//\r\n// Groups provide a level of indirection, and solve this problem. For the immediate use-case, one\r\n// group called \"not_code\" would have sufficed, but this an ultra-specialised to code.\r\n// Mark group for font styling (e.g. bold, italic, underline, superscript).\r\nvar FONT_STYLE = 'fontStyle';\n\nvar em = {\r\n    inclusive: true,\r\n    group: FONT_STYLE,\r\n    parseDOM: [{ tag: 'i' }, { tag: 'em' }, { style: 'font-style=italic' }],\r\n    toDOM: function () {\r\n        return ['em'];\r\n    },\r\n};\n\nvar strong = {\r\n    inclusive: true,\r\n    group: FONT_STYLE,\r\n    parseDOM: [\r\n        { tag: 'strong' },\r\n        // This works around a Google Docs misbehavior where\r\n        // pasted content will be inexplicably wrapped in `<b>`\r\n        // tags with a font-weight normal.\r\n        {\r\n            tag: 'b',\r\n            getAttrs: function (node) {\r\n                var element = node;\r\n                return element.style.fontWeight !== 'normal' && null;\r\n            },\r\n        },\r\n        {\r\n            tag: 'span',\r\n            getAttrs: function (node) {\r\n                var element = node;\r\n                var fontWeight = element.style.fontWeight;\r\n                return (typeof fontWeight === 'string' &&\r\n                    (fontWeight === 'bold' ||\r\n                        fontWeight === 'bolder' ||\r\n                        /^(bold(er)?|[5-9]\\d{2,})$/.test(fontWeight)) &&\r\n                    null);\r\n            },\r\n        },\r\n    ],\r\n    toDOM: function () {\r\n        return ['strong'];\r\n    },\r\n};\n\nfunction splitBlock(state, dispatch) {\r\n    var _a = state.selection, $from = _a.$from, $to = _a.$to;\r\n    if (state.selection instanceof NodeSelection && state.selection.node.isBlock) {\r\n        if (!$from.parentOffset || !canSplit(state.doc, $from.pos))\r\n            return false;\r\n        if (dispatch)\r\n            dispatch(state.tr.split($from.pos).scrollIntoView());\r\n        return true;\r\n    }\r\n    if (!$from.parent.isBlock)\r\n        return false;\r\n    if (dispatch) {\r\n        var atEnd = $to.parentOffset == $to.parent.content.size;\r\n        var tr = state.tr;\r\n        if (state.selection instanceof TextSelection)\r\n            tr.deleteSelection();\r\n        var deflt = $from.depth == 0 ? undefined : $from.node(-1).contentMatchAt($from.indexAfter(-1)).defaultType;\r\n        var types = atEnd && deflt ? [{ type: deflt }] : undefined;\r\n        var can = canSplit(tr.doc, tr.mapping.map($from.pos), 1, types);\r\n        if (!types && !can && deflt && canSplit(tr.doc, tr.mapping.map($from.pos), 1, deflt && [{ type: deflt }])) {\r\n            types = [{ type: deflt }];\r\n            can = true;\r\n        }\r\n        if (can && deflt) {\r\n            tr.split(tr.mapping.map($from.pos), 1, types);\r\n            var isStuff = !atEnd && !$from.parentOffset && $from.parent.type != deflt;\r\n            var canReplace = $from.node(-1).canReplace($from.index(-1), $from.indexAfter(-1), Fragment.from(deflt.create()));\r\n            if (isStuff && canReplace) {\r\n                tr.setNodeMarkup(tr.mapping.map($from.before()), deflt);\r\n            }\r\n        }\r\n        dispatch(tr.scrollIntoView());\r\n    }\r\n    return true;\r\n}\r\nfunction createNewPmBlockQuote(state, dispatch) {\r\n    var _a = state.selection, $from = _a.$from, $to = _a.$to;\r\n    var blockquote = state.schema.nodes.pmBlockquote;\r\n    var empty = blockquote.createAndFill();\r\n    var endOfBlock = $from.end();\r\n    if (empty && dispatch) {\r\n        var tr = state.tr.insert(endOfBlock + 1, empty);\r\n        dispatch(tr);\r\n    }\r\n    return false;\r\n}\n\nvar PluginKey = /** @class */ (function (_super) {\r\n    __extends(PluginKey, _super);\r\n    function PluginKey(name) {\r\n        var _this = _super.call(this, name) || this;\r\n        _this.name = name;\r\n        return _this;\r\n    }\r\n    return PluginKey;\r\n}(PluginKey$1));\n\n// From https://github.com/PierBover/prosemirror-cookbook\r\nfunction getActiveMarks(state) {\r\n    var isEmpty = state.selection.empty;\r\n    if (isEmpty) {\r\n        var $from = state.selection.$from;\r\n        var storedMarks = state.storedMarks;\r\n        // Return either the stored marks, or the marks at the cursor position.\r\n        // Stored marks are the marks that are going to be applied to the next input\r\n        // if you dispatched a mark toggle with an empty cursor.\r\n        if (storedMarks) {\r\n            return storedMarks.map(function (mark) { return mark.type.name; });\r\n        }\r\n        else {\r\n            return $from.marks().map(function (mark) { return mark.type.name; });\r\n        }\r\n    }\r\n    else {\r\n        var $head = state.selection.$head;\r\n        var $anchor = state.selection.$anchor;\r\n        // We're using a Set to not get duplicate values\r\n        var activeMarks_1 = new Set();\r\n        // Here we're getting the marks at the head and anchor of the selection\r\n        $head.marks().forEach(function (mark) { return activeMarks_1.add(mark.type.name); });\r\n        $anchor.marks().forEach(function (mark) { return activeMarks_1.add(mark.type.name); });\r\n        return Array.from(activeMarks_1);\r\n    }\r\n}\n\nvar basePluginKey = new PluginKey('basePlugin');\r\nfunction basePluginFactory(portalProvider, pluginsProvider, options) {\r\n    return new Plugin({\r\n        state: {\r\n            init: function (_, state) {\r\n                return {\r\n                    activeNodes: [],\r\n                    activeMarks: [],\r\n                };\r\n            },\r\n            apply: function (tr, pluginState, _oldState, newState) {\r\n                if (tr.docChanged || tr.selectionSet) {\r\n                    var marks = getActiveMarks(newState);\r\n                    var eqMarks = marks.every(function (m) { return pluginState.activeMarks.includes(m); }) && marks.length === pluginState.activeMarks.length;\r\n                    if (!eqMarks) {\r\n                        var nextPluginState = __assign(__assign({}, pluginState), { activeMarks: marks });\r\n                        pluginsProvider.publish(basePluginKey, nextPluginState);\r\n                        return nextPluginState;\r\n                    }\r\n                }\r\n                return pluginState;\r\n            },\r\n        },\r\n        key: basePluginKey,\r\n        props: {},\r\n    });\r\n}\n\nvar basePlugin = function (options) { return ({\r\n    name: 'base',\r\n    pmPlugins: function () {\r\n        var plugins = [\r\n            { name: 'history', plugin: function () { return history(); } },\r\n            { name: 'baseKeyMap', plugin: function () { return keymap(baseKeymap); } },\r\n            {\r\n                name: 'otherKeyMap',\r\n                plugin: function () { return keymap({\r\n                    'Ctrl-Alt-p': createNewPmBlockQuote,\r\n                    'Ctrl-Alt-s': splitBlock,\r\n                }); }\r\n            },\r\n            {\r\n                name: 'base',\r\n                plugin: function (_a) {\r\n                    var portalProvider = _a.portalProvider, pluginsProvider = _a.pluginsProvider;\r\n                    return basePluginFactory(portalProvider, pluginsProvider);\r\n                },\r\n            },\r\n        ];\r\n        return plugins;\r\n    },\r\n    nodes: function () {\r\n        return [\r\n            { name: 'doc', node: doc },\r\n            { name: 'paragraph', node: paragraph },\r\n            { name: 'pmBlockquote', node: pmBlockquote },\r\n            { name: 'text', node: text },\r\n        ];\r\n    },\r\n    marks: function () {\r\n        return [\r\n            { name: 'em', mark: em },\r\n            { name: 'strong', mark: strong },\r\n        ];\r\n    }\r\n}); };\n\nfunction createListenProps(container, portalProvider) {\r\n    return function (cb) {\r\n        useEffect(function () {\r\n            portalProvider.subscribe(container, cb);\r\n            return function () {\r\n                portalProvider.unsubscribe(container, cb);\r\n            };\r\n        }, []);\r\n    };\r\n}\n\nvar ReactNodeView = /** @class */ (function () {\r\n    function ReactNodeView(node, view, getPos, portalProvider, pluginsProvider, reactComponentProps, reactComponent) {\r\n        var _this = this;\r\n        /**\r\n         * After the component has been rendered, if this nodeView contains a contentDOM it is\r\n         * appended to the element the component chooses to by forwarding a ref to it.\r\n         * @param node the element the ref points to inside the component.\r\n         */\r\n        this.handleRef = function (node) {\r\n            if (node && _this.contentDOM && !node.contains(_this.contentDOM)) {\r\n                node.appendChild(_this.contentDOM);\r\n            }\r\n        };\r\n        this.node = node;\r\n        this.view = view;\r\n        this.getPos = getPos;\r\n        this.pluginsProvider = pluginsProvider;\r\n        this.portalProvider = portalProvider;\r\n        this.reactComponentProps = reactComponentProps || {};\r\n        this.reactComponent = reactComponent;\r\n    }\r\n    /**\r\n     * This method exists to move initialization logic out of the constructor,\r\n     * so object can be initialized properly before calling render first time.\r\n     *\r\n     * Example:\r\n     * Instance properties get added to an object only after super call in\r\n     * constructor, which leads to some methods being undefined during the\r\n     * first render.\r\n     */\r\n    ReactNodeView.prototype.init = function () {\r\n        // Here, we'll provide a container to render React into.\r\n        // Coincidentally, this is where ProseMirror will put its\r\n        // generated contentDOM. React will throw out that content\r\n        // once rendered, and at the same time we'll append it into\r\n        // the component tree, like a fancy shell game. This isn't\r\n        // obvious to the user, but would it be more obvious on an\r\n        // expensive render?\r\n        //\r\n        this.dom = this.createContainerDOM();\r\n        // Instead of just mindlessly copying the attributes to the container node\r\n        // I think letting the component render them is preferred.\r\n        // You can't really apply styles outside the component to the parent either way\r\n        // and the attributes are stored inside this.node and thus not needed to be actually shown.\r\n        // this.setDomAttrs(this.node, this.dom)\r\n        // @see ED-3790\r\n        // something gets messed up during mutation processing inside of a\r\n        // nodeView if DOM structure has nested plain \"div\"s, it doesn't see the\r\n        // difference between them and it kills the nodeView\r\n        this.dom.classList.add(this.node.type.name + \"__nodeview-dom\");\r\n        // Finally, we provide an element to render content into.\r\n        // We will be moving this node around as we need to.\r\n        this.contentDOM = this.createContentDOM();\r\n        if (this.contentDOM) {\r\n            // This contentDOM is thrown out by the reactComponent once it renders\r\n            // but which is then re-added with the handleRef\r\n            this.dom.appendChild(this.contentDOM);\r\n        }\r\n        var useListenProps = createListenProps(this.dom, this.portalProvider);\r\n        this.renderReactComponent(this.render(this.createProps(this.node), this.handleRef, useListenProps));\r\n        return this;\r\n    };\r\n    ReactNodeView.prototype.createProps = function (node) {\r\n        return {\r\n            componentProps: this.reactComponentProps,\r\n            attrs: node.attrs,\r\n        };\r\n    };\r\n    ReactNodeView.prototype.renderReactComponent = function (component) {\r\n        if (!this.dom || !component) {\r\n            return;\r\n        }\r\n        this.portalProvider.render(component, this.dom);\r\n    };\r\n    ReactNodeView.prototype.createContainerDOM = function () {\r\n        return this.node.isInline ? document.createElement('span') : document.createElement('div');\r\n    };\r\n    /**\r\n     * If this.node is a leaf node, there shouldn't be a contentDOM.\r\n     * Perhaps a check should be in place to validate this..\r\n     */\r\n    ReactNodeView.prototype.createContentDOM = function () {\r\n        return undefined;\r\n    };\r\n    ReactNodeView.prototype.render = function (initialProps, forwardRef, useListenProps) {\r\n        return this.reactComponent ? (React.createElement(this.reactComponent, { ref: forwardRef, initialProps: initialProps, useListenProps: useListenProps })) : null;\r\n    };\r\n    ReactNodeView.prototype.update = function (node, _decorations) {\r\n        if (!this.dom)\r\n            return false;\r\n        // Sometimes it might happen that the current transaction transforms/splits a node\r\n        // into entirely different node (eg block nodes becoming paragraphs all of sudden)\r\n        // I guess you could do some magic there to avoid redrawing but for now I have little idea how to\r\n        // utilize it so this returns false and the update is processed by PM default behavior.\r\n        // Might be relevant\r\n        // https://discuss.prosemirror.net/t/how-to-modify-node-attribute-without-replacing-it-and-causing-it-to-re-render/2510/9\r\n        if (node.type !== this.node.type)\r\n            return false;\r\n        this.node = node;\r\n        // TODO pass down also type & marks & decorations if changed?\r\n        this.portalProvider.update(this.dom, this.createProps(node));\r\n        return true;\r\n    };\r\n    /**\r\n     * Copies the attributes from a ProseMirror Node to a DOM node.\r\n     * NOT used at the moment since it messes up classes if used for component HTMLElement directly.\r\n     * Also I think it's better for component to decide how to set those attributes.\r\n     * @param node The Prosemirror Node from which to source the attributes\r\n     */\r\n    ReactNodeView.prototype.setDomAttrs = function (node, element) {\r\n        Object.keys(node.attrs || {}).forEach(function (attr) {\r\n            element.setAttribute(attr, node.attrs[attr]);\r\n        });\r\n    };\r\n    /**\r\n     * Used to prevent changes to DOM inside the contentDOM from confusing PM to attempt\r\n     * \"fixing\" this nodeView by removing the added children etc\r\n     * https://github.com/remirror/remirror/blob/a2fa2c2b935a6fce99e3f79aad8a207c920e236e/packages/%40remirror/extension-react-component/src/react-node-view.tsx\r\n     * @param mutation\r\n     */\r\n    ReactNodeView.prototype.ignoreMutation = function (mutation) {\r\n        if (mutation.type === 'selection') {\r\n            return false;\r\n        }\r\n        else if (!this.contentDOM) {\r\n            return true;\r\n        }\r\n        return !this.contentDOM.contains(mutation.target);\r\n    };\r\n    ReactNodeView.prototype.destroy = function () {\r\n        if (this.dom) {\r\n            this.portalProvider.remove(this.dom);\r\n        }\r\n        this.dom = undefined;\r\n        this.contentDOM = undefined;\r\n    };\r\n    ReactNodeView.fromComponent = function (component, portalProvider, pluginsProvider, props) {\r\n        return function (node, view, getPos) {\r\n            return new ReactNodeView(node, view, getPos, portalProvider, pluginsProvider, props, component).init();\r\n        };\r\n    };\r\n    return ReactNodeView;\r\n}());\n\nvar BlockQuote = forwardRef(function (props, ref) {\r\n    var className = props.className, initialProps = props.initialProps, useListenProps = props.useListenProps;\r\n    useListenProps(handlePropsUpdate);\r\n    var _a = useState(__assign({}, initialProps.attrs)), attrs = _a[0], setAttrs = _a[1];\r\n    function handlePropsUpdate(newProps) {\r\n        // console.log(newProps)\r\n    }\r\n    return (React.createElement(StyledBlockQuote, { className: className, ref: ref }));\r\n});\r\nvar StyledBlockQuote = styled.blockquote(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\n  box-sizing: border-box;\\n  color: #6a737d;\\n  padding: 0 1em;\\n  border-left: 4px solid #dfe2e5;\\n  margin: 0.2rem 0 0 0;\\n  margin-right: 0;\\n\\n  [dir='rtl'] & {\\n    padding-left: 0;\\n    padding-right: 4px;\\n  }\\n\\n  &:first-child {\\n    margin-top: 0;\\n  }\\n\\n  &::before {\\n    content: '';\\n  }\\n\\n  &::after {\\n    content: none;\\n  }\\n\\n  & p {\\n    display: block;\\n  }\\n\\n  & table,\\n  & table:last-child {\\n    display: inline-table;\\n  }\\n\"], [\"\\n  box-sizing: border-box;\\n  color: #6a737d;\\n  padding: 0 1em;\\n  border-left: 4px solid #dfe2e5;\\n  margin: 0.2rem 0 0 0;\\n  margin-right: 0;\\n\\n  [dir='rtl'] & {\\n    padding-left: 0;\\n    padding-right: 4px;\\n  }\\n\\n  &:first-child {\\n    margin-top: 0;\\n  }\\n\\n  &::before {\\n    content: '';\\n  }\\n\\n  &::after {\\n    content: none;\\n  }\\n\\n  & p {\\n    display: block;\\n  }\\n\\n  & table,\\n  & table:last-child {\\n    display: inline-table;\\n  }\\n\"])));\r\nvar templateObject_1;\n\nvar BlockQuoteView = /** @class */ (function (_super) {\r\n    __extends(BlockQuoteView, _super);\r\n    function BlockQuoteView() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    BlockQuoteView.prototype.createContentDOM = function () {\r\n        var contentDOM = document.createElement('div');\r\n        contentDOM.classList.add(this.node.type.name + \"__content-dom\");\r\n        return contentDOM;\r\n    };\r\n    return BlockQuoteView;\r\n}(ReactNodeView));\r\nfunction blockQuoteNodeView(portalProvider, pluginsProvider, options) {\r\n    return function (node, view, getPos) {\r\n        return new BlockQuoteView(node, view, getPos, portalProvider, pluginsProvider, {\r\n            options: options,\r\n        }, BlockQuote).init();\r\n    };\r\n}\n\nfunction findBlockQuote(state, selection) {\r\n    var blockquote = state.schema.nodes.blockquote;\r\n    return (findSelectedNodeOfType(blockquote)(selection || state.selection) ||\r\n        findParentNodeOfType(blockquote)(selection || state.selection));\r\n}\n\nvar blockquotePluginKey = new PluginKey('blockQuotePlugin');\r\nfunction blockQuotePluginFactory(portalProvider, pluginsProvider, options) {\r\n    return new Plugin({\r\n        state: {\r\n            init: function (_, state) {\r\n                return {\r\n                    blockQuoteActive: false,\r\n                };\r\n            },\r\n            apply: function (tr, pluginState, _oldState, newState) {\r\n                if (tr.docChanged || tr.selectionSet) {\r\n                    var blockQuoteActive = !!findBlockQuote(newState, newState.selection);\r\n                    // const blockQuoteDisabled = !(\r\n                    //   blockQuoteActive ||\r\n                    //   isWrappingPossible(newState.schema.blockquote, newState)\r\n                    // )\r\n                    if (blockQuoteActive !== pluginState.blockQuoteActive) {\r\n                        var nextPluginState = __assign(__assign({}, pluginState), { blockQuoteActive: blockQuoteActive });\r\n                        pluginsProvider.publish(blockquotePluginKey, nextPluginState);\r\n                        return nextPluginState;\r\n                    }\r\n                }\r\n                return pluginState;\r\n            },\r\n        },\r\n        key: blockquotePluginKey,\r\n        props: {\r\n            nodeViews: {\r\n                blockquote: blockQuoteNodeView(portalProvider, pluginsProvider, options),\r\n            },\r\n        },\r\n    });\r\n}\n\nvar result = {\r\n    mac: false,\r\n    ie: false,\r\n    ie_version: 0,\r\n    gecko: false,\r\n    chrome: false,\r\n    chrome_version: 0,\r\n    android: false,\r\n    ios: false,\r\n    webkit: false,\r\n};\r\nif (typeof navigator !== 'undefined') {\r\n    var ieEdge = /Edge\\/(\\d+)/.exec(navigator.userAgent);\r\n    var ieUpTo10 = /MSIE \\d/.test(navigator.userAgent);\r\n    var ie11up = /Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(navigator.userAgent);\r\n    result.mac = /Mac/.test(navigator.platform);\r\n    var ie = (result.ie = !!(ieUpTo10 || ie11up || ieEdge));\r\n    result.ie_version = ieUpTo10\r\n        ? document.documentMode || 6\r\n        : ie11up\r\n            ? +ie11up[1]\r\n            : ieEdge\r\n                ? +ieEdge[1]\r\n                : null;\r\n    result.gecko = !ie && /gecko\\/\\d/i.test(navigator.userAgent);\r\n    result.chrome = !ie && /Chrome\\//.test(navigator.userAgent);\r\n    result.chrome_version = parseInt((navigator.userAgent.match(/Chrome\\/(\\d{2})/) || [])[1], 10);\r\n    result.android = /Android \\d/.test(navigator.userAgent);\r\n    result.ios =\r\n        !ie &&\r\n            /AppleWebKit/.test(navigator.userAgent) &&\r\n            /Mobile\\/\\w+/.test(navigator.userAgent);\r\n    result.webkit =\r\n        !ie &&\r\n            !!document.documentElement &&\r\n            'WebkitAppearance' in document.documentElement.style;\r\n}\n\nvar toggleBold = makeKeyMapWithCommon('Bold', 'Mod-b');\r\nvar toggleItalic = makeKeyMapWithCommon('Italic', 'Mod-i');\r\nvar toggleUnderline = makeKeyMapWithCommon('Underline', 'Mod-u');\r\nvar toggleCode = makeKeyMapWithCommon('Code', 'Mod-Shift-m');\r\nvar setNormalText = makeKeyMapWithCommon('Normal text', 'Mod-Alt-0');\r\nvar toggleHeading1 = makeKeyMapWithCommon('Heading 1', 'Mod-Alt-1');\r\nvar toggleBlockQuote = makeKeyMapWithCommon('Quote', 'Ctrl-Alt-b');\r\nvar insertNewLine = makeKeyMapWithCommon('Insert new line', 'Shift-Enter');\r\nvar shiftBackspace = makeKeyMapWithCommon('Shift Backspace', 'Shift-Backspace');\r\nvar splitCodeBlock = makeKeyMapWithCommon('Split code block', 'Enter');\r\nvar undo = makeKeyMapWithCommon('Undo', 'Mod-z');\r\nvar moveUp = makeKeyMapWithCommon('Move up', 'ArrowUp');\r\nvar moveDown = makeKeyMapWithCommon('Move down', 'ArrowDown');\r\nvar moveLeft = makeKeyMapWithCommon('Move left', 'ArrowLeft');\r\nvar moveRight = makeKeyMapWithCommon('Move right', 'ArrowRight');\r\nvar openHelp = makeKeyMapWithCommon('Open Help', 'Mod-/');\r\nvar addLink = makeKeyMapWithCommon('Link', 'Mod-k');\r\nvar addInlineComment = makeKeyMapWithCommon('Annotate', 'Mod-Alt-c');\r\nvar submit = makeKeyMapWithCommon('Submit Content', 'Mod-Enter');\r\nvar enter = makeKeyMapWithCommon('Enter', 'Enter');\r\nvar shiftEnter = makeKeyMapWithCommon('Shift Enter', 'Shift-Enter');\r\nvar tab = makeKeyMapWithCommon('Tab', 'Tab');\r\nvar backspace = makeKeyMapWithCommon('Backspace', 'Backspace');\r\nvar deleteKey = makeKeyMapWithCommon('Delete', 'Delete');\r\nvar space = makeKeyMapWithCommon('Space', 'Space');\r\nvar escape = makeKeyMapWithCommon('Escape', 'Escape');\r\nvar nextCell = makeKeyMapWithCommon('Next cell', 'Tab');\r\nvar previousCell = makeKeyMapWithCommon('Previous cell', 'Shift-Tab');\r\nvar toggleTable = makeKeyMapWithCommon('Table', 'Shift-Alt-t');\r\nvar cut = makeKeyMapWithCommon('Cut', 'Mod-x');\r\nvar copy = makeKeyMapWithCommon('Copy', 'Mod-c');\r\nvar paste = makeKeyMapWithCommon('Paste', 'Mod-v');\r\nvar altPaste = makeKeyMapWithCommon('Paste', 'Mod-Shift-v');\r\nvar find = makeKeyMapWithCommon('Find', 'Mod-f');\r\nfunction makeKeymap(description, windows, mac, common) {\r\n    return {\r\n        description: description,\r\n        windows: windows,\r\n        mac: mac,\r\n        common: common,\r\n    };\r\n}\r\nfunction makeKeyMapWithCommon(description, common) {\r\n    var windows = common.replace(/Mod/i, 'Ctrl');\r\n    var mac = common.replace(/Mod/i, 'Cmd');\r\n    return makeKeymap(description, windows, mac, common);\r\n}\r\nfunction bindKeymapWithCommand(shortcut, cmd, keymap) {\r\n    var oldCmd = keymap[shortcut];\r\n    var newCmd = cmd;\r\n    if (keymap[shortcut]) {\r\n        newCmd = function (state, dispatch, editorView) {\r\n            return oldCmd(state, dispatch) || cmd(state, dispatch, editorView);\r\n        };\r\n    }\r\n    keymap[shortcut] = newCmd;\r\n}\n\nvar createNewBlockQuote = function () { return function (state, dispatch) {\r\n    var _a = state.selection, $from = _a.$from, $to = _a.$to;\r\n    var blockquote = state.schema.nodes.blockquote;\r\n    var empty = blockquote.createAndFill();\r\n    var endOfBlock = $from.end();\r\n    if (empty && dispatch) {\r\n        var tr = state.tr.insert(endOfBlock + 1, empty);\r\n        dispatch(tr);\r\n    }\r\n    return false;\r\n}; };\n\nfunction keymapPlugin() {\r\n    var keymapObj = {};\r\n    bindKeymapWithCommand(toggleBlockQuote.common, createNewBlockQuote(), keymapObj);\r\n    return keymap(keymapObj);\r\n}\n\nvar blockQuotePlugin = function (options) {\r\n    if (options === void 0) { options = {}; }\r\n    return ({\r\n        name: 'blockquote',\r\n        nodes: function () {\r\n            return [{ name: 'blockquote', node: blockquote }];\r\n        },\r\n        pmPlugins: function () {\r\n            var plugins = [\r\n                {\r\n                    name: 'blockquote',\r\n                    plugin: function (_a) {\r\n                        var portalProvider = _a.portalProvider, pluginsProvider = _a.pluginsProvider;\r\n                        return blockQuotePluginFactory(portalProvider, pluginsProvider, options);\r\n                    },\r\n                },\r\n                { name: 'blockquoteKeyMap', plugin: function () { return keymapPlugin(); } },\r\n            ];\r\n            return plugins;\r\n        },\r\n        pluginsOptions: {},\r\n    });\r\n};\n\nvar Preset = /** @class */ (function () {\r\n    function Preset() {\r\n        this.plugins = [];\r\n    }\r\n    Preset.prototype.add = function (plugin) {\r\n        this.plugins.push(plugin);\r\n        return this;\r\n    };\r\n    Preset.prototype.has = function (plugin) {\r\n        return this.plugins.some(function (pluginPreset) {\r\n            if (Array.isArray(pluginPreset)) {\r\n                return pluginPreset[0] === plugin;\r\n            }\r\n            return pluginPreset === plugin;\r\n        });\r\n    };\r\n    Preset.prototype.getEditorPlugins = function (excludes) {\r\n        var editorPlugins = this.processEditorPlugins();\r\n        return this.removeExcludedPlugins(editorPlugins, excludes);\r\n    };\r\n    Preset.prototype.processEditorPlugins = function () {\r\n        var cache = new Map();\r\n        this.plugins.forEach(function (pluginEntry) {\r\n            if (Array.isArray(pluginEntry)) {\r\n                var fn = pluginEntry[0], options = pluginEntry[1];\r\n                cache.set(fn, options);\r\n            }\r\n            else {\r\n                /**\r\n                 * Prevent usage of same plugin twice without override.\r\n                 * [\r\n                 *  plugin1,\r\n                 *  [plugin1, { option1: value }],\r\n                 *  plugin1, // This will throw\r\n                 * ]\r\n                 */\r\n                if (cache.has(pluginEntry) && cache.get(pluginEntry) === undefined) {\r\n                    throw new Error(pluginEntry + \" is already included!\");\r\n                }\r\n                cache.set(pluginEntry, undefined);\r\n            }\r\n        });\r\n        var plugins = [];\r\n        cache.forEach(function (options, fn) {\r\n            plugins.push(fn(options));\r\n        });\r\n        return plugins;\r\n    };\r\n    Preset.prototype.removeExcludedPlugins = function (plugins, excludes) {\r\n        if (excludes) {\r\n            return plugins.filter(function (plugin) { return !plugin || !excludes.has(plugin.name); });\r\n        }\r\n        return plugins;\r\n    };\r\n    return Preset;\r\n}());\n\nfunction createDefaultEditorPlugins(props, prevProps) {\r\n    var preset = new Preset();\r\n    preset.add(basePlugin);\r\n    preset.add(blockQuotePlugin);\r\n    return preset.getEditorPlugins();\r\n}\n\nvar ranks = {\r\n    plugins: [\r\n        'underline',\r\n        'blockquote',\r\n        'quickInsert',\r\n        'typeAhead',\r\n    ],\r\n    nodes: [\r\n        'doc',\r\n        'paragraph',\r\n        'text',\r\n        'bulletList',\r\n        'orderedList',\r\n        'listItem',\r\n        'heading',\r\n        'blockquote',\r\n        'pmBlockquote',\r\n        'codeBlock',\r\n    ],\r\n    marks: [\r\n        // Inline marks\r\n        'link',\r\n        'em',\r\n        'strong',\r\n        'textColor',\r\n        'strike',\r\n        'subsup',\r\n        'underline',\r\n        'code',\r\n        'typeAheadQuery',\r\n        // Block marks\r\n        'alignment',\r\n        'breakout',\r\n        'indentation',\r\n        'annotation',\r\n        //Unsupported mark\r\n        'unsupportedMark',\r\n        'unsupportedNodeAttribute',\r\n    ],\r\n};\r\nfunction sortByOrder(item) {\r\n    return function (a, b) {\r\n        return ranks[item].indexOf(a.name) - ranks[item].indexOf(b.name);\r\n    };\r\n}\n\nfunction fixExcludes(marks) {\r\n    var markKeys = Object.keys(marks);\r\n    var markGroups = new Set(markKeys.map(function (mark) { return marks[mark].group; }));\r\n    markKeys.forEach(function (markKey) {\r\n        var mark = marks[markKey];\r\n        if (mark.excludes) {\r\n            mark.excludes = mark.excludes\r\n                .split(' ')\r\n                .filter(function (group) { return markGroups.has(group); })\r\n                .join(' ');\r\n        }\r\n    });\r\n    return marks;\r\n}\r\nfunction processPluginsList(plugins) {\r\n    /**\r\n     * First pass to collect pluginsOptions\r\n     */\r\n    var pluginsOptions = plugins.reduce(function (acc, plugin) {\r\n        if (plugin.pluginsOptions) {\r\n            Object.keys(plugin.pluginsOptions).forEach(function (pluginName) {\r\n                if (!acc[pluginName]) {\r\n                    acc[pluginName] = [];\r\n                }\r\n                acc[pluginName].push(plugin.pluginsOptions[pluginName]);\r\n            });\r\n        }\r\n        return acc;\r\n    }, {});\r\n    /**\r\n     * Process plugins\r\n     */\r\n    return plugins.reduce(function (acc, plugin) {\r\n        var _a, _b, _c;\r\n        if (plugin.pmPlugins) {\r\n            (_a = acc.pmPlugins).push.apply(_a, plugin.pmPlugins(plugin.name ? pluginsOptions[plugin.name] : undefined));\r\n        }\r\n        if (plugin.nodes) {\r\n            (_b = acc.nodes).push.apply(_b, plugin.nodes());\r\n        }\r\n        if (plugin.marks) {\r\n            (_c = acc.marks).push.apply(_c, plugin.marks());\r\n        }\r\n        return acc;\r\n    }, {\r\n        nodes: [],\r\n        marks: [],\r\n        pmPlugins: [],\r\n    });\r\n}\r\nfunction createPMPlugins(config) {\r\n    var editorConfig = config.editorConfig, rest = __rest(config, [\"editorConfig\"]);\r\n    return editorConfig.pmPlugins\r\n        .sort(sortByOrder('plugins'))\r\n        .map(function (_a) {\r\n        var plugin = _a.plugin;\r\n        return plugin(rest);\r\n    })\r\n        .filter(function (plugin) { return typeof plugin !== 'undefined'; });\r\n}\n\nfunction createSchema(editorConfig) {\r\n    var createdMarks = fixExcludes(editorConfig.marks.sort(sortByOrder('marks')).reduce(function (acc, mark) {\r\n        acc[mark.name] = mark.mark;\r\n        return acc;\r\n    }, {}));\r\n    var createdNodes = editorConfig.nodes.sort(sortByOrder('nodes')).reduce(function (acc, node) {\r\n        acc[node.name] = node.node;\r\n        return acc;\r\n    }, {});\r\n    return new Schema({ nodes: createdNodes, marks: createdMarks });\r\n}\n\n/**\r\n * Finds all top level nodes affected by the transaction\r\n * Uses from/to positions in transaction's steps to work out which nodes will\r\n * be changed by the transaction\r\n */\r\nvar findChangedNodesFromTransaction = function (tr) {\r\n    var nodes = [];\r\n    var steps = (tr.steps || []);\r\n    steps.forEach(function (step) {\r\n        var to = step.to, from = step.from, slice = step.slice;\r\n        var size = slice && slice.content ? slice.content.size : 0;\r\n        var _loop_1 = function (i) {\r\n            if (i <= tr.doc.content.size) {\r\n                var topLevelNode_1 = tr.doc.resolve(i).node(1);\r\n                if (topLevelNode_1 && !nodes.find(function (n) { return n === topLevelNode_1; })) {\r\n                    nodes.push(topLevelNode_1);\r\n                }\r\n            }\r\n        };\r\n        for (var i = from; i <= to + size; i++) {\r\n            _loop_1(i);\r\n        }\r\n    });\r\n    return nodes;\r\n};\r\nvar validNode = function (node) {\r\n    try {\r\n        node.check(); // this will throw an error if the node is invalid\r\n    }\r\n    catch (error) {\r\n        return false;\r\n    }\r\n    return true;\r\n};\r\n/** Validates prosemirror nodes, and returns true only if all nodes are valid */\r\nvar validateNodes = function (nodes) {\r\n    return nodes.every(validNode);\r\n};\r\nvar SelectedState;\r\n(function (SelectedState) {\r\n    SelectedState[SelectedState[\"selectedInRange\"] = 0] = \"selectedInRange\";\r\n    SelectedState[SelectedState[\"selectedInside\"] = 1] = \"selectedInside\";\r\n})(SelectedState || (SelectedState = {}));\n\nvar getDocStructure = function (doc) {\r\n    try {\r\n        return getBlockNode(doc, 0);\r\n    }\r\n    catch (error) {\r\n        return \"Error logging document structure: \" + error;\r\n    }\r\n};\r\nvar getBlockNode = function (node, pos) {\r\n    var blockNode = {\r\n        type: node.type.name,\r\n        pos: pos,\r\n        nodeSize: node.nodeSize,\r\n    };\r\n    var content = getBlockNodeContent(node.content, pos);\r\n    if (content.length > 0) {\r\n        blockNode.content = content;\r\n    }\r\n    var marks = getMarks(node);\r\n    if (marks.length > 0) {\r\n        blockNode.marks = marks;\r\n    }\r\n    return blockNode;\r\n};\r\nvar getBlockNodeContent = function (node, pos) {\r\n    if (!node || !node.content || !node.content.length) {\r\n        return [];\r\n    }\r\n    var blockNodeContent = [];\r\n    var content = node.content;\r\n    if (content[0].isBlock) {\r\n        // children are block nodes\r\n        var prevNode_1;\r\n        blockNodeContent = content.map(function (node) {\r\n            pos += prevNode_1 ? prevNode_1.nodeSize : 1;\r\n            prevNode_1 = node;\r\n            return getBlockNode(node, pos);\r\n        });\r\n    }\r\n    else {\r\n        // children are inline nodes\r\n        var result = getInlineNodes(content, pos);\r\n        blockNodeContent = result.inlineNodes;\r\n        pos = result.pos;\r\n    }\r\n    return blockNodeContent;\r\n};\r\nvar getInlineNodes = function (nodes, pos) {\r\n    var inlineNodes = nodes.map(function (node) {\r\n        var nodeSize = node.nodeSize;\r\n        var inlineNode = {\r\n            type: node.type.name,\r\n            pos: pos,\r\n            nodeSize: nodeSize,\r\n        };\r\n        var marks = getMarks(node);\r\n        if (marks.length > 0) {\r\n            inlineNode.marks = marks;\r\n        }\r\n        pos += nodeSize;\r\n        return inlineNode;\r\n    });\r\n    return { inlineNodes: inlineNodes, pos: pos };\r\n};\r\nvar getMarks = function (node) {\r\n    return node.marks.map(function (mark) { return mark.type.name; });\r\n};\n\nvar useSsrLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect;\n\nfunction ReactEditorView(props) {\r\n    var editorProps = props.editorProps, EditorLayoutComponent = props.EditorLayoutComponent;\r\n    var _a = useEditorContext(), viewProvider = _a.viewProvider, pluginsProvider = _a.pluginsProvider, portalProvider = _a.portalProvider, analyticsProvider = _a.analyticsProvider;\r\n    var editorViewRef = useRef(null);\r\n    var _b = useState(true), canDispatchTransactions = _b[0], setCanDispatchTransactions = _b[1];\r\n    useSsrLayoutEffect(function () {\r\n        var state = createEditorState();\r\n        var editorViewDOM = editorViewRef.current;\r\n        if (editorViewDOM) {\r\n            var pmEditorProps = createDirectEditorProps(state);\r\n            var view = createEditorView(editorViewDOM, pmEditorProps);\r\n            viewProvider.init(view);\r\n            editorProps.onEditorReady && editorProps.onEditorReady(viewProvider);\r\n        }\r\n    }, []);\r\n    function createEditorState() {\r\n        var editorPlugins = createDefaultEditorPlugins();\r\n        var config = processPluginsList(editorPlugins);\r\n        var schema = createSchema(config);\r\n        var plugins = createPMPlugins({\r\n            schema: schema,\r\n            editorConfig: config,\r\n            portalProvider: portalProvider,\r\n            pluginsProvider: pluginsProvider,\r\n        });\r\n        return EditorState.create({\r\n            schema: schema,\r\n            plugins: plugins,\r\n        });\r\n    }\r\n    function createEditorView(element, editorProps) {\r\n        var view = new EditorView({ mount: element }, editorProps);\r\n        applyDevTools(view);\r\n        return view;\r\n    }\r\n    function createDirectEditorProps(state) {\r\n        return {\r\n            state: state,\r\n            dispatchTransaction: function (tr) {\r\n                // Block stale transactions:\r\n                // Prevent runtime exceptions from async transactions that would attempt to\r\n                // update the DOM after React has unmounted the Editor.\r\n                if (canDispatchTransactions) {\r\n                    dispatchTransaction(tr);\r\n                }\r\n            },\r\n            // Disables the contentEditable attribute of the editor if the editor is disabled\r\n            editable: function (_state) { return !editorProps.disabled; },\r\n            attributes: { 'data-gramm': 'false' },\r\n        };\r\n    }\r\n    function dispatchTransaction(transaction) {\r\n        var editorView = viewProvider.editorView;\r\n        if (!editorView) {\r\n            return;\r\n        }\r\n        var shouldTrack = editorProps.shouldTrack;\r\n        analyticsProvider.perf.warn('EditorView', 'dispatchTransaction');\r\n        var nodes = findChangedNodesFromTransaction(transaction);\r\n        var changedNodesValid = validateNodes(nodes);\r\n        if (changedNodesValid) {\r\n            var oldEditorState = editorView.state;\r\n            // go ahead and update the state now we know the transaction is good\r\n            analyticsProvider.perf.info('EditorView', 'dispatchTransaction state::apply');\r\n            var editorState = editorView.state.apply(transaction);\r\n            analyticsProvider.perf.stop('EditorView', 'dispatchTransaction state::apply', 200);\r\n            if (editorState === oldEditorState) {\r\n                // I don't think it's possible for the React nodeviews to change without changing PM editorState but\r\n                // it's better to be safe than sorry I guess.\r\n                portalProvider.flush();\r\n                return;\r\n            }\r\n            analyticsProvider.perf.warn('EditorView', 'dispatchTransaction updateState');\r\n            editorView.updateState(editorState);\r\n            analyticsProvider.perf.stop('EditorView', 'dispatchTransaction updateState', 100);\r\n            analyticsProvider.perf.debug('EditorView', 'dispatchTransaction flush');\r\n            portalProvider.flush();\r\n            analyticsProvider.perf.stop('EditorView', 'dispatchTransaction flush', 0);\r\n            editorProps.onDocumentEdit && editorProps.onDocumentEdit(editorView);\r\n        }\r\n        else {\r\n            var invalidNodes = nodes\r\n                .filter(function (node) { return !validNode(node); })\r\n                .map(function (node) { return getDocStructure(node); });\r\n            if (shouldTrack) {\r\n                console.error('Invalid nodes in transaction');\r\n                console.log(transaction);\r\n                console.log(invalidNodes);\r\n            }\r\n        }\r\n        analyticsProvider.perf.stop('EditorView', 'dispatchTransaction', 1000);\r\n    }\r\n    return (React.createElement(EditorLayoutComponent, null,\r\n        React.createElement(\"div\", { ref: editorViewRef })));\r\n}\n\nfunction MarkButtonEl(props) {\r\n    var className = props.className, active = props.active, name = props.name, icon = props.icon, onClick = props.onClick;\r\n    return (React.createElement(Button, { className: className, active: active, name: name, onClick: onClick },\r\n        React.createElement(SvgWrapper, null, icon)));\r\n}\r\nvar SvgWrapper = styled.span(templateObject_1$1 || (templateObject_1$1 = __makeTemplateObject([\"\\n  display: flex;\\n\"], [\"\\n  display: flex;\\n\"])));\r\nvar Button = styled.button(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"\\n  background: \", \";\\n  border: \", \";\\n  cursor: pointer;\\n  display: flex;\\n  margin-right: 5px;\\n  padding: 1px;\\n  &:hover {\\n    background: #f0f8ff;\\n    opacity: 0.6;\\n  }\\n\"], [\"\\n  background: \", \";\\n  border: \", \";\\n  cursor: pointer;\\n  display: flex;\\n  margin-right: 5px;\\n  padding: 1px;\\n  &:hover {\\n    background: #f0f8ff;\\n    opacity: 0.6;\\n  }\\n\"])), function (props) { return props.active ? '#f0f8ff' : 'transparent'; }, function (props) { return props.active ? '1px solid #5a6ecd' : '1px solid transparent'; });\r\nvar MarkButton = styled(MarkButtonEl)(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"\"], [\"\"])));\r\nvar templateObject_1$1, templateObject_2, templateObject_3;\n\n// function markActive(state, type) {\r\n//   let {from, $from, to, empty} = state.selection\r\n//   if (empty) return type.isInSet(state.storedMarks || $from.marks())\r\n//   else return state.doc.rangeHasMark(from, to, type)\r\n// }\r\nfunction Toolbar(props) {\r\n    // Iterate over primaryToolbarComponents here\r\n    var _a = useEditorContext(), viewProvider = _a.viewProvider, pluginsProvider = _a.pluginsProvider;\r\n    var _b = useState([]), currentMarks = _b[0], setCurrentMarks = _b[1];\r\n    useEffect(function () {\r\n        pluginsProvider.subscribe(basePluginKey, onBasePluginChange);\r\n        return function () {\r\n            pluginsProvider.unsubscribe(basePluginKey, onBasePluginChange);\r\n        };\r\n    }, []);\r\n    function onBasePluginChange(newPluginState) {\r\n        setCurrentMarks(newPluginState.activeMarks);\r\n    }\r\n    function toggleBold() {\r\n        viewProvider.execCommand(toggleMark(viewProvider.editorView.state.schema.marks.strong));\r\n    }\r\n    function toggleItalics() {\r\n        viewProvider.execCommand(toggleMark(viewProvider.editorView.state.schema.marks.em));\r\n    }\r\n    return (React.createElement(Container, null,\r\n        React.createElement(TopRow, null,\r\n            React.createElement(MarkButton, { active: currentMarks.includes('strong'), name: \"bold\", icon: React.createElement(MdFormatBold, { size: 24 }), onClick: toggleBold }),\r\n            React.createElement(MarkButton, { active: currentMarks.includes('em'), name: \"italics\", icon: React.createElement(MdFormatItalic, { size: 24 }), onClick: toggleItalics }))));\r\n}\r\nvar Container = styled.div(templateObject_1$2 || (templateObject_1$2 = __makeTemplateObject([\"\\n  background: snow;\\n  border: 1px solid black;\\n  border-bottom: 0;\\n  padding: 10px;\\n\"], [\"\\n  background: snow;\\n  border: 1px solid black;\\n  border-bottom: 0;\\n  padding: 10px;\\n\"])));\r\nvar TopRow = styled.div(templateObject_2$1 || (templateObject_2$1 = __makeTemplateObject([\"\\n  display: flex;\\n\"], [\"\\n  display: flex;\\n\"])));\r\nvar templateObject_1$2, templateObject_2$1;\n\nfunction FullPage(props) {\r\n    var className = props.className, children = props.children;\r\n    return (React.createElement(Container$1, { className: className },\r\n        React.createElement(Toolbar, null),\r\n        React.createElement(ContentArea, null, children)));\r\n}\r\nvar Container$1 = styled.div(templateObject_1$3 || (templateObject_1$3 = __makeTemplateObject([\"\"], [\"\"])));\r\nvar ContentArea = styled.div(templateObject_2$2 || (templateObject_2$2 = __makeTemplateObject([\"\\nborder: 1px solid black;\\n& > .ProseMirror {\\n  min-height: 140px;\\n  overflow-wrap: break-word;\\n  outline: none;\\n  padding: 10px;\\n  white-space: pre-wrap;\\n}\\n\\n.pm-blockquote {\\n  box-sizing: border-box;\\n  color: #2d82e1;\\n  padding: 0 1em;\\n  border-left: 4px solid #48a1fa;\\n  margin: 0.2rem 0 0 0;\\n  margin-right: 0;\\n}\\n\"], [\"\\nborder: 1px solid black;\\n& > .ProseMirror {\\n  min-height: 140px;\\n  overflow-wrap: break-word;\\n  outline: none;\\n  padding: 10px;\\n  white-space: pre-wrap;\\n}\\n\\n.pm-blockquote {\\n  box-sizing: border-box;\\n  color: #2d82e1;\\n  padding: 0 1em;\\n  border-left: 4px solid #48a1fa;\\n  margin: 0.2rem 0 0 0;\\n  margin-right: 0;\\n}\\n\"])));\r\nvar templateObject_1$3, templateObject_2$2;\n\nvar components = {\r\n    'full-page': FullPage,\r\n};\r\nfunction Editor(props) {\r\n    var _a = props.appearance, appearance = _a === void 0 ? 'full-page' : _a;\r\n    // These three have to be inside useMemos for SSR compatibility\r\n    var viewProvider = useMemo(function () { return new EditorViewProvider; }, []);\r\n    var portalProvider = useMemo(function () { return new PortalProvider; }, []);\r\n    var pluginsProvider = useMemo(function () { return new PluginsProvider; }, []);\r\n    var analyticsProvider = useMemo(function () { return new AnalyticsProvider(props.analytics); }, []);\r\n    var Component = useMemo(function () { return components[appearance]; }, [appearance]);\r\n    useEffect(function () {\r\n    }, []);\r\n    return (React.createElement(EditorContext.Provider, { value: {\r\n            viewProvider: viewProvider,\r\n            portalProvider: portalProvider,\r\n            pluginsProvider: pluginsProvider,\r\n            analyticsProvider: analyticsProvider\r\n        } },\r\n        React.createElement(ReactEditorView, { editorProps: props, EditorLayoutComponent: Component })));\r\n}\r\nEditor.displayName = 'FullEditor';\n\nexport { Editor, EditorViewProvider };\n","import * as React from 'react'\nimport styled from 'styled-components'\n\ninterface IProps {\n  className?: string\n  children: React.ReactNode\n}\n\nexport function PageHeader(props: IProps) {\n  const { className, children } = props\n  return (\n    <Container className={className}>\n      <header>\n        <h1><a href=\"https://teemukoivisto.github.io/prosemirror-react-typescript-example/\">\n          ProseMirror React Typescript Example</a></h1>\n        <p>Demo application to show how to combine ProseMirror with React</p>\n        <p><a href=\"https://github.com/TeemuKoivisto/prosemirror-react-typescript-example\">Github repo</a></p>\n      </header>\n      <div>\n        <ul>\n          <li><b>Ctrl + alt + b</b>: New blockquote</li>\n          <li><b>Ctrl + alt + p</b>: New ProseMirror-managed blockquote</li>\n          <li><strong>Enter (Ctrl + alt + s</strong> also for full): Split current block</li>\n          <li><b>/</b>: Quick insert (Atlassian editor only)</li>\n        </ul>\n        { children }\n      </div>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n`\n","import React, { useMemo, useState } from 'react'\nimport styled from 'styled-components'\nimport debounce from 'lodash.debounce'\n\nimport { Editor, EditorViewProvider, JSONEditorState } from 'full'\n\nimport { PageHeader } from '../components/PageHeader'\n\ninterface IProps {\n  className?: string\n}\n\nclass EditorStore {\n\n  viewProvider?: EditorViewProvider\n  currentEditorState?: JSONEditorState\n  STORAGE_KEY = 'full-editor-state'\n\n  constructor() {\n    if (typeof window !== 'undefined') {\n      const existing = localStorage.getItem(this.STORAGE_KEY)\n      if (existing && existing !== null && existing.length > 0) {\n        let stored = JSON.parse(existing)\n        this.currentEditorState = stored\n      }\n    }\n  }\n\n  setEditorView = (viewProvider: EditorViewProvider) => {\n    this.viewProvider = viewProvider\n    if (this.currentEditorState) {\n      viewProvider.replaceState(this.currentEditorState)\n    }\n  }\n\n  syncCurrentEditorState = () => {\n    const newState = this.viewProvider!.stateToJSON()\n    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(newState))\n  }\n}\n\nexport function FrontPage(props: IProps) {\n  const { className } = props\n  const editorStore = useMemo(() => new EditorStore(), [])\n  const debouncedSync = useMemo(() => debounce(editorStore.syncCurrentEditorState, 500), [])\n\n  function handleDocumentEdit() {\n    debouncedSync()\n  }\n  function handleEditorReady(viewProvider: EditorViewProvider) {\n    editorStore.setEditorView(viewProvider)\n  }\n  return (\n    <Container className={className}>\n      <PageHeader>\n        <Editor\n          analytics={{\n            shouldTrack: true,\n            logLevel: 'debug',\n            logToConsole: true,\n          }}\n          onDocumentEdit={handleDocumentEdit}\n          onEditorReady={handleEditorReady}\n        />\n      </PageHeader>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n`\n","import { createElement, createRef, Component } from 'react';\nimport { EditorState } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\nimport { Schema } from 'prosemirror-model';\nimport { history } from 'prosemirror-history';\nimport { keymap } from 'prosemirror-keymap';\nimport { baseKeymap } from 'prosemirror-commands';\nimport ReactDOM from 'react-dom';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\n\nvar schema = new Schema({\r\n    nodes: {\r\n        doc: {\r\n            content: 'block+'\r\n        },\r\n        paragraph: {\r\n            content: 'inline*',\r\n            group: 'block',\r\n            selectable: false,\r\n            parseDOM: [{ tag: 'p' }],\r\n            toDOM: function () {\r\n                return ['p', 0];\r\n            },\r\n        },\r\n        pmBlockquote: {\r\n            content: 'paragraph+',\r\n            group: 'block',\r\n            defining: true,\r\n            selectable: false,\r\n            attrs: {\r\n                class: { default: 'pm-blockquote' },\r\n            },\r\n            parseDOM: [{ tag: 'blockquote' }],\r\n            toDOM: function (node) {\r\n                return ['blockquote', node.attrs, 0];\r\n            },\r\n        },\r\n        blockquote: {\r\n            content: 'paragraph+',\r\n            group: 'block',\r\n            defining: true,\r\n            selectable: false,\r\n            parseDOM: [{ tag: 'blockquote' }],\r\n            toDOM: function () {\r\n                return ['blockquote', 0];\r\n            },\r\n        },\r\n        text: {\r\n            group: 'inline'\r\n        },\r\n    }\r\n});\n\nfunction createNewBlockQuote(state, dispatch) {\r\n    var _a = state.selection, $from = _a.$from, $to = _a.$to;\r\n    var blockquote = state.schema.nodes.blockquote;\r\n    var empty = blockquote.createAndFill();\r\n    var endOfBlock = $from.end();\r\n    if (empty && dispatch) {\r\n        var tr = state.tr.insert(endOfBlock + 1, empty);\r\n        dispatch(tr);\r\n    }\r\n    return false;\r\n}\r\nfunction createNewPmBlockQuote(state, dispatch) {\r\n    var _a = state.selection, $from = _a.$from, $to = _a.$to;\r\n    var blockquote = state.schema.nodes.pmBlockquote;\r\n    var empty = blockquote.createAndFill();\r\n    var endOfBlock = $from.end();\r\n    if (empty && dispatch) {\r\n        var tr = state.tr.insert(endOfBlock + 1, empty);\r\n        dispatch(tr);\r\n    }\r\n    return false;\r\n}\n\nvar plugins = function () {\r\n    var plugins = [];\r\n    plugins.push(history());\r\n    plugins.push(keymap(baseKeymap));\r\n    plugins.push(keymap({\r\n        'Ctrl-Alt-b': createNewBlockQuote,\r\n        'Ctrl-Alt-p': createNewPmBlockQuote,\r\n    }));\r\n    return plugins;\r\n};\n\nfunction styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".blockquote {\\n  box-sizing: border-box;\\n  color: #6a737d;\\n  padding: 0 1em;\\n  border-left: 4px solid #dfe2e5;\\n  margin: 0.2rem 0 0 0;\\n  margin-right: 0; }\\n\";\nstyleInject(css_248z);\n\n// Copied from here https://gist.github.com/esmevane/7326b19e20a5670954b51ea8618d096d\r\n// Here we have the (too simple) React component which\r\n// we'll be rendering content into.\r\n//\r\nvar BlockQuote = /** @class */ (function (_super) {\r\n    __extends(BlockQuote, _super);\r\n    function BlockQuote(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.hole = createRef();\r\n        return _this;\r\n    }\r\n    // We'll put the content into what we render using\r\n    // this function, which appends a given node to\r\n    // a ref HTMLElement, if present.\r\n    //\r\n    BlockQuote.prototype.append = function (node) {\r\n        if (this.hole) {\r\n            this.hole.current.appendChild(node);\r\n        }\r\n    };\r\n    BlockQuote.prototype.render = function () {\r\n        // The styled components version is basically just a wrapper to do SCSS styling.\r\n        // Questionable if it's even needed for such simple styling and because you can't clearly see the \r\n        // DOM structure from the code (hence making `& > ${Component}` selectors quite unintuitive) \r\n        return createElement(\"blockquote\", { ref: this.hole, className: \"blockquote\" });\r\n    };\r\n    return BlockQuote;\r\n}(Component));\n\n// Copied from here https://gist.github.com/esmevane/7326b19e20a5670954b51ea8618d096d\r\n// This class is our actual interactor for ProseMirror itself.\r\n// It glues DOM rendering, React, and ProseMirror nodes together.\r\n//\r\nvar BlockQuoteView = /** @class */ (function () {\r\n    function BlockQuoteView(node, view, getPos, decorations) {\r\n        var _this = this;\r\n        // This is the least complex part.  Now we've put\r\n        // all of our interlocking pieces behind refs and\r\n        // instance properties, this becomes the callback\r\n        // which performs the actual shell game.\r\n        //\r\n        this.putContentDomInRef = function () {\r\n            _this.ref.current.append(_this.contentDOM);\r\n        };\r\n        this.attrs = node.attrs;\r\n        this.node = node;\r\n        this.view = view;\r\n        this.getPos = getPos;\r\n        this.decorations = decorations;\r\n        // We'll use this to access our Underlined component's \r\n        // instance methods.\r\n        //\r\n        this.ref = createRef();\r\n        // Here, we'll provide a container to render React into.\r\n        // Coincidentally, this is where ProseMirror will put its\r\n        // generated contentDOM.  React will throw out that content\r\n        // once rendered, and at the same time we'll append it into\r\n        // the component tree, like a fancy shell game.  This isn't\r\n        // obvious to the user, but would it be more obvious on an\r\n        // expensive render?\r\n        //\r\n        this.dom = document.createElement('span');\r\n        // Finally, we provide an element to render content into.\r\n        // We will be moving this node around as we need to.\r\n        //\r\n        this.contentDOM = document.createElement('span');\r\n        // Just example classes to help see the structure in the DOM\r\n        this.dom.classList.add('node__dom');\r\n        this.contentDOM.classList.add('node__content-dom');\r\n        // Better way of doing this would be portals https://reactjs.org/docs/portals.html\r\n        ReactDOM.render(createElement(BlockQuote, { ref: this.ref }), this.dom, this.putContentDomInRef);\r\n    }\r\n    BlockQuoteView.prototype.update = function (node) {\r\n        return true;\r\n    };\r\n    // Required to not to leave the React nodes orphaned.\r\n    BlockQuoteView.prototype.destroy = function () {\r\n        ReactDOM.unmountComponentAtNode(this.dom);\r\n    };\r\n    return BlockQuoteView;\r\n}());\n\nvar nodeViews = {\r\n    blockquote: function (node, view, getPos, decorations) { return new BlockQuoteView(node, view, getPos, decorations); },\r\n};\n\nvar css_248z$1 = \"#minimal-editor {\\n  border: 1px solid black; }\\n  #minimal-editor > .ProseMirror {\\n    min-height: 140px;\\n    overflow-wrap: break-word;\\n    outline: none;\\n    padding: 10px;\\n    white-space: pre-wrap; }\\n  #minimal-editor .pm-blockquote {\\n    box-sizing: border-box;\\n    color: #2d82e1;\\n    padding: 0 1em;\\n    border-left: 4px solid #48a1fa;\\n    margin: 0.2rem 0 0 0;\\n    margin-right: 0; }\\n\";\nstyleInject(css_248z$1);\n\nvar Editor = /** @class */ (function (_super) {\r\n    __extends(Editor, _super);\r\n    function Editor(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.createEditorView = function (element) {\r\n            if (element != null) {\r\n                _this.editorView = new EditorView(element, {\r\n                    nodeViews: nodeViews,\r\n                    state: _this.editorState,\r\n                });\r\n            }\r\n        };\r\n        _this.editorState = EditorState.create({\r\n            schema: schema,\r\n            plugins: plugins(),\r\n        });\r\n        _this.editorRef = createRef();\r\n        return _this;\r\n    }\r\n    Editor.prototype.componentDidMount = function () {\r\n        this.createEditorView(this.editorRef.current);\r\n        this.forceUpdate();\r\n    };\r\n    Editor.prototype.componentWillUnmount = function () {\r\n        if (this.editorView) {\r\n            this.editorView.destroy();\r\n        }\r\n    };\r\n    Editor.prototype.shouldComponentUpdate = function () {\r\n        return false;\r\n    };\r\n    Editor.prototype.render = function () {\r\n        return createElement(\"div\", { id: \"minimal-editor\", ref: this.editorRef });\r\n    };\r\n    return Editor;\r\n}(Component));\n\nexport { Editor };\n","import * as React from 'react'\nimport styled from 'styled-components'\n\nimport { Editor } from 'minimal'\n\nimport { PageHeader } from '../components/PageHeader'\n\ninterface IProps {\n  className?: string\n}\n\nexport function MinimalPage(props: IProps) {\n  const { className } = props\n  return (\n    <Container className={className}>\n      <PageHeader>\n        <Editor />\n      </PageHeader>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n`\n","import React, { forwardRef, useRef, useState, useMemo, useEffect } from 'react';\nimport applyDevTools from 'prosemirror-dev-tools';\nimport { NodeSelection, TextSelection, PluginKey, Plugin, Selection, EditorState } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\nimport { history } from 'prosemirror-history';\nimport { keymap } from 'prosemirror-keymap';\nimport { baseKeymap, toggleMark } from 'prosemirror-commands';\nimport { canSplit } from 'prosemirror-transform';\nimport { Fragment, Node, Schema } from 'prosemirror-model';\nimport styled, { css, ThemeProvider } from 'styled-components';\nimport { findSelectedNodeOfType, findParentNodeOfType, safeInsert } from 'prosemirror-utils';\nimport Fuse from 'fuse.js';\nimport PropTypes from 'prop-types';\nimport { InputRule, inputRules } from 'prosemirror-inputrules';\nimport rafSchedule from 'raf-schd';\nimport { createPortal, unstable_renderSubtreeIntoContainer, unmountComponentAtNode } from 'react-dom';\nimport DevIcon from '@atlaskit/icon/glyph/editor/code';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\nfunction __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n}\n\n// https://bitbucket.org/atlassian/atlassian-frontend-mirror/src/master/editor/editor-core/src/event-dispatcher/index.ts\r\nvar EventDispatcher = /** @class */ (function () {\r\n    function EventDispatcher() {\r\n        this.listeners = {};\r\n    }\r\n    EventDispatcher.prototype.on = function (event, cb) {\r\n        if (!this.listeners[event]) {\r\n            this.listeners[event] = new Set();\r\n        }\r\n        this.listeners[event].add(cb);\r\n    };\r\n    EventDispatcher.prototype.off = function (event, cb) {\r\n        if (!this.listeners[event]) {\r\n            return;\r\n        }\r\n        if (this.listeners[event].has(cb)) {\r\n            this.listeners[event].delete(cb);\r\n        }\r\n    };\r\n    EventDispatcher.prototype.emit = function (event, data) {\r\n        if (!this.listeners[event]) {\r\n            return;\r\n        }\r\n        this.listeners[event].forEach(function (cb) { return cb(data); });\r\n    };\r\n    EventDispatcher.prototype.destroy = function () {\r\n        this.listeners = {};\r\n    };\r\n    return EventDispatcher;\r\n}());\r\n/**\r\n * Creates a dispatch function that can be called inside ProseMirror Plugin\r\n * to notify listeners about that plugin's state change.\r\n */\r\nfunction createDispatch(eventDispatcher) {\r\n    return function (eventName, data) {\r\n        if (!eventName) {\r\n            throw new Error('event name is required!');\r\n        }\r\n        var event = typeof eventName === 'string'\r\n            ? eventName\r\n            : eventName.key;\r\n        eventDispatcher.emit(event, data);\r\n    };\r\n}\n\nvar hasRequiredPerformanceAPIs;\r\nfunction isPerformanceAPIAvailable() {\r\n    if (hasRequiredPerformanceAPIs === undefined) {\r\n        hasRequiredPerformanceAPIs =\r\n            typeof window !== 'undefined' &&\r\n                'performance' in window &&\r\n                [\r\n                    'measure',\r\n                    'clearMeasures',\r\n                    'clearMarks',\r\n                    'getEntriesByName',\r\n                    'getEntriesByType',\r\n                    'now',\r\n                ].every(function (api) { return !!performance[api]; });\r\n    }\r\n    return hasRequiredPerformanceAPIs;\r\n}\n\nvar measureMap = new Map();\r\nfunction startMeasure(measureName) {\r\n    if (!isPerformanceAPIAvailable()) {\r\n        return;\r\n    }\r\n    performance.mark(measureName + \"::start\");\r\n    measureMap.set(measureName, performance.now());\r\n}\r\nfunction stopMeasure(measureName, onMeasureComplete) {\r\n    if (!isPerformanceAPIAvailable()) {\r\n        return;\r\n    }\r\n    performance.mark(measureName + \"::end\");\r\n    var start = onMeasureComplete ? measureMap.get(measureName) : undefined;\r\n    try {\r\n        performance.measure(measureName, measureName + \"::start\", measureName + \"::end\");\r\n    }\r\n    catch (error) {\r\n    }\r\n    finally {\r\n        if (onMeasureComplete) {\r\n            var entry = performance.getEntriesByName(measureName).pop();\r\n            if (entry) {\r\n                onMeasureComplete(entry.duration, entry.startTime);\r\n            }\r\n            else if (start) {\r\n                onMeasureComplete(performance.now() - start, start);\r\n            }\r\n        }\r\n        clearMeasure(measureName);\r\n    }\r\n}\r\nfunction clearMeasure(measureName) {\r\n    if (!isPerformanceAPIAvailable()) {\r\n        return;\r\n    }\r\n    measureMap.delete(measureName);\r\n    performance.clearMarks(measureName + \"::start\");\r\n    performance.clearMarks(measureName + \"::end\");\r\n    performance.clearMeasures(measureName);\r\n}\n\n/**\r\n * Finds all top level nodes affected by the transaction\r\n * Uses from/to positions in transaction's steps to work out which nodes will\r\n * be changed by the transaction\r\n */\r\nvar findChangedNodesFromTransaction = function (tr) {\r\n    var nodes = [];\r\n    var steps = (tr.steps || []);\r\n    steps.forEach(function (step) {\r\n        var to = step.to, from = step.from, slice = step.slice;\r\n        var size = slice && slice.content ? slice.content.size : 0;\r\n        var _loop_1 = function (i) {\r\n            if (i <= tr.doc.content.size) {\r\n                var topLevelNode_1 = tr.doc.resolve(i).node(1);\r\n                if (topLevelNode_1 && !nodes.find(function (n) { return n === topLevelNode_1; })) {\r\n                    nodes.push(topLevelNode_1);\r\n                }\r\n            }\r\n        };\r\n        for (var i = from; i <= to + size; i++) {\r\n            _loop_1(i);\r\n        }\r\n    });\r\n    return nodes;\r\n};\r\nvar validNode = function (node) {\r\n    try {\r\n        node.check(); // this will throw an error if the node is invalid\r\n    }\r\n    catch (error) {\r\n        return false;\r\n    }\r\n    return true;\r\n};\r\n/** Validates prosemirror nodes, and returns true only if all nodes are valid */\r\nvar validateNodes = function (nodes) {\r\n    return nodes.every(validNode);\r\n};\r\nvar SelectedState;\r\n(function (SelectedState) {\r\n    SelectedState[SelectedState[\"selectedInRange\"] = 0] = \"selectedInRange\";\r\n    SelectedState[SelectedState[\"selectedInside\"] = 1] = \"selectedInside\";\r\n})(SelectedState || (SelectedState = {}));\n\nvar getDocStructure = function (doc) {\r\n    try {\r\n        return getBlockNode(doc, 0);\r\n    }\r\n    catch (error) {\r\n        return \"Error logging document structure: \" + error;\r\n    }\r\n};\r\nvar getBlockNode = function (node, pos) {\r\n    var blockNode = {\r\n        type: node.type.name,\r\n        pos: pos,\r\n        nodeSize: node.nodeSize,\r\n    };\r\n    var content = getBlockNodeContent(node.content, pos);\r\n    if (content.length > 0) {\r\n        blockNode.content = content;\r\n    }\r\n    var marks = getMarks(node);\r\n    if (marks.length > 0) {\r\n        blockNode.marks = marks;\r\n    }\r\n    return blockNode;\r\n};\r\nvar getBlockNodeContent = function (node, pos) {\r\n    if (!node || !node.content || !node.content.length) {\r\n        return [];\r\n    }\r\n    var blockNodeContent = [];\r\n    var content = node.content;\r\n    if (content[0].isBlock) {\r\n        // children are block nodes\r\n        var prevNode_1;\r\n        blockNodeContent = content.map(function (node) {\r\n            pos += prevNode_1 ? prevNode_1.nodeSize : 1;\r\n            prevNode_1 = node;\r\n            return getBlockNode(node, pos);\r\n        });\r\n    }\r\n    else {\r\n        // children are inline nodes\r\n        var result = getInlineNodes(content, pos);\r\n        blockNodeContent = result.inlineNodes;\r\n        pos = result.pos;\r\n    }\r\n    return blockNodeContent;\r\n};\r\nvar getInlineNodes = function (nodes, pos) {\r\n    var inlineNodes = nodes.map(function (node) {\r\n        var nodeSize = node.nodeSize;\r\n        var inlineNode = {\r\n            type: node.type.name,\r\n            pos: pos,\r\n            nodeSize: nodeSize,\r\n        };\r\n        var marks = getMarks(node);\r\n        if (marks.length > 0) {\r\n            inlineNode.marks = marks;\r\n        }\r\n        pos += nodeSize;\r\n        return inlineNode;\r\n    });\r\n    return { inlineNodes: inlineNodes, pos: pos };\r\n};\r\nvar getMarks = function (node) {\r\n    return node.marks.map(function (mark) { return mark.type.name; });\r\n};\n\nvar ranks = {\r\n    plugins: [\r\n        'underline',\r\n        'blockquote',\r\n        'quickInsert',\r\n        'typeAhead',\r\n    ],\r\n    nodes: [\r\n        'doc',\r\n        'paragraph',\r\n        'text',\r\n        'bulletList',\r\n        'orderedList',\r\n        'listItem',\r\n        'heading',\r\n        'blockquote',\r\n        'codeBlock',\r\n    ],\r\n    marks: [\r\n        // Inline marks\r\n        'link',\r\n        'em',\r\n        'strong',\r\n        'textColor',\r\n        'strike',\r\n        'subsup',\r\n        'underline',\r\n        'code',\r\n        'typeAheadQuery',\r\n        // Block marks\r\n        'alignment',\r\n        'breakout',\r\n        'indentation',\r\n        'annotation',\r\n        //Unsupported mark\r\n        'unsupportedMark',\r\n        'unsupportedNodeAttribute',\r\n    ],\r\n};\r\nfunction sortByOrder(item) {\r\n    return function (a, b) {\r\n        return ranks[item].indexOf(a.name) - ranks[item].indexOf(b.name);\r\n    };\r\n}\n\nfunction fixExcludes(marks) {\r\n    var markKeys = Object.keys(marks);\r\n    var markGroups = new Set(markKeys.map(function (mark) { return marks[mark].group; }));\r\n    markKeys.forEach(function (markKey) {\r\n        var mark = marks[markKey];\r\n        if (mark.excludes) {\r\n            mark.excludes = mark.excludes\r\n                .split(' ')\r\n                .filter(function (group) { return markGroups.has(group); })\r\n                .join(' ');\r\n        }\r\n    });\r\n    return marks;\r\n}\r\nfunction processPluginsList(plugins) {\r\n    /**\r\n     * First pass to collect pluginsOptions\r\n     */\r\n    var pluginsOptions = plugins.reduce(function (acc, plugin) {\r\n        if (plugin.pluginsOptions) {\r\n            Object.keys(plugin.pluginsOptions).forEach(function (pluginName) {\r\n                if (!acc[pluginName]) {\r\n                    acc[pluginName] = [];\r\n                }\r\n                acc[pluginName].push(plugin.pluginsOptions[pluginName]);\r\n            });\r\n        }\r\n        return acc;\r\n    }, {});\r\n    /**\r\n     * Process plugins\r\n     */\r\n    return plugins.reduce(function (acc, plugin) {\r\n        var _a, _b, _c;\r\n        if (plugin.pmPlugins) {\r\n            (_a = acc.pmPlugins).push.apply(_a, plugin.pmPlugins(plugin.name ? pluginsOptions[plugin.name] : undefined));\r\n        }\r\n        if (plugin.nodes) {\r\n            (_b = acc.nodes).push.apply(_b, plugin.nodes());\r\n        }\r\n        if (plugin.marks) {\r\n            (_c = acc.marks).push.apply(_c, plugin.marks());\r\n        }\r\n        if (plugin.contentComponent) {\r\n            acc.contentComponents.push(plugin.contentComponent);\r\n        }\r\n        if (plugin.primaryToolbarComponent) {\r\n            acc.primaryToolbarComponents.push(plugin.primaryToolbarComponent);\r\n        }\r\n        // if (plugin.secondaryToolbarComponent) {\r\n        //   acc.secondaryToolbarComponents.push(plugin.secondaryToolbarComponent);\r\n        // }\r\n        return acc;\r\n    }, {\r\n        nodes: [],\r\n        marks: [],\r\n        pmPlugins: [],\r\n        contentComponents: [],\r\n        primaryToolbarComponents: [],\r\n    });\r\n}\r\nfunction createPMPlugins(config) {\r\n    var editorConfig = config.editorConfig, rest = __rest(config, [\"editorConfig\"]);\r\n    return editorConfig.pmPlugins\r\n        .sort(sortByOrder('plugins'))\r\n        .map(function (_a) {\r\n        var plugin = _a.plugin;\r\n        return plugin(rest);\r\n    })\r\n        .filter(function (plugin) { return typeof plugin !== 'undefined'; });\r\n}\n\nvar doc = {\r\n    content: 'block+',\r\n};\n\nvar blockquote = {\r\n    content: 'paragraph+',\r\n    group: 'block',\r\n    defining: true,\r\n    selectable: false,\r\n    parseDOM: [{ tag: 'blockquote' }],\r\n    toDOM: function () {\r\n        return ['blockquote', 0];\r\n    },\r\n};\n\n/**\r\n * NOTE: Need this because TS is too smart and inline everything.\r\n * So we need to give them separate identity.\r\n * Probably there's a way to solve it but that will need time and exploration.\r\n * // http://bit.ly/2raXFX5\r\n * type T1 = X | Y\r\n * type T2 = A | T1 | B // T2 = A | X | Y | B\r\n */\r\n// export type ParagraphWithMarksDefinition =\r\n//   | ParagraphWithAlignmentDefinition\r\n//   | ParagraphWithIndentationDefinition;\r\nvar paragraph = {\r\n    content: 'inline*',\r\n    group: 'block',\r\n    selectable: false,\r\n    // marks:\r\n    // 'strong code em link strike subsup textColor underline unsupportedMark unsupportedNodeAttribute',\r\n    parseDOM: [{ tag: 'p' }],\r\n    toDOM: function () {\r\n        return ['p', 0];\r\n    },\r\n};\n\nvar text = {\r\n    group: 'inline',\r\n    toDebugString: process.env.NODE_ENV !== 'production' ? undefined : function () { return 'text_node'; },\r\n};\n\nfunction splitBlock(state, dispatch) {\r\n    var _a = state.selection, $from = _a.$from, $to = _a.$to;\r\n    if (state.selection instanceof NodeSelection && state.selection.node.isBlock) {\r\n        if (!$from.parentOffset || !canSplit(state.doc, $from.pos))\r\n            return false;\r\n        if (dispatch)\r\n            dispatch(state.tr.split($from.pos).scrollIntoView());\r\n        return true;\r\n    }\r\n    if (!$from.parent.isBlock)\r\n        return false;\r\n    if (dispatch) {\r\n        var atEnd = $to.parentOffset == $to.parent.content.size;\r\n        var tr = state.tr;\r\n        if (state.selection instanceof TextSelection)\r\n            tr.deleteSelection();\r\n        var deflt = $from.depth == 0 ? undefined : $from.node(-1).contentMatchAt($from.indexAfter(-1)).defaultType;\r\n        var types = atEnd && deflt ? [{ type: deflt }] : undefined;\r\n        var can = canSplit(tr.doc, tr.mapping.map($from.pos), 1, types);\r\n        if (!types && !can && deflt && canSplit(tr.doc, tr.mapping.map($from.pos), 1, deflt && [{ type: deflt }])) {\r\n            types = [{ type: deflt }];\r\n            can = true;\r\n        }\r\n        if (can && deflt) {\r\n            tr.split(tr.mapping.map($from.pos), 1, types);\r\n            var isStuff = !atEnd && !$from.parentOffset && $from.parent.type != deflt;\r\n            var canReplace = $from.node(-1).canReplace($from.index(-1), $from.indexAfter(-1), Fragment.from(deflt.create()));\r\n            if (isStuff && canReplace) {\r\n                tr.setNodeMarkup(tr.mapping.map($from.before()), deflt);\r\n            }\r\n        }\r\n        dispatch(tr.scrollIntoView());\r\n    }\r\n    return true;\r\n}\r\nfunction createParagraphNear(state, dispatch) {\r\n    var _a = state.selection, $from = _a.$from, $to = _a.$to;\r\n    if ($from.parent.inlineContent || $to.parent.inlineContent)\r\n        return false;\r\n    var type = $from.parent.contentMatchAt($to.indexAfter()).defaultType;\r\n    if (!type || !type.isTextblock)\r\n        return false;\r\n    var empty = type.createAndFill();\r\n    debugger;\r\n    if (dispatch && empty) {\r\n        var side = (!$from.parentOffset && $to.index() < $to.parent.childCount ? $from : $to).pos;\r\n        var tr = state.tr.insert(side, empty);\r\n        tr.setSelection(TextSelection.create(tr.doc, side + 1));\r\n        dispatch(tr.scrollIntoView());\r\n    }\r\n    return true;\r\n}\n\nvar basePlugin = function (options) { return ({\r\n    name: 'base',\r\n    pmPlugins: function () {\r\n        var plugins = [\r\n            { name: 'history', plugin: function () { return history(); } },\r\n            { name: 'baseKeyMap', plugin: function () { return keymap(baseKeymap); } },\r\n            {\r\n                name: 'otherKeyMap',\r\n                plugin: function () { return keymap({\r\n                    'Ctrl-Alt-p': createParagraphNear,\r\n                    'Ctrl-Alt-s': splitBlock,\r\n                }); }\r\n            },\r\n        ];\r\n        return plugins;\r\n    },\r\n    nodes: function () {\r\n        return [\r\n            { name: 'doc', node: doc },\r\n            { name: 'paragraph', node: paragraph },\r\n            { name: 'text', node: text },\r\n        ];\r\n    },\r\n}); };\n\nvar ReactNodeView = /** @class */ (function () {\r\n    function ReactNodeView(node, view, getPos, portalProviderAPI, eventDispatcher, reactComponentProps, reactComponent, hasContext, viewShouldUpdate) {\r\n        var _this = this;\r\n        if (hasContext === void 0) { hasContext = false; }\r\n        this.handleRef = function (node) { return _this._handleRef(node); };\r\n        this.node = node;\r\n        this.view = view;\r\n        this.getPos = getPos;\r\n        this.portalProviderAPI = portalProviderAPI;\r\n        this.reactComponentProps = reactComponentProps || {};\r\n        this.reactComponent = reactComponent;\r\n        this.hasContext = hasContext;\r\n        this._viewShouldUpdate = viewShouldUpdate;\r\n        this.eventDispatcher = eventDispatcher;\r\n    }\r\n    /**\r\n     * This method exists to move initialization logic out of the constructor,\r\n     * so object can be initialized properly before calling render first time.\r\n     *\r\n     * Example:\r\n     * Instance properties get added to an object only after super call in\r\n     * constructor, which leads to some methods being undefined during the\r\n     * first render.\r\n     */\r\n    ReactNodeView.prototype.init = function () {\r\n        var _this = this;\r\n        this.domRef = this.createDomRef();\r\n        this.setDomAttrs(this.node, this.domRef);\r\n        var _a = this.getContentDOM() || {\r\n            dom: undefined,\r\n            contentDOM: undefined,\r\n        }, contentDOMWrapper = _a.dom, contentDOM = _a.contentDOM;\r\n        if (this.domRef && contentDOMWrapper) {\r\n            this.domRef.appendChild(contentDOMWrapper);\r\n            this.contentDOM = contentDOM ? contentDOM : contentDOMWrapper;\r\n            this.contentDOMWrapper = contentDOMWrapper || contentDOM;\r\n        }\r\n        // @see ED-3790\r\n        // something gets messed up during mutation processing inside of a\r\n        // nodeView if DOM structure has nested plain \"div\"s, it doesn't see the\r\n        // difference between them and it kills the nodeView\r\n        this.domRef.classList.add(this.node.type.name + \"View-content-wrap\");\r\n        this.renderReactComponent(function () {\r\n            return _this.render(_this.reactComponentProps, _this.handleRef);\r\n        });\r\n        return this;\r\n    };\r\n    ReactNodeView.prototype.renderReactComponent = function (component) {\r\n        if (!this.domRef || !component) {\r\n            return;\r\n        }\r\n        this.portalProviderAPI.render(component, this.domRef, this.hasContext);\r\n    };\r\n    ReactNodeView.prototype.createDomRef = function () {\r\n        return this.node.isInline\r\n            ? document.createElement('span')\r\n            : document.createElement('div');\r\n    };\r\n    ReactNodeView.prototype.getContentDOM = function () {\r\n        return undefined;\r\n    };\r\n    ReactNodeView.prototype._handleRef = function (node) {\r\n        var contentDOM = this.contentDOMWrapper || this.contentDOM;\r\n        // move the contentDOM node inside the inner reference after rendering\r\n        if (node && contentDOM && !node.contains(contentDOM)) {\r\n            node.appendChild(contentDOM);\r\n        }\r\n    };\r\n    ReactNodeView.prototype.render = function (props, forwardRef) {\r\n        return this.reactComponent ? (React.createElement(this.reactComponent, __assign({ view: this.view, getPos: this.getPos, node: this.node, forwardRef: forwardRef }, props))) : null;\r\n    };\r\n    ReactNodeView.prototype.update = function (node, _decorations, validUpdate) {\r\n        var _this = this;\r\n        if (validUpdate === void 0) { validUpdate = function () { return true; }; }\r\n        // @see https://github.com/ProseMirror/prosemirror/issues/648\r\n        var isValidUpdate = this.node.type === node.type && validUpdate(this.node, node);\r\n        if (!isValidUpdate) {\r\n            return false;\r\n        }\r\n        if (this.domRef && !this.node.sameMarkup(node)) {\r\n            this.setDomAttrs(node, this.domRef);\r\n        }\r\n        // View should not process a re-render if this is false.\r\n        // We dont want to destroy the view, so we return true.\r\n        if (!this.viewShouldUpdate(node)) {\r\n            this.node = node;\r\n            return true;\r\n        }\r\n        this.node = node;\r\n        this.renderReactComponent(function () {\r\n            return _this.render(_this.reactComponentProps, _this.handleRef);\r\n        });\r\n        return true;\r\n    };\r\n    ReactNodeView.prototype.viewShouldUpdate = function (nextNode) {\r\n        if (this._viewShouldUpdate) {\r\n            return this._viewShouldUpdate(nextNode);\r\n        }\r\n        return true;\r\n    };\r\n    /**\r\n     * Copies the attributes from a ProseMirror Node to a DOM node.\r\n     * @param node The Prosemirror Node from which to source the attributes\r\n     */\r\n    ReactNodeView.prototype.setDomAttrs = function (node, element) {\r\n        Object.keys(node.attrs || {}).forEach(function (attr) {\r\n            element.setAttribute(attr, node.attrs[attr]);\r\n        });\r\n    };\r\n    Object.defineProperty(ReactNodeView.prototype, \"dom\", {\r\n        get: function () {\r\n            return this.domRef;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    ReactNodeView.prototype.destroy = function () {\r\n        if (!this.domRef) {\r\n            return;\r\n        }\r\n        this.portalProviderAPI.remove(this.domRef);\r\n        this.domRef = undefined;\r\n        this.contentDOM = undefined;\r\n    };\r\n    ReactNodeView.fromComponent = function (component, portalProviderAPI, eventDispatcher, props, viewShouldUpdate) {\r\n        return function (node, view, getPos) {\r\n            return new ReactNodeView(node, view, getPos, portalProviderAPI, eventDispatcher, props, component, false, viewShouldUpdate).init();\r\n        };\r\n    };\r\n    return ReactNodeView;\r\n}());\n\nvar BlockQuote = forwardRef(function (props, ref) {\r\n    return (React.createElement(StyledBlockQuote, { ref: ref }));\r\n});\r\nvar StyledBlockQuote = styled.blockquote(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\n  box-sizing: border-box;\\n  color: #6a737d;\\n  padding: 0 1em;\\n  border-left: 4px solid #dfe2e5;\\n  margin: 0.2rem 0 0 0;\\n  margin-right: 0;\\n\\n  [dir='rtl'] & {\\n    padding-left: 0;\\n    padding-right: 4px;\\n  }\\n\\n  &:first-child {\\n    margin-top: 0;\\n  }\\n\\n  &::before {\\n    content: '';\\n  }\\n\\n  &::after {\\n    content: none;\\n  }\\n\\n  & p {\\n    display: block;\\n  }\\n\\n  & table,\\n  & table:last-child {\\n    display: inline-table;\\n  }\\n\"], [\"\\n  box-sizing: border-box;\\n  color: #6a737d;\\n  padding: 0 1em;\\n  border-left: 4px solid #dfe2e5;\\n  margin: 0.2rem 0 0 0;\\n  margin-right: 0;\\n\\n  [dir='rtl'] & {\\n    padding-left: 0;\\n    padding-right: 4px;\\n  }\\n\\n  &:first-child {\\n    margin-top: 0;\\n  }\\n\\n  &::before {\\n    content: '';\\n  }\\n\\n  &::after {\\n    content: none;\\n  }\\n\\n  & p {\\n    display: block;\\n  }\\n\\n  & table,\\n  & table:last-child {\\n    display: inline-table;\\n  }\\n\"])));\r\nvar templateObject_1;\n\nvar BlockQuoteView = /** @class */ (function (_super) {\r\n    __extends(BlockQuoteView, _super);\r\n    function BlockQuoteView() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    BlockQuoteView.prototype.getContentDOM = function () {\r\n        var dom = document.createElement('div');\r\n        dom.classList.add(this.node.type.name + \"-dom-wrapper\");\r\n        return {\r\n            dom: dom\r\n        };\r\n    };\r\n    BlockQuoteView.prototype.render = function (_props, forwardRef) {\r\n        return (React.createElement(BlockQuote, { ref: forwardRef }));\r\n    };\r\n    return BlockQuoteView;\r\n}(ReactNodeView));\r\nfunction blockQuoteNodeView(portalProviderAPI, eventDispatcher, \r\n// providerFactory: ProviderFactory,\r\noptions) {\r\n    return function (node, view, getPos) {\r\n        return new BlockQuoteView(node, view, getPos, portalProviderAPI, eventDispatcher, {\r\n            // providerFactory,\r\n            options: options,\r\n        }).init();\r\n    };\r\n}\n\nfunction findBlockQuote(state, selection) {\r\n    var blockquote = state.schema.nodes.blockquote;\r\n    return (findSelectedNodeOfType(blockquote)(selection || state.selection) ||\r\n        findParentNodeOfType(blockquote)(selection || state.selection));\r\n}\n\nvar blockquotePluginKey = new PluginKey('blockQuotePlugin');\r\n// export type CodeBlockStateSubscriber = (state: BlockQuoteState) => any;\r\nfunction blockQuotePluginFactory(dispatch, \r\n// providerFactory: ProviderFactory,\r\nportalProviderAPI, eventDispatcher, options) {\r\n    return new Plugin({\r\n        state: {\r\n            init: function (_, state) {\r\n                return {\r\n                    blockQuoteActive: false,\r\n                };\r\n            },\r\n            apply: function (tr, pluginState, _oldState, newState) {\r\n                if (tr.docChanged || tr.selectionSet) {\r\n                    var blockQuoteActive = !!findBlockQuote(newState, newState.selection);\r\n                    // const blockQuoteDisabled = !(\r\n                    //   blockQuoteActive ||\r\n                    //   isWrappingPossible(newState.schema.blockquote, newState)\r\n                    // )\r\n                    if (blockQuoteActive !== pluginState.blockQuoteActive) {\r\n                        var nextPluginState = __assign(__assign({}, pluginState), { blockQuoteActive: blockQuoteActive });\r\n                        dispatch(blockquotePluginKey, nextPluginState);\r\n                        return nextPluginState;\r\n                    }\r\n                }\r\n                return pluginState;\r\n            },\r\n        },\r\n        key: blockquotePluginKey,\r\n        props: {\r\n            nodeViews: {\r\n                blockquote: blockQuoteNodeView(portalProviderAPI, eventDispatcher, options),\r\n            },\r\n        },\r\n    });\r\n}\n\nvar result = {\r\n    mac: false,\r\n    ie: false,\r\n    ie_version: 0,\r\n    gecko: false,\r\n    chrome: false,\r\n    chrome_version: 0,\r\n    android: false,\r\n    ios: false,\r\n    webkit: false,\r\n};\r\nif (typeof navigator !== 'undefined') {\r\n    var ieEdge = /Edge\\/(\\d+)/.exec(navigator.userAgent);\r\n    var ieUpTo10 = /MSIE \\d/.test(navigator.userAgent);\r\n    var ie11up = /Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(navigator.userAgent);\r\n    result.mac = /Mac/.test(navigator.platform);\r\n    var ie = (result.ie = !!(ieUpTo10 || ie11up || ieEdge));\r\n    result.ie_version = ieUpTo10\r\n        ? document.documentMode || 6\r\n        : ie11up\r\n            ? +ie11up[1]\r\n            : ieEdge\r\n                ? +ieEdge[1]\r\n                : null;\r\n    result.gecko = !ie && /gecko\\/\\d/i.test(navigator.userAgent);\r\n    result.chrome = !ie && /Chrome\\//.test(navigator.userAgent);\r\n    result.chrome_version = parseInt((navigator.userAgent.match(/Chrome\\/(\\d{2})/) || [])[1], 10);\r\n    result.android = /Android \\d/.test(navigator.userAgent);\r\n    result.ios =\r\n        !ie &&\r\n            /AppleWebKit/.test(navigator.userAgent) &&\r\n            /Mobile\\/\\w+/.test(navigator.userAgent);\r\n    result.webkit =\r\n        !ie &&\r\n            !!document.documentElement &&\r\n            'WebkitAppearance' in document.documentElement.style;\r\n}\r\nvar browser = result;\r\nfunction getUAPrefix() {\r\n    if (browser.chrome) {\r\n        return 'ua-chrome';\r\n    }\r\n    else if (browser.ie) {\r\n        return 'ua-ie';\r\n    }\r\n    else if (browser.gecko) {\r\n        return 'ua-firefox';\r\n    }\r\n    return '';\r\n}\n\nvar toggleBold = makeKeyMapWithCommon('Bold', 'Mod-b');\r\nvar toggleItalic = makeKeyMapWithCommon('Italic', 'Mod-i');\r\nvar toggleUnderline = makeKeyMapWithCommon('Underline', 'Mod-u');\r\nvar toggleCode = makeKeyMapWithCommon('Code', 'Mod-Shift-m');\r\nvar setNormalText = makeKeyMapWithCommon('Normal text', 'Mod-Alt-0');\r\nvar toggleHeading1 = makeKeyMapWithCommon('Heading 1', 'Mod-Alt-1');\r\nvar toggleBlockQuote = makeKeyMapWithCommon('Quote', 'Ctrl-Alt-b');\r\nvar insertNewLine = makeKeyMapWithCommon('Insert new line', 'Shift-Enter');\r\nvar shiftBackspace = makeKeyMapWithCommon('Shift Backspace', 'Shift-Backspace');\r\nvar splitCodeBlock = makeKeyMapWithCommon('Split code block', 'Enter');\r\nvar undo = makeKeyMapWithCommon('Undo', 'Mod-z');\r\nvar moveUp = makeKeyMapWithCommon('Move up', 'ArrowUp');\r\nvar moveDown = makeKeyMapWithCommon('Move down', 'ArrowDown');\r\nvar moveLeft = makeKeyMapWithCommon('Move left', 'ArrowLeft');\r\nvar moveRight = makeKeyMapWithCommon('Move right', 'ArrowRight');\r\nvar openHelp = makeKeyMapWithCommon('Open Help', 'Mod-/');\r\nvar addLink = makeKeyMapWithCommon('Link', 'Mod-k');\r\nvar addInlineComment = makeKeyMapWithCommon('Annotate', 'Mod-Alt-c');\r\nvar submit = makeKeyMapWithCommon('Submit Content', 'Mod-Enter');\r\nvar enter = makeKeyMapWithCommon('Enter', 'Enter');\r\nvar shiftEnter = makeKeyMapWithCommon('Shift Enter', 'Shift-Enter');\r\nvar tab = makeKeyMapWithCommon('Tab', 'Tab');\r\nvar backspace = makeKeyMapWithCommon('Backspace', 'Backspace');\r\nvar deleteKey = makeKeyMapWithCommon('Delete', 'Delete');\r\nvar space = makeKeyMapWithCommon('Space', 'Space');\r\nvar escape = makeKeyMapWithCommon('Escape', 'Escape');\r\nvar nextCell = makeKeyMapWithCommon('Next cell', 'Tab');\r\nvar previousCell = makeKeyMapWithCommon('Previous cell', 'Shift-Tab');\r\nvar toggleTable = makeKeyMapWithCommon('Table', 'Shift-Alt-t');\r\nvar cut = makeKeyMapWithCommon('Cut', 'Mod-x');\r\nvar copy = makeKeyMapWithCommon('Copy', 'Mod-c');\r\nvar paste = makeKeyMapWithCommon('Paste', 'Mod-v');\r\nvar altPaste = makeKeyMapWithCommon('Paste', 'Mod-Shift-v');\r\nvar find = makeKeyMapWithCommon('Find', 'Mod-f');\r\nvar arrowKeysMap = {\r\n    // for reference: https://wincent.com/wiki/Unicode_representations_of_modifier_keys\r\n    ARROWLEFT: '\\u2190',\r\n    ARROWRIGHT: '\\u2192',\r\n    ARROWUP: '\\u2191',\r\n    ARROWDOWN: '\\u2193',\r\n};\r\nvar TooltipShortcut = styled.span(templateObject_1$1 || (templateObject_1$1 = __makeTemplateObject([\"\\n  border-radius: 2px;\\n  background-color: blue;\\n  padding: 0 2px;\\n\"], [\"\\n  border-radius: 2px;\\n  background-color: blue;\\n  padding: 0 2px;\\n\"])));\r\nfunction formatShortcut(keymap) {\r\n    var shortcut;\r\n    if (browser.mac) {\r\n        // for reference: https://wincent.com/wiki/Unicode_representations_of_modifier_keys\r\n        shortcut = keymap.mac\r\n            .replace(/Cmd/i, '\\u2318')\r\n            .replace(/Shift/i, '\\u21E7')\r\n            .replace(/Ctrl/i, '\\u2303')\r\n            .replace(/Alt/i, '\\u2325')\r\n            .replace(/Backspace/i, '\\u232B')\r\n            .replace(/Enter/i, '\\u23CE');\r\n    }\r\n    else {\r\n        shortcut = keymap.windows.replace(/Backspace/i, '\\u232B');\r\n    }\r\n    var keys = shortcut.split('-');\r\n    var lastKey = keys[keys.length - 1];\r\n    if (lastKey.length === 1) {\r\n        // capitalise single letters\r\n        lastKey = lastKey.toUpperCase();\r\n    }\r\n    keys[keys.length - 1] = arrowKeysMap[lastKey.toUpperCase()] || lastKey;\r\n    return keys.join(browser.mac ? '' : '+');\r\n}\r\nfunction tooltip(keymap, description) {\r\n    if (keymap) {\r\n        var shortcut = formatShortcut(keymap);\r\n        return description ? description + \" \" + shortcut : shortcut;\r\n    }\r\n    return;\r\n}\r\nvar ToolTipContent = React.memo(function (_a) {\r\n    var description = _a.description, shortcutOverride = _a.shortcutOverride, keymap = _a.keymap;\r\n    var shortcut = shortcutOverride || (keymap && formatShortcut(keymap));\r\n    return shortcut || description ? (React.createElement(React.Fragment, null,\r\n        description,\r\n        shortcut && description && '\\u00A0',\r\n        shortcut && React.createElement(TooltipShortcut, null, shortcut))) : null;\r\n});\r\nfunction makeKeymap(description, windows, mac, common) {\r\n    return {\r\n        description: description,\r\n        windows: windows,\r\n        mac: mac,\r\n        common: common,\r\n    };\r\n}\r\nfunction makeKeyMapWithCommon(description, common) {\r\n    var windows = common.replace(/Mod/i, 'Ctrl');\r\n    var mac = common.replace(/Mod/i, 'Cmd');\r\n    return makeKeymap(description, windows, mac, common);\r\n}\r\nfunction bindKeymapWithCommand(shortcut, cmd, keymap) {\r\n    var oldCmd = keymap[shortcut];\r\n    var newCmd = cmd;\r\n    if (keymap[shortcut]) {\r\n        newCmd = function (state, dispatch, editorView) {\r\n            return oldCmd(state, dispatch) || cmd(state, dispatch, editorView);\r\n        };\r\n    }\r\n    keymap[shortcut] = newCmd;\r\n}\r\nvar templateObject_1$1;\n\nvar createNewBlockQuote = function () { return function (state, dispatch) {\r\n    var _a = state.selection, $from = _a.$from, $to = _a.$to;\r\n    var blockquote = state.schema.nodes.blockquote;\r\n    var empty = blockquote.createAndFill();\r\n    var endOfBlock = $from.end();\r\n    if (empty && dispatch) {\r\n        var tr = state.tr.insert(endOfBlock + 1, empty);\r\n        dispatch(tr);\r\n    }\r\n    return false;\r\n}; };\r\n// export const toggleBlockQuote = (\r\n//   state: EditorState,\r\n//   dispatch: (tr: Transaction) => void,\r\n//   view: EditorView,\r\n// ): boolean => {\r\n//   const { selection } = state;\r\n//   const fromNode = selection.$from.node(selection.$from.depth - 2);\r\n//   const endNode = selection.$to.node(selection.$to.depth - 2);\r\n//   if (\r\n//     !fromNode ||\r\n//     fromNode.type.name !== listType ||\r\n//     !endNode ||\r\n//     endNode.type.name !== listType\r\n//   ) {\r\n//     return toggleListCommandWithAnalytics(inputMethod, listType)(\r\n//       state,\r\n//       dispatch,\r\n//       view,\r\n//     );\r\n//   } else {\r\n//     const depth = rootListDepth(selection.$to, state.schema.nodes);\r\n//     let tr = liftFollowingList(\r\n//       state,\r\n//       selection.$to.pos,\r\n//       selection.$to.end(depth),\r\n//       depth || 0,\r\n//       state.tr,\r\n//     );\r\n//     tr = liftSelectionList(state, tr);\r\n//     dispatch(tr);\r\n//     return true;\r\n//   }\r\n// };\r\n// export function toggleListCommand(\r\n//   listType: 'bulletList' | 'orderedList',\r\n// ): Command {\r\n//   return function (state, dispatch, view) {\r\n//     if (dispatch) {\r\n//       dispatch(\r\n//         state.tr.setSelection(\r\n//           adjustSelectionInList(state.doc, state.selection as TextSelection),\r\n//         ),\r\n//       );\r\n//     }\r\n//     if (!view) {\r\n//       return false;\r\n//     }\r\n//     state = view.state;\r\n//     const {\r\n//       doc,\r\n//       selection: { $from, $to },\r\n//     } = state;\r\n//     const listNodeType = state.schema.nodes[listType];\r\n//     // find closest parent of listNodeType from start of selection\r\n//     const listParentPos = findParentNodeOfTypeClosestToPos(\r\n//       doc.resolve($from.pos),\r\n//       listNodeType,\r\n//     );\r\n//     // determine if end of selection is outside of that list (if selection is in a list at all)\r\n//     const isSameListTypeSelected =\r\n//       listParentPos &&\r\n//       $to.pos <= listParentPos.pos + listParentPos.node.nodeSize;\r\n//     if (isInsideList(state, listType) && isSameListTypeSelected) {\r\n//       // Untoggles list\r\n//       return liftListItems()(state, dispatch);\r\n//     } else {\r\n//       // Converts list type e.g. bullet_list -> ordered_list if needed\r\n//       if (!isSameListTypeSelected) {\r\n//         liftListItems()(state, dispatch);\r\n//         state = view.state;\r\n//       }\r\n//       // Remove any invalid marks that are not supported\r\n//       const tr = sanitiseSelectionMarksForWrapping(state, listNodeType);\r\n//       if (tr && dispatch) {\r\n//         dispatch(tr);\r\n//         state = view.state;\r\n//       }\r\n//       // Wraps selection in list\r\n//       return wrapInList(listNodeType)(state, dispatch);\r\n//     }\r\n//   };\r\n// }\r\n// export function toggleBulletList(\r\n//   view: EditorView,\r\n//   inputMethod: InputMethod = INPUT_METHOD.TOOLBAR,\r\n// ) {\r\n//   return toggleList(view.state, view.dispatch, view, 'bulletList', inputMethod);\r\n// }\r\n// export function toggleOrderedList(\r\n//   view: EditorView,\r\n//   inputMethod: InputMethod = INPUT_METHOD.TOOLBAR,\r\n// ) {\r\n//   return toggleList(\r\n//     view.state,\r\n//     view.dispatch,\r\n//     view,\r\n//     'orderedList',\r\n//     inputMethod,\r\n//   );\r\n// }\n\nfunction keymapPlugin() {\r\n    var keymapObj = {};\r\n    bindKeymapWithCommand(toggleBlockQuote.common, createNewBlockQuote(), keymapObj);\r\n    return keymap(keymapObj);\r\n}\n\nfunction IconCode(_a) {\r\n    var _b = _a.label, label = _b === void 0 ? '' : _b;\r\n    return (React.createElement(\"svg\", { \"aria-label\": label, width: 40, height: 40, fillRule: \"evenodd\" },\r\n        React.createElement(\"path\", { fill: \"#fff\", d: \"M0 0h40v40H0z\" }),\r\n        React.createElement(\"path\", { fill: \"#ebecf0\", d: \"M13 6h26v28H13z\" }),\r\n        React.createElement(\"path\", { d: \"M9 6h4v28H9a2 2 0 01-2-2V8a2 2 0 012-2z\", fill: \"#dfe1e6\" }),\r\n        React.createElement(\"g\", { fill: \"#a5adba\" },\r\n            React.createElement(\"rect\", { x: 9, y: 9, width: 2, height: 1, rx: 0.5 }),\r\n            React.createElement(\"rect\", { x: 16, y: 9, width: 9, height: 1, rx: 0.5 }),\r\n            React.createElement(\"rect\", { x: 22, y: 21, width: 9, height: 1, rx: 0.5 }),\r\n            React.createElement(\"rect\", { x: 22, y: 29, width: 9, height: 1, rx: 0.5 })),\r\n        React.createElement(\"g\", { fill: \"#4c9aff\" },\r\n            React.createElement(\"rect\", { x: 28, y: 25, width: 9, height: 1, rx: 0.5 }),\r\n            React.createElement(\"rect\", { x: 16, y: 13, width: 13, height: 1, rx: 0.5 })),\r\n        React.createElement(\"g\", { fill: \"#ff7452\" },\r\n            React.createElement(\"rect\", { x: 16, y: 17, width: 13, height: 1, rx: 0.5 }),\r\n            React.createElement(\"rect\", { x: 19, y: 25, width: 7, height: 1, rx: 0.5 })),\r\n        React.createElement(\"g\", { fill: \"#a5adba\" },\r\n            React.createElement(\"rect\", { x: 9, y: 13, width: 2, height: 1, rx: 0.5 }),\r\n            React.createElement(\"rect\", { x: 9, y: 17, width: 2, height: 1, rx: 0.5 }),\r\n            React.createElement(\"rect\", { x: 9, y: 21, width: 2, height: 1, rx: 0.5 }),\r\n            React.createElement(\"rect\", { x: 9, y: 25, width: 2, height: 1, rx: 0.5 }),\r\n            React.createElement(\"rect\", { x: 9, y: 29, width: 2, height: 1, rx: 0.5 }))));\r\n}\n\nvar blockQuotePlugin = function (options) {\r\n    if (options === void 0) { options = {}; }\r\n    return ({\r\n        name: 'blockquote',\r\n        nodes: function () {\r\n            return [{ name: 'blockquote', node: blockquote }];\r\n        },\r\n        pmPlugins: function () {\r\n            var plugins = [\r\n                {\r\n                    name: 'blockquote',\r\n                    plugin: function (_a) {\r\n                        var dispatch = _a.dispatch, \r\n                        // providerFactory,\r\n                        portalProviderAPI = _a.portalProviderAPI, eventDispatcher = _a.eventDispatcher;\r\n                        return blockQuotePluginFactory(dispatch, \r\n                        // providerFactory,\r\n                        portalProviderAPI, eventDispatcher, options);\r\n                    },\r\n                },\r\n                { name: 'blockquoteKeyMap', plugin: function () { return keymapPlugin(); } },\r\n            ];\r\n            return plugins;\r\n        },\r\n        // primaryToolbarComponent({\r\n        //   editorView,\r\n        //   popupsMountPoint,\r\n        //   popupsBoundariesElement,\r\n        //   popupsScrollableElement,\r\n        //   toolbarSize,\r\n        //   disabled,\r\n        //   isToolbarReducedSpacing,\r\n        //   eventDispatcher,\r\n        // }) {\r\n        //   return (\r\n        //     <WithPluginState\r\n        //       editorView={editorView}\r\n        //       eventDispatcher={eventDispatcher}\r\n        //       plugins={{\r\n        //         pluginState: blockquotePluginKey,\r\n        //       }}\r\n        //       render={({ pluginState }) => {\r\n        //         return (\r\n        //           <ToolbarBlockType\r\n        //             isDisabled={disabled}\r\n        //             isReducedSpacing={isToolbarReducedSpacing}\r\n        //             setBlockType={boundSetBlockType}\r\n        //             pluginState={pluginState}\r\n        //             popupsMountPoint={popupsMountPoint}\r\n        //             popupsBoundariesElement={popupsBoundariesElement}\r\n        //             popupsScrollableElement={popupsScrollableElement}\r\n        //           />\r\n        //         );\r\n        //       }}\r\n        //     />\r\n        //   );\r\n        // },\r\n        pluginsOptions: {\r\n            quickInsert: [\r\n                {\r\n                    id: 'blockquote',\r\n                    title: 'Quote',\r\n                    description: 'Quote some text',\r\n                    priority: 1300,\r\n                    keyshortcut: tooltip(toggleBlockQuote),\r\n                    icon: function () { return React.createElement(IconCode, { label: 'Quote' }); },\r\n                    action: function (insert, state) {\r\n                        var tr = insert(state.schema.nodes.blockquote.createChecked({}, state.schema.nodes.paragraph.createChecked()));\r\n                        return tr;\r\n                    },\r\n                },\r\n            ],\r\n        },\r\n    });\r\n};\n\nvar pluginKey = new PluginKey('quickInsertPluginKey');\n\nvar options = {\r\n    threshold: 0.3,\r\n    keys: [\r\n        // Weights must sum to <= 1.0\r\n        { name: 'title', weight: 0.5 },\r\n        { name: 'priority', weight: 0.3 },\r\n        { name: 'keywords', weight: 0.15 },\r\n        { name: 'description', weight: 0.04 },\r\n        { name: 'keyshortcut', weight: 0.01 },\r\n    ],\r\n};\r\nfunction dedupe(list, iteratee) {\r\n    /**\r\n                .,\r\n      .      _,'f----.._\r\n      |\\ ,-'\"/  |     ,'\r\n      |,_  ,--.      /\r\n      /,-. ,'`.     (_\r\n      f  o|  o|__     \"`-.\r\n      ,-._.,--'_ `.   _.,-`\r\n      `\"' ___.,'` j,-'\r\n        `-.__.,--'\r\n      Gotta go fast!\r\n   */\r\n    if (list === void 0) { list = []; }\r\n    if (iteratee === void 0) { iteratee = function (p) { return p; }; }\r\n    var seen = new Set();\r\n    list.forEach(function (l) { return seen.add(iteratee(l)); });\r\n    return list.filter(function (l) {\r\n        var it = iteratee(l);\r\n        if (seen.has(it)) {\r\n            seen.delete(it);\r\n            return true;\r\n        }\r\n        return false;\r\n    });\r\n}\r\nfunction find$1(query, items) {\r\n    var fuse = new Fuse(items, options);\r\n    if (query === '') {\r\n        // Copy and sort list by priority\r\n        return items\r\n            .slice(0)\r\n            .sort(function (a, b) {\r\n            return (a.priority || Number.POSITIVE_INFINITY) -\r\n                (b.priority || Number.POSITIVE_INFINITY);\r\n        });\r\n    }\r\n    return fuse.search(query).map(function (s) { return s.item; });\r\n}\r\nvar searchQuickInsertItems = function (quickInsertState, options) { return function (query, category) {\r\n    var defaultItems = options && options.disableDefaultItems\r\n        ? []\r\n        : quickInsertState.lazyDefaultItems();\r\n    var providedItems = quickInsertState.providedItems;\r\n    var items = providedItems\r\n        ? dedupe(__spreadArrays(defaultItems, providedItems), function (item) { return item.title; })\r\n        : defaultItems;\r\n    return find$1(query || '', items);\r\n}; };\n\nvar quickInsertPlugin = function (options) { return ({\r\n    name: 'quickInsert',\r\n    pmPlugins: function (quickInsert) {\r\n        return [\r\n            {\r\n                name: 'quickInsert',\r\n                plugin: function (_a) {\r\n                    var providerFactory = _a.providerFactory, dispatch = _a.dispatch;\r\n                    return quickInsertPluginFactory(quickInsert, providerFactory, dispatch);\r\n                },\r\n            },\r\n        ];\r\n    },\r\n    pluginsOptions: {\r\n        typeAhead: {\r\n            trigger: '/',\r\n            headless: options ? options.headless : undefined,\r\n            getItems: function (query, state, _tr, dispatch) {\r\n                var quickInsertState = pluginKey.getState(state);\r\n                return searchQuickInsertItems(quickInsertState, options)(query);\r\n            },\r\n            selectItem: function (state, item, insert) {\r\n                return item.action(insert, state);\r\n            },\r\n        },\r\n    },\r\n}); };\r\nvar itemsCache = {};\r\nvar processItems = function (items) {\r\n    if (!itemsCache['en']) {\r\n        itemsCache['en'] = items.reduce(function (acc, item) {\r\n            // if (typeof item === 'function') {\r\n            //   return acc.concat(item('en'));\r\n            // }\r\n            return acc.concat(item);\r\n        }, []);\r\n    }\r\n    return itemsCache['en'];\r\n};\r\nvar setProviderState = function (providerState) { return function (state, dispatch) {\r\n    if (dispatch) {\r\n        dispatch(state.tr.setMeta(pluginKey, providerState));\r\n    }\r\n    return true;\r\n}; };\r\nfunction quickInsertPluginFactory(quickInsertItems, providerFactory, dispatch) {\r\n    return new Plugin({\r\n        key: pluginKey,\r\n        state: {\r\n            init: function () {\r\n                return {\r\n                    isElementBrowserModalOpen: false,\r\n                    // lazy so it doesn't run on editor initialization\r\n                    lazyDefaultItems: function () { return processItems(quickInsertItems || []); },\r\n                };\r\n            },\r\n            apply: function (tr, pluginState) {\r\n                var meta = tr.getMeta(pluginKey);\r\n                if (meta) {\r\n                    var changed = Object.keys(meta).some(function (key) {\r\n                        return pluginState[key] !== meta[key];\r\n                    });\r\n                    if (changed) {\r\n                        var newState = __assign(__assign({}, pluginState), meta);\r\n                        dispatch(pluginKey, newState);\r\n                        return newState;\r\n                    }\r\n                }\r\n                return pluginState;\r\n            },\r\n        },\r\n        view: function (editorView) {\r\n            var _this = this;\r\n            var providerHandler = function (_name, providerPromise) { return __awaiter(_this, void 0, void 0, function () {\r\n                var provider, providedItems, e_1;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            if (!providerPromise) return [3 /*break*/, 5];\r\n                            _a.label = 1;\r\n                        case 1:\r\n                            _a.trys.push([1, 4, , 5]);\r\n                            return [4 /*yield*/, providerPromise];\r\n                        case 2:\r\n                            provider = _a.sent();\r\n                            return [4 /*yield*/, provider.getItems()];\r\n                        case 3:\r\n                            providedItems = _a.sent();\r\n                            setProviderState({ provider: provider, providedItems: providedItems })(editorView.state, editorView.dispatch);\r\n                            return [3 /*break*/, 5];\r\n                        case 4:\r\n                            e_1 = _a.sent();\r\n                            // eslint-disable-next-line no-console\r\n                            console.error('Error getting items from quick insert provider', e_1);\r\n                            return [3 /*break*/, 5];\r\n                        case 5: return [2 /*return*/];\r\n                    }\r\n                });\r\n            }); };\r\n            providerFactory.subscribe('quickInsertProvider', providerHandler);\r\n            return {\r\n                destroy: function () {\r\n                    providerFactory.unsubscribe('quickInsertProvider', providerHandler);\r\n                },\r\n            };\r\n        },\r\n    });\r\n}\n\n// # What do marks exist?\r\n// Marks group for search queries.\r\nvar SEARCH_QUERY = 'searchQuery';\n\n// import themed from './utils/themed';\r\n// Blues\r\nvar B50 = '#DEEBFF';\r\nvar B100 = '#4C9AFF';\r\nvar B400 = '#0052CC';\r\n// Neutrals\r\nvar N0 = '#FFFFFF';\r\nvar N20 = '#F4F5F7';\r\nvar N30 = '#EBECF0';\r\nvar N100 = '#7A869A';\r\nvar N200 = '#6B778C';\r\nvar N500 = '#42526E';\r\nvar N800 = '#172B4D';\r\n// ATTENTION: update the tints if you update this\r\nvar N900 = '#091E42';\r\nvar N50A = 'rgba(9, 30, 66, 0.25)';\r\nvar N60A = 'rgba(9, 30, 66, 0.31)';\r\n// Themed colors\r\nvar background = N0; //themed({ light: N0, dark: DN30 });\r\nvar backgroundActive = B50; //themed({ light: B50, dark: B75 });\r\nvar backgroundHover = N30; //themed({ light: N30, dark: DN70 });\r\nvar text$1 = N900; // themed({ light: N900, dark: DN600 });\r\nvar textHover = N800; //themed({ light: N800, dark: DN600 });\r\nvar textActive = B400; //themed({ light: B400, dark: B400 });\r\n// export const subtleText = themed({ light: N200, dark: DN300 });\r\n// export const placeholderText = themed({ light: N100, dark: DN200 });\r\n// export const heading = themed({ light: N800, dark: DN600 });\r\n// export const subtleHeading = themed({ light: N200, dark: DN300 });\r\n// export const codeBlock = themed({ light: N20, dark: DN50 });\r\n// export const link = themed({ light: B400, dark: B100 });\r\n// export const linkHover = themed({ light: B300, dark: B200 });\r\n// export const linkActive = themed({ light: B500, dark: B100 });\r\n// export const linkOutline = themed({ light: B100, dark: B200 });\r\n// export const primary = themed({ light: B400, dark: B100 });\r\n// export const blue = themed({ light: B400, dark: B100 });\r\n// export const teal = themed({ light: T300, dark: T200 });\r\n// export const purple = themed({ light: P300, dark: P100 });\r\n// export const red = themed({ light: R300, dark: R300 });\r\n// export const yellow = themed({ light: Y300, dark: Y300 });\r\n// export const green = themed({ light: G300, dark: G300 });\r\n// export const skeleton = () => N20A;\n\nvar typeAheadQuery = {\r\n    inclusive: true,\r\n    group: SEARCH_QUERY,\r\n    parseDOM: [{ tag: 'span[data-type-ahead-query]' }],\r\n    toDOM: function (node) {\r\n        return [\r\n            'span',\r\n            {\r\n                'data-type-ahead-query': 'true',\r\n                'data-trigger': node.attrs.trigger,\r\n                style: \"color: \" + B400,\r\n            },\r\n        ];\r\n    },\r\n    attrs: {\r\n        trigger: { default: '' },\r\n    },\r\n};\n\n/**\r\n * Wraps component in a high order component that watches state changes of given plugins\r\n * and passes those states to the wrapped component.\r\n *\r\n * Example:\r\n * <WithPluginState\r\n *   eventDispatcher={eventDispatcher}\r\n *   editorView={editorView}\r\n *   plugins={{\r\n *     hyperlink: hyperlinkPluginKey\r\n *   }}\r\n *   render={renderComponent}\r\n * />\r\n *\r\n * renderComponent: ({ hyperlink }) => React.Component;\r\n */\r\nvar WithPluginState = /** @class */ (function (_super) {\r\n    __extends(WithPluginState, _super);\r\n    function WithPluginState(props, context) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.listeners = {};\r\n        _this.debounce = null;\r\n        _this.notAppliedState = {};\r\n        _this.isSubscribed = false;\r\n        _this.state = {};\r\n        _this.handlePluginStateChange = function (propName, pluginName, skipEqualityCheck) { return function (pluginState) {\r\n            var _a;\r\n            // skipEqualityCheck is being used for old plugins since they are mutating plugin state instead of creating a new one\r\n            if (_this.state[propName] !== pluginState || skipEqualityCheck) {\r\n                _this.updateState({\r\n                    stateSubset: (_a = {}, _a[propName] = pluginState, _a),\r\n                    pluginName: pluginName,\r\n                });\r\n            }\r\n        }; };\r\n        /**\r\n         * Debounces setState calls in order to reduce number of re-renders caused by several plugin state changes.\r\n         */\r\n        _this.updateState = function (_a) {\r\n            var stateSubset = _a.stateSubset, pluginName = _a.pluginName;\r\n            _this.notAppliedState = __assign(__assign({}, _this.notAppliedState), stateSubset);\r\n            if (_this.debounce) {\r\n                window.clearTimeout(_this.debounce);\r\n            }\r\n            _this.debounce = window.setTimeout(function () {\r\n                _this.setState(_this.notAppliedState);\r\n                _this.debounce = null;\r\n                _this.notAppliedState = {};\r\n            }, 0);\r\n        };\r\n        _this.onContextUpdate = function () {\r\n            _this.subscribe(_this.props);\r\n        };\r\n        _this.state = _this.getPluginsStates(props.plugins, _this.getEditorView(props, context));\r\n        return _this;\r\n    }\r\n    WithPluginState.prototype.getEditorView = function (maybeProps, maybeContext) {\r\n        var props = maybeProps || this.props;\r\n        var context = maybeContext || this.context;\r\n        return (props.editorView ||\r\n            (context &&\r\n                context.editorActions &&\r\n                context.editorActions._privateGetEditorView()));\r\n    };\r\n    WithPluginState.prototype.getEventDispatcher = function (maybeProps) {\r\n        var props = maybeProps || this.props;\r\n        return (props.eventDispatcher ||\r\n            (this.context &&\r\n                this.context.editorActions &&\r\n                this.context.editorActions._privateGetEventDispatcher()));\r\n    };\r\n    WithPluginState.prototype.getPluginsStates = function (plugins, editorView) {\r\n        if (!editorView || !plugins) {\r\n            return {};\r\n        }\r\n        return Object.keys(plugins).reduce(function (acc, propName) {\r\n            var pluginKey = plugins[propName];\r\n            if (!pluginKey) {\r\n                return acc;\r\n            }\r\n            acc[propName] = pluginKey.getState(editorView.state);\r\n            return acc;\r\n        }, {});\r\n    };\r\n    WithPluginState.prototype.subscribe = function (props) {\r\n        var _this = this;\r\n        var plugins = props.plugins;\r\n        var eventDispatcher = this.getEventDispatcher(props);\r\n        var editorView = this.getEditorView(props);\r\n        if (!eventDispatcher || !editorView || this.isSubscribed) {\r\n            return;\r\n        }\r\n        this.isSubscribed = true;\r\n        var pluginsStates = this.getPluginsStates(plugins, editorView);\r\n        this.setState(pluginsStates);\r\n        Object.keys(plugins).forEach(function (propName) {\r\n            var pluginKey = plugins[propName];\r\n            if (!pluginKey) {\r\n                return;\r\n            }\r\n            var pluginName = pluginKey.key;\r\n            var pluginState = pluginsStates[propName];\r\n            var isPluginWithSubscribe = pluginState && pluginState.subscribe;\r\n            var handler = _this.handlePluginStateChange(propName, pluginName, isPluginWithSubscribe);\r\n            if (isPluginWithSubscribe) {\r\n                pluginState.subscribe(handler);\r\n            }\r\n            else {\r\n                eventDispatcher.on(pluginKey.key, handler);\r\n            }\r\n            _this.listeners[pluginKey.key] = { handler: handler, pluginKey: pluginKey };\r\n        });\r\n    };\r\n    WithPluginState.prototype.unsubscribe = function () {\r\n        var _this = this;\r\n        var eventDispatcher = this.getEventDispatcher();\r\n        var editorView = this.getEditorView();\r\n        if (!eventDispatcher || !editorView || !this.isSubscribed) {\r\n            return;\r\n        }\r\n        Object.keys(this.listeners).forEach(function (key) {\r\n            var pluginState = _this.listeners[key].pluginKey.getState(editorView.state);\r\n            if (pluginState && pluginState.unsubscribe) {\r\n                pluginState.unsubscribe(_this.listeners[key].handler);\r\n            }\r\n            else {\r\n                eventDispatcher.off(key, _this.listeners[key].handler);\r\n            }\r\n        });\r\n        this.listeners = [];\r\n    };\r\n    WithPluginState.prototype.subscribeToContextUpdates = function (context) {\r\n        if (context && context.editorActions) {\r\n            context.editorActions._privateSubscribe(this.onContextUpdate);\r\n        }\r\n    };\r\n    WithPluginState.prototype.unsubscribeFromContextUpdates = function (context) {\r\n        if (context && context.editorActions) {\r\n            context.editorActions._privateUnsubscribe(this.onContextUpdate);\r\n        }\r\n    };\r\n    WithPluginState.prototype.componentDidMount = function () {\r\n        this.subscribe(this.props);\r\n        this.subscribeToContextUpdates(this.context);\r\n    };\r\n    WithPluginState.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {\r\n        if (!this.isSubscribed) {\r\n            this.subscribe(nextProps);\r\n        }\r\n    };\r\n    WithPluginState.prototype.componentWillUnmount = function () {\r\n        if (this.debounce) {\r\n            window.clearTimeout(this.debounce);\r\n        }\r\n        this.unsubscribeFromContextUpdates(this.context);\r\n        this.unsubscribe();\r\n    };\r\n    WithPluginState.prototype.render = function () {\r\n        var render = this.props.render;\r\n        return render(this.state);\r\n    };\r\n    WithPluginState.displayName = 'WithPluginState';\r\n    WithPluginState.contextTypes = {\r\n        editorActions: PropTypes.object,\r\n        editorConfig: PropTypes.object,\r\n    };\r\n    return WithPluginState;\r\n}(React.Component));\n\nfunction defaultInputRuleHandler(inputRule, isBlockNodeRule) {\r\n    if (isBlockNodeRule === void 0) { isBlockNodeRule = false; }\r\n    var originalHandler = inputRule.handler;\r\n    inputRule.handler = function (state, match, start, end) {\r\n        // Skip any input rule inside code\r\n        // https://product-fabric.atlassian.net/wiki/spaces/E/pages/37945345/Editor+content+feature+rules#Editorcontent/featurerules-Rawtextblocks\r\n        var unsupportedMarks = isBlockNodeRule\r\n            ? hasUnsupportedMarkForBlockInputRule(state, start, end)\r\n            : hasUnsupportedMarkForInputRule(state, start, end);\r\n        var $from = state.selection.$from;\r\n        if ($from.parent.type.spec.code ||\r\n            !(state.selection instanceof TextSelection) ||\r\n            unsupportedMarks) {\r\n            return;\r\n        }\r\n        return originalHandler(state, match, start, end);\r\n    };\r\n    return inputRule;\r\n}\r\n// The chrome profiler groups all input rules together, making it tricky to detect which one is slow.\r\n// This instrumentated method will add new marks with the format input-rule:<pluginName> making it\r\n// pretty straightforward to find issues.\r\nfunction instrumentedInputRule(pluginName, _a) {\r\n    var rules = _a.rules;\r\n    var plugin = inputRules({ rules: rules });\r\n    if (process.env.NODE_ENV !== 'production') {\r\n        var handleTextInput_1 = plugin.props.handleTextInput;\r\n        var timerId_1 = \"input-rule:\" + pluginName;\r\n        plugin.props.handleTextInput = function (view, from, to, text) {\r\n            startMeasure(timerId_1);\r\n            // @ts-ignore\r\n            var result = handleTextInput_1(view, from, to, text);\r\n            stopMeasure(timerId_1, function () { });\r\n            return result;\r\n        };\r\n    }\r\n    return plugin;\r\n}\r\nfunction createInputRule(match, handler, isBlockNodeRule) {\r\n    if (isBlockNodeRule === void 0) { isBlockNodeRule = false; }\r\n    return defaultInputRuleHandler(new InputRule(match, handler), isBlockNodeRule);\r\n}\r\n// ProseMirror uses the Unicode Character 'OBJECT REPLACEMENT CHARACTER' (U+FFFC) as text representation for\r\n// leaf nodes, i.e. nodes that don't have any content or text property (e.g. hardBreak, emoji, mention, rule)\r\n// It was introduced because of https://github.com/ProseMirror/prosemirror/issues/262\r\n// This can be used in an input rule regex to be able to include or exclude such nodes.\r\nvar leafNodeReplacementCharacter = '\\ufffc';\r\nvar hasUnsupportedMarkForBlockInputRule = function (state, start, end) {\r\n    var doc = state.doc, marks = state.schema.marks;\r\n    var unsupportedMarksPresent = false;\r\n    var isUnsupportedMark = function (node) {\r\n        return node.type === marks.code ||\r\n            node.type === marks.link ||\r\n            node.type === marks.typeAheadQuery;\r\n    };\r\n    doc.nodesBetween(start, end, function (node) {\r\n        unsupportedMarksPresent =\r\n            unsupportedMarksPresent ||\r\n                node.marks.filter(isUnsupportedMark).length > 0;\r\n    });\r\n    return unsupportedMarksPresent;\r\n};\r\nvar hasUnsupportedMarkForInputRule = function (state, start, end) {\r\n    var doc = state.doc, marks = state.schema.marks;\r\n    var unsupportedMarksPresent = false;\r\n    var isCodemark = function (mark) { return mark.type === marks.code; };\r\n    doc.nodesBetween(start, end, function (node) {\r\n        unsupportedMarksPresent =\r\n            unsupportedMarksPresent || node.marks.filter(isCodemark).length > 0;\r\n    });\r\n    return unsupportedMarksPresent;\r\n};\n\n// import { FakeTextCursorSelection } from '../plugins/fake-text-cursor/cursor';\r\nfunction isMarkTypeCompatibleWithMark(markType, mark) {\r\n    return !mark.type.excludes(markType) && !markType.excludes(mark.type);\r\n}\r\nfunction isMarkTypeAllowedInNode(markType, state) {\r\n    return toggleMark(markType)(state);\r\n}\r\n/**\r\n * Check if a mark is allowed at the current selection / cursor based on a given state.\r\n * This method looks at both the currently active marks on the transaction, as well as\r\n * the node and marks at the current selection to determine if the given mark type is\r\n * allowed.\r\n */\r\nfunction isMarkTypeAllowedInCurrentSelection(markType, state) {\r\n    // if (state.selection instanceof FakeTextCursorSelection) {\r\n    //   return true;\r\n    // }\r\n    if (!isMarkTypeAllowedInNode(markType, state)) {\r\n        return false;\r\n    }\r\n    var _a = state.selection, empty = _a.empty, $cursor = _a.$cursor, ranges = _a.ranges;\r\n    if (empty && !$cursor) {\r\n        return false;\r\n    }\r\n    var isCompatibleMarkType = function (mark) {\r\n        return isMarkTypeCompatibleWithMark(markType, mark);\r\n    };\r\n    // Handle any new marks in the current transaction\r\n    if (state.tr.storedMarks &&\r\n        !state.tr.storedMarks.every(isCompatibleMarkType)) {\r\n        return false;\r\n    }\r\n    if ($cursor) {\r\n        return $cursor.marks().every(isCompatibleMarkType);\r\n    }\r\n    // Check every node in a selection - ensuring that it is compatible with the current mark type\r\n    return ranges.every(function (_a) {\r\n        var $from = _a.$from, $to = _a.$to;\r\n        var allowedInActiveMarks = $from.depth === 0 ? state.doc.marks.every(isCompatibleMarkType) : true;\r\n        state.doc.nodesBetween($from.pos, $to.pos, function (node) {\r\n            allowedInActiveMarks =\r\n                allowedInActiveMarks && node.marks.every(isCompatibleMarkType);\r\n        });\r\n        return allowedInActiveMarks;\r\n    });\r\n}\n\nvar pluginKey$1 = new PluginKey('typeAheadPlugin');\n\nfunction findQueryMark(mark, doc, from, to) {\r\n    var queryMark = { start: -1, end: -1 };\r\n    doc.nodesBetween(from, to, function (node, pos) {\r\n        if (queryMark.start === -1 && mark.isInSet(node.marks)) {\r\n            queryMark = {\r\n                start: pos,\r\n                end: pos + Math.max(node.textContent.length, 1),\r\n            };\r\n        }\r\n    });\r\n    return queryMark;\r\n}\r\nfunction findTypeAheadQuery(state) {\r\n    var doc = state.doc, schema = state.schema;\r\n    var typeAheadQuery = schema.marks.typeAheadQuery;\r\n    var _a = state.selection, from = _a.from, to = _a.to;\r\n    return findQueryMark(typeAheadQuery, doc, from - 1, to);\r\n}\n\nvar dismissCommand = function () { return function (state, dispatch) {\r\n    var queryMark = findTypeAheadQuery(state);\r\n    if (queryMark === null) {\r\n        return false;\r\n    }\r\n    var start = queryMark.start, end = queryMark.end;\r\n    var schema = state.schema;\r\n    var markType = schema.marks.typeAheadQuery;\r\n    if (start === -1) {\r\n        return false;\r\n    }\r\n    var typeAheadHandler = pluginKey$1.getState(state).typeAheadHandler;\r\n    if (typeAheadHandler && typeAheadHandler.dismiss) {\r\n        typeAheadHandler.dismiss(state);\r\n    }\r\n    if (dispatch) {\r\n        dispatch(state.tr.removeMark(start, end, markType).removeStoredMark(markType));\r\n    }\r\n    return true;\r\n}; };\n\nfunction insertTypeAheadQuery(trigger, replaceLastChar) {\r\n    if (replaceLastChar === void 0) { replaceLastChar = false; }\r\n    return function (state, dispatch) {\r\n        if (!dispatch) {\r\n            return false;\r\n        }\r\n        if (replaceLastChar) {\r\n            var tr = state.tr, selection = state.selection;\r\n            var marks = selection.$from.marks();\r\n            dispatch(tr\r\n                .setSelection(TextSelection.create(tr.doc, selection.$from.pos - 1, selection.$from.pos))\r\n                .replaceSelectionWith(state.doc.type.schema.text(trigger, __spreadArrays([\r\n                state.schema.marks.typeAheadQuery.create({ trigger: trigger })\r\n            ], marks)), false));\r\n            return true;\r\n        }\r\n        dispatch(safeInsert(state.schema.text(trigger, [\r\n            state.schema.marks.typeAheadQuery.create({ trigger: trigger }),\r\n        ]))(state.tr));\r\n        return true;\r\n    };\r\n}\n\nvar ACTIONS = {\r\n    SELECT_PREV: 'SELECT_PREV',\r\n    SELECT_NEXT: 'SELECT_NEXT',\r\n    SELECT_CURRENT: 'SELECT_CURRENT',\r\n    SET_CURRENT_INDEX: 'SET_CURRENT_INDEX',\r\n    SET_QUERY: 'SET_QUERY',\r\n    ITEMS_LIST_UPDATED: 'ITEMS_LIST_UPDATED',\r\n};\n\nvar itemsListUpdated = function (items) { return function (state, dispatch) {\r\n    if (dispatch) {\r\n        dispatch(state.tr.setMeta(pluginKey$1, {\r\n            action: ACTIONS.ITEMS_LIST_UPDATED,\r\n            items: items,\r\n        }));\r\n    }\r\n    return true;\r\n}; };\n\nvar normaliseNestedLayout = function (state, node) {\r\n    if (state.selection.$from.depth > 1) {\r\n        if (node.attrs.layout && node.attrs.layout !== 'default') {\r\n            return node.type.createChecked(__assign(__assign({}, node.attrs), { layout: 'default' }), node.content, node.marks);\r\n        }\r\n        // If its a breakout layout, we can remove the mark\r\n        // Since default isn't a valid breakout mode.\r\n        var breakoutMark = state.schema.marks.breakout;\r\n        if (breakoutMark && breakoutMark.isInSet(node.marks)) {\r\n            var newMarks = breakoutMark.removeFromSet(node.marks);\r\n            return node.type.createChecked(node.attrs, node.content, newMarks);\r\n        }\r\n    }\r\n    return node;\r\n};\r\n// @see: https://github.com/ProseMirror/prosemirror/issues/710\r\n// @see: https://bugs.chromium.org/p/chromium/issues/detail?id=740085\r\n// Chrome >= 58 (desktop only)\r\nvar isChromeWithSelectionBug = browser.chrome && !browser.android && browser.chrome_version >= 58;\n\n/**\r\n * Method extracted from typeahed plugin to be shared with the element browser on handling element insertion.\r\n */\r\nvar insertSelectedItem = function (maybeNode, opts) {\r\n    if (opts === void 0) { opts = {}; }\r\n    return function (state, tr, start) {\r\n        if (!maybeNode) {\r\n            return tr;\r\n        }\r\n        var isInputFragment = maybeNode instanceof Fragment;\r\n        var node;\r\n        try {\r\n            node =\r\n                maybeNode instanceof Node || isInputFragment\r\n                    ? maybeNode\r\n                    : typeof maybeNode === 'string'\r\n                        ? state.schema.text(maybeNode)\r\n                        : Node.fromJSON(state.schema, maybeNode);\r\n        }\r\n        catch (e) {\r\n            // eslint-disable-next-line no-console\r\n            console.error(e);\r\n            return tr;\r\n        }\r\n        if (node.isText) {\r\n            tr = tr.replaceWith(start, start, node);\r\n            /**\r\n             *\r\n             * Replacing a type ahead query mark with a block node.\r\n             *\r\n             */\r\n        }\r\n        else if (node.isBlock) {\r\n            tr = safeInsert(normaliseNestedLayout(state, node), undefined, true)(tr);\r\n            /**\r\n             *\r\n             * Replacing a type ahead query mark with an inline node.\r\n             *\r\n             */\r\n        }\r\n        else if (node.isInline || isInputFragment) {\r\n            var fragment = isInputFragment\r\n                ? node\r\n                : Fragment.fromArray([node, state.schema.text(' ')]);\r\n            tr = tr.replaceWith(start, start, fragment);\r\n            // This problem affects Chrome v58+. See: https://github.com/ProseMirror/prosemirror/issues/710\r\n            if (isChromeWithSelectionBug) {\r\n                var selection = document.getSelection();\r\n                if (selection) {\r\n                    selection.empty();\r\n                }\r\n            }\r\n            if (opts.selectInlineNode) {\r\n                // Select inserted node\r\n                tr = tr.setSelection(NodeSelection.create(tr.doc, start));\r\n            }\r\n            else {\r\n                // Placing cursor after node + space.\r\n                tr = tr.setSelection(Selection.near(tr.doc.resolve(start + fragment.size)));\r\n            }\r\n        }\r\n        return tr;\r\n    };\r\n};\n\nvar selectCurrentItem = function (mode) {\r\n    if (mode === void 0) { mode = 'selected'; }\r\n    return function (state, dispatch) {\r\n        var _a = pluginKey$1.getState(state), active = _a.active, currentIndex = _a.currentIndex, items = _a.items, typeAheadHandler = _a.typeAheadHandler;\r\n        if (!active || !typeAheadHandler) {\r\n            return false;\r\n        }\r\n        if (!typeAheadHandler.selectItem || !items[currentIndex]) {\r\n            return withTypeAheadQueryMarkPosition(state, function (start, end) {\r\n                return insertFallbackCommand(start, end)(state, dispatch);\r\n            });\r\n        }\r\n        return selectItem(typeAheadHandler, items[currentIndex], mode)(state, dispatch);\r\n    };\r\n};\r\nvar selectSingleItemOrDismiss = function (mode) {\r\n    if (mode === void 0) { mode = 'selected'; }\r\n    return function (state, dispatch) {\r\n        var _a = pluginKey$1.getState(state), active = _a.active, items = _a.items, typeAheadHandler = _a.typeAheadHandler;\r\n        if (!active || !typeAheadHandler || !typeAheadHandler.selectItem) {\r\n            return false;\r\n        }\r\n        if (items.length === 1) {\r\n            return selectItem(typeAheadHandler, items[0], mode)(state, dispatch);\r\n        }\r\n        if (!items || items.length === 0) {\r\n            dismissCommand()(state, dispatch);\r\n            return false;\r\n        }\r\n        return false;\r\n    };\r\n};\r\nvar selectByIndex = function (index) { return function (state, dispatch) {\r\n    var _a = pluginKey$1.getState(state), active = _a.active, items = _a.items, typeAheadHandler = _a.typeAheadHandler;\r\n    if (!active ||\r\n        !typeAheadHandler ||\r\n        !typeAheadHandler.selectItem ||\r\n        !items[index]) {\r\n        return false;\r\n    }\r\n    return selectItem(typeAheadHandler, items[index])(state, dispatch);\r\n}; };\r\nvar selectItem = function (handler, item, mode) {\r\n    if (mode === void 0) { mode = 'selected'; }\r\n    return function (state, dispatch) {\r\n        return withTypeAheadQueryMarkPosition(state, function (start, end) {\r\n            var insert = function (maybeNode, opts) {\r\n                if (opts === void 0) { opts = {}; }\r\n                var tr = state.tr;\r\n                tr = tr\r\n                    .setMeta(pluginKey$1, { action: ACTIONS.SELECT_CURRENT })\r\n                    .replaceWith(start, end, Fragment.empty);\r\n                return insertSelectedItem(maybeNode, opts)(state, tr, start);\r\n            };\r\n            var tr = handler.selectItem(state, item, insert, { mode: mode });\r\n            // if this is the invite teammates item, delete the trigger and query\r\n            // if (isInviteItem(item.mention)) {\r\n            //   // allow the user the select the invite item by left click or enter, but not by space bar\r\n            //   if (mode !== 'space') {\r\n            //     if (dispatch) {\r\n            //       dispatch(state.tr.delete(start, end));\r\n            //       return true;\r\n            //     }\r\n            //   }\r\n            //   return false;\r\n            // }\r\n            if (tr === false) {\r\n                return insertFallbackCommand(start, end)(state, dispatch);\r\n            }\r\n            if (dispatch) {\r\n                dispatch(tr);\r\n            }\r\n            return true;\r\n        });\r\n    };\r\n};\r\nvar insertFallbackCommand = function (start, end) { return function (state, dispatch) {\r\n    var _a = pluginKey$1.getState(state), query = _a.query, trigger = _a.trigger;\r\n    var node = state.schema.text(trigger + query);\r\n    if (dispatch) {\r\n        dispatch(state.tr.replaceWith(start, end, node));\r\n    }\r\n    return true;\r\n}; };\r\nvar withTypeAheadQueryMarkPosition = function (state, cb) {\r\n    var queryMark = findTypeAheadQuery(state);\r\n    if (!queryMark || queryMark.start === -1) {\r\n        return false;\r\n    }\r\n    return cb(queryMark.start, queryMark.end);\r\n};\n\nfunction isQueryActive(mark, doc, from, to) {\r\n    var active = false;\r\n    doc.nodesBetween(from, to, function (node) {\r\n        if (!active && mark.isInSet(node.marks)) {\r\n            active = true;\r\n        }\r\n    });\r\n    return active;\r\n}\n\nvar updateQueryCommand = function (query) { return function (state, dispatch) {\r\n    var queryMark = findTypeAheadQuery(state);\r\n    var activeQuery = isQueryActive(state.schema.marks.typeAheadQuery, state.doc, state.selection.from, state.selection.to);\r\n    if (queryMark === null || activeQuery === false) {\r\n        return false;\r\n    }\r\n    if (dispatch) {\r\n        dispatch(state.tr.setMeta(pluginKey$1, {\r\n            action: ACTIONS.SET_QUERY,\r\n            params: { query: query },\r\n        }));\r\n    }\r\n    return true;\r\n}; };\n\nfunction createInitialPluginState(prevActiveState, isAllowed) {\r\n    if (prevActiveState === void 0) { prevActiveState = false; }\r\n    if (isAllowed === void 0) { isAllowed = true; }\r\n    return {\r\n        isAllowed: isAllowed,\r\n        active: false,\r\n        prevActiveState: prevActiveState,\r\n        query: null,\r\n        trigger: null,\r\n        typeAheadHandler: null,\r\n        currentIndex: 0,\r\n        items: [],\r\n        itemsLoader: null,\r\n        queryMarkPos: null,\r\n        queryStarted: 0,\r\n        upKeyCount: 0,\r\n        downKeyCount: 0,\r\n    };\r\n}\r\nfunction createPlugin(dispatch, typeAhead) {\r\n    return new Plugin({\r\n        key: pluginKey$1,\r\n        state: {\r\n            init: function () {\r\n                return createInitialPluginState();\r\n            },\r\n            apply: function (tr, pluginState, _oldState, state) {\r\n                var meta = tr.getMeta(pluginKey$1) || {};\r\n                var action = meta.action, params = meta.params;\r\n                switch (action) {\r\n                    case ACTIONS.SET_CURRENT_INDEX:\r\n                        return setCurrentItemIndex({\r\n                            dispatch: dispatch,\r\n                            pluginState: pluginState,\r\n                            tr: tr,\r\n                            params: params,\r\n                        });\r\n                    case ACTIONS.SELECT_PREV:\r\n                        return selectPrevActionHandler({ dispatch: dispatch, pluginState: pluginState, tr: tr });\r\n                    case ACTIONS.SELECT_NEXT:\r\n                        return selectNextActionHandler({ dispatch: dispatch, pluginState: pluginState, tr: tr });\r\n                    case ACTIONS.ITEMS_LIST_UPDATED:\r\n                        return itemsListUpdatedActionHandler({ dispatch: dispatch, pluginState: pluginState, tr: tr });\r\n                    case ACTIONS.SELECT_CURRENT:\r\n                        var _a = tr.selection, from = _a.from, to = _a.to;\r\n                        var typeAheadQuery = state.schema.marks.typeAheadQuery;\r\n                        // If inserted content has typeAheadQuery mark should fallback to default action handler\r\n                        return tr.doc.rangeHasMark(from - 1, to, typeAheadQuery)\r\n                            ? defaultActionHandler({\r\n                                dispatch: dispatch,\r\n                                typeAhead: typeAhead,\r\n                                state: state,\r\n                                pluginState: pluginState,\r\n                                tr: tr,\r\n                            })\r\n                            : selectCurrentActionHandler({ dispatch: dispatch, pluginState: pluginState, tr: tr });\r\n                    case ACTIONS.SET_QUERY:\r\n                        return updateQueryHandler({ dispatch: dispatch, pluginState: pluginState, tr: tr, params: params });\r\n                    default:\r\n                        return defaultActionHandler({\r\n                            dispatch: dispatch,\r\n                            typeAhead: typeAhead,\r\n                            state: state,\r\n                            pluginState: pluginState,\r\n                            tr: tr,\r\n                        });\r\n                }\r\n            },\r\n        },\r\n        view: function () {\r\n            return {\r\n                update: function (editorView) {\r\n                    var pluginState = pluginKey$1.getState(editorView.state);\r\n                    if (!pluginState) {\r\n                        return;\r\n                    }\r\n                    var state = editorView.state, dispatch = editorView.dispatch;\r\n                    var doc = state.doc, selection = state.selection;\r\n                    var from = selection.from, to = selection.to;\r\n                    var typeAheadQuery = state.schema.marks.typeAheadQuery;\r\n                    // Disable type ahead query when removing trigger.\r\n                    if (pluginState.active &&\r\n                        !pluginState.query &&\r\n                        !pluginState.trigger) {\r\n                        dismissCommand()(state, dispatch);\r\n                        return;\r\n                    }\r\n                    // Disable type ahead query when the first character is a space.\r\n                    if (pluginState.active &&\r\n                        (pluginState.query || '').indexOf(' ') === 0) {\r\n                        dismissCommand()(state, dispatch);\r\n                        return;\r\n                    }\r\n                    // Optimization to not call dismissCommand if plugin is in an inactive state.\r\n                    if (!pluginState.active &&\r\n                        pluginState.prevActiveState &&\r\n                        !doc.rangeHasMark(from - 1, to, typeAheadQuery)) {\r\n                        dismissCommand()(state, dispatch);\r\n                        return;\r\n                    }\r\n                    // Fetch type ahead items if handler returned a promise.\r\n                    if (pluginState.active && pluginState.itemsLoader) {\r\n                        pluginState.itemsLoader.promise.then(function (items) {\r\n                            return itemsListUpdated(items)(editorView.state, dispatch);\r\n                        });\r\n                    }\r\n                },\r\n            };\r\n        },\r\n        appendTransaction: function (_trs, _oldState, newState) {\r\n            var pluginState = pluginKey$1.getState(newState);\r\n            if (pluginState.active &&\r\n                pluginState.query &&\r\n                pluginState.typeAheadHandler &&\r\n                pluginState.typeAheadHandler.forceSelect &&\r\n                pluginState.typeAheadHandler.forceSelect(pluginState.query, pluginState.items)) {\r\n                var newTr_1;\r\n                selectCurrentItem()(newState, function (tr) { return (newTr_1 = tr); });\r\n                return newTr_1;\r\n            }\r\n            return null;\r\n        },\r\n        props: {\r\n            handleDOMEvents: {\r\n                input: function (view, event) {\r\n                    var state = view.state, dispatch = view.dispatch;\r\n                    var selection = state.selection, schema = state.schema;\r\n                    if (selection instanceof TextSelection &&\r\n                        selection.$cursor &&\r\n                        schema.marks.typeAheadQuery.isInSet(selection.$cursor.marks())) {\r\n                        updateQueryCommand(event.data)(state, dispatch);\r\n                        return false;\r\n                    }\r\n                    return false;\r\n                },\r\n                // FM-2123: On latest Android version Q there's a bug while compositionend,\r\n                // the typeAheadQuery is inserted next to the position of the trigger character (so that creates double characters).\r\n                // In this use case, need to replace the last written character with our typeAheadQuery.\r\n                compositionend: function (view, event) {\r\n                    var state = view.state, dispatch = view.dispatch;\r\n                    var selection = state.selection, schema = state.schema;\r\n                    var triggers = typeAhead.map(function (typeAheadHandler) { return typeAheadHandler.trigger; });\r\n                    if (triggers.indexOf(event.data) !== -1 &&\r\n                        selection instanceof TextSelection &&\r\n                        selection.$cursor &&\r\n                        !schema.marks.typeAheadQuery.isInSet(selection.$cursor.marks())) {\r\n                        insertTypeAheadQuery(event.data, true)(state, dispatch);\r\n                        return true;\r\n                    }\r\n                    return false;\r\n                },\r\n            },\r\n        },\r\n    });\r\n}\r\nfunction createItemsLoader(promiseOfItems) {\r\n    var canceled = false;\r\n    return {\r\n        promise: new Promise(function (resolve, reject) {\r\n            promiseOfItems\r\n                .then(function (result) { return !canceled && resolve(result); })\r\n                .catch(function (error) { return !canceled && reject(error); });\r\n        }),\r\n        cancel: function () {\r\n            canceled = true;\r\n        },\r\n    };\r\n}\r\nfunction defaultActionHandler(_a) {\r\n    var dispatch = _a.dispatch, typeAhead = _a.typeAhead, pluginState = _a.pluginState, state = _a.state, tr = _a.tr;\r\n    var typeAheadQuery = state.schema.marks.typeAheadQuery;\r\n    var doc = state.doc, selection = state.selection;\r\n    var from = selection.from, to = selection.to;\r\n    var isActive = isQueryActive(typeAheadQuery, doc, from - 1, to);\r\n    var isAllowed = isMarkTypeAllowedInCurrentSelection(typeAheadQuery, state);\r\n    if (!isAllowed && !isActive) {\r\n        if (pluginState &&\r\n            pluginState.active === isActive &&\r\n            pluginState.isAllowed === isAllowed) {\r\n            return pluginState;\r\n        }\r\n        var newPluginState_1 = createInitialPluginState(pluginState.active, isAllowed);\r\n        dispatch(pluginKey$1, newPluginState_1);\r\n        return newPluginState_1;\r\n    }\r\n    var nodeBefore = selection.$from.nodeBefore;\r\n    if (!isActive || !nodeBefore || !pluginState) {\r\n        var newPluginState_2 = createInitialPluginState(pluginState ? pluginState.active : false);\r\n        if (!pluginState || pluginState.active || !pluginState.isAllowed) {\r\n            dispatch(pluginKey$1, newPluginState_2);\r\n        }\r\n        return newPluginState_2;\r\n    }\r\n    var typeAheadMark = typeAheadQuery.isInSet(nodeBefore.marks || []);\r\n    if (!typeAheadMark || !typeAheadMark.attrs.trigger) {\r\n        return pluginState;\r\n    }\r\n    var textContent = nodeBefore.textContent || '';\r\n    var trigger = typeAheadMark.attrs.trigger.replace(/([^\\x00-\\xFF]|[\\s\\n])+/g, '');\r\n    // If trigger has been removed, reset plugin state\r\n    if (!textContent.includes(trigger)) {\r\n        var newPluginState_3 = __assign(__assign({}, createInitialPluginState(true)), { active: true });\r\n        dispatch(pluginKey$1, newPluginState_3);\r\n        return newPluginState_3;\r\n    }\r\n    var query = textContent\r\n        .replace(/^([^\\x00-\\xFF]|[\\s\\n])+/g, '')\r\n        .replace(trigger, '');\r\n    var typeAheadHandler = typeAhead.find(function (t) { return t.trigger === trigger; });\r\n    var typeAheadItems = [];\r\n    var itemsLoader = null;\r\n    var highlight = null;\r\n    try {\r\n        var intl = { locale: 'en' };\r\n        typeAheadItems = typeAheadHandler.getItems(query, state, \r\n        // intl,\r\n        {\r\n            prevActive: pluginState.prevActiveState,\r\n            queryChanged: query !== pluginState.query || trigger !== pluginState.trigger,\r\n        }, tr, dispatch);\r\n        if (typeAheadHandler.getHighlight) {\r\n            highlight = typeAheadHandler.getHighlight(state);\r\n        }\r\n        if (pluginState.itemsLoader) {\r\n            pluginState.itemsLoader.cancel();\r\n        }\r\n        if (!Array.isArray(typeAheadItems)) {\r\n            itemsLoader = createItemsLoader(typeAheadItems);\r\n            typeAheadItems = pluginState.items;\r\n        }\r\n    }\r\n    catch (e) { }\r\n    var queryMark = findTypeAheadQuery(state);\r\n    var newPluginState = {\r\n        isAllowed: isAllowed,\r\n        query: query,\r\n        trigger: trigger,\r\n        typeAheadHandler: typeAheadHandler,\r\n        active: true,\r\n        prevActiveState: pluginState.active,\r\n        items: typeAheadItems,\r\n        itemsLoader: itemsLoader,\r\n        currentIndex: pluginState.currentIndex,\r\n        queryMarkPos: queryMark !== null ? queryMark.start : null,\r\n        queryStarted: Date.now(),\r\n        upKeyCount: 0,\r\n        downKeyCount: 0,\r\n        highlight: highlight,\r\n    };\r\n    dispatch(pluginKey$1, newPluginState);\r\n    return newPluginState;\r\n}\r\nfunction setCurrentItemIndex(_a) {\r\n    var dispatch = _a.dispatch, pluginState = _a.pluginState, params = _a.params;\r\n    if (!params) {\r\n        return pluginState;\r\n    }\r\n    var newPluginState = __assign(__assign({}, pluginState), { currentIndex: params.currentIndex || params.currentIndex === 0\r\n            ? params.currentIndex\r\n            : pluginState.currentIndex });\r\n    dispatch(pluginKey$1, newPluginState);\r\n    return newPluginState;\r\n}\r\nfunction updateQueryHandler(_a) {\r\n    var dispatch = _a.dispatch, pluginState = _a.pluginState, params = _a.params;\r\n    if (!params) {\r\n        return pluginState;\r\n    }\r\n    var newPluginState = __assign(__assign({}, pluginState), { query: typeof params.query === 'string' ? params.query : null });\r\n    dispatch(pluginKey$1, newPluginState);\r\n    return newPluginState;\r\n}\r\nfunction selectPrevActionHandler(_a) {\r\n    var dispatch = _a.dispatch, pluginState = _a.pluginState;\r\n    var newIndex = pluginState.currentIndex - 1;\r\n    var newPluginState = __assign(__assign({}, pluginState), { currentIndex: newIndex < 0 ? pluginState.items.length - 1 : newIndex, upKeyCount: ++pluginState.upKeyCount });\r\n    dispatch(pluginKey$1, newPluginState);\r\n    return newPluginState;\r\n}\r\nfunction selectNextActionHandler(_a) {\r\n    var dispatch = _a.dispatch, pluginState = _a.pluginState;\r\n    var newIndex = pluginState.currentIndex + 1;\r\n    var newPluginState = __assign(__assign({}, pluginState), { currentIndex: newIndex > pluginState.items.length - 1 ? 0 : newIndex, downKeyCount: ++pluginState.downKeyCount });\r\n    dispatch(pluginKey$1, newPluginState);\r\n    return newPluginState;\r\n}\r\nfunction itemsListUpdatedActionHandler(_a) {\r\n    var dispatch = _a.dispatch, pluginState = _a.pluginState, tr = _a.tr;\r\n    var items = tr.getMeta(pluginKey$1).items;\r\n    var newPluginState = __assign(__assign({}, pluginState), { items: items, itemsLoader: null, \r\n        // Set to 0 to always reset the query to the top of the typeahead\r\n        currentIndex: 0 });\r\n    dispatch(pluginKey$1, newPluginState);\r\n    return newPluginState;\r\n}\r\nfunction selectCurrentActionHandler(_a) {\r\n    var dispatch = _a.dispatch;\r\n    var newPluginState = createInitialPluginState(false);\r\n    dispatch(pluginKey$1, newPluginState);\r\n    return newPluginState;\r\n}\n\n// We cannot set a proper plugin key on input rule plugins, so instead, once\r\n// the plugin is created we save its key to this variable\r\nvar typeAheadInputRulesPluginKey = '';\r\nfunction inputRulePlugin(schema, typeAheads) {\r\n    var triggersRegex = typeAheads\r\n        .map(function (t) { return t.customRegex || t.trigger; })\r\n        .join('|');\r\n    if (!triggersRegex.length) {\r\n        return;\r\n    }\r\n    var regex = new RegExp(\"(^|[.!?\\\\s\" + leafNodeReplacementCharacter + \"])(\" + triggersRegex + \")$\");\r\n    var typeAheadInputRule = createInputRule(regex, function (state, match) {\r\n        var typeAheadState = pluginKey$1.getState(state);\r\n        /**\r\n         * Why using match 2 and 3?  Regex:\r\n         * (allowed characters before trigger)(joined|triggers|(sub capture groups))\r\n         *            match[1]                     match[2]          match[3] – optional\r\n         */\r\n        var trigger = match[3] || match[2];\r\n        if (!typeAheadState.isAllowed || !trigger) {\r\n            return null;\r\n        }\r\n        var mark = schema.mark('typeAheadQuery', { trigger: trigger });\r\n        var tr = state.tr, selection = state.selection;\r\n        var marks = selection.$from.marks();\r\n        return tr.replaceSelectionWith(schema.text(trigger, __spreadArrays([mark], marks)), false);\r\n    });\r\n    var plugin = instrumentedInputRule('type-ahead', {\r\n        rules: [typeAheadInputRule],\r\n    });\r\n    typeAheadInputRulesPluginKey = plugin.key;\r\n    return plugin;\r\n}\n\nfunction keymapPlugin$1() {\r\n    var list = {};\r\n    bindKeymapWithCommand(enter.common, function (state, dispatch) {\r\n        var pluginState = pluginKey$1.getState(state);\r\n        if (!pluginState || !pluginState.active) {\r\n            return false;\r\n        }\r\n        return selectCurrentItem('enter')(state, dispatch);\r\n    }, list);\r\n    bindKeymapWithCommand(moveUp.common, function (state, dispatch) {\r\n        var pluginState = pluginKey$1.getState(state);\r\n        if (!pluginState || !pluginState.active) {\r\n            return false;\r\n        }\r\n        if (dispatch) {\r\n            dispatch(state.tr.setMeta(pluginKey$1, { action: ACTIONS.SELECT_PREV }));\r\n        }\r\n        return true;\r\n    }, list);\r\n    bindKeymapWithCommand(moveDown.common, function (state, dispatch) {\r\n        var pluginState = pluginKey$1.getState(state);\r\n        if (!pluginState || !pluginState.active) {\r\n            return false;\r\n        }\r\n        if (dispatch) {\r\n            dispatch(state.tr.setMeta(pluginKey$1, { action: ACTIONS.SELECT_NEXT }));\r\n        }\r\n        return true;\r\n    }, list);\r\n    bindKeymapWithCommand(insertNewLine.common, function (state, dispatch) {\r\n        var pluginState = pluginKey$1.getState(state);\r\n        if (!pluginState || !pluginState.active) {\r\n            return false;\r\n        }\r\n        return selectCurrentItem('shift-enter')(state, dispatch);\r\n    }, list);\r\n    bindKeymapWithCommand(tab.common, function (state, dispatch) {\r\n        var pluginState = pluginKey$1.getState(state);\r\n        if (!pluginState || !pluginState.active) {\r\n            return false;\r\n        }\r\n        return selectCurrentItem('tab')(state, dispatch);\r\n    }, list);\r\n    bindKeymapWithCommand(escape.common, function (state, dispatch) {\r\n        var pluginState = pluginKey$1.getState(state);\r\n        if (!pluginState || !pluginState.active) {\r\n            return false;\r\n        }\r\n        /**\r\n         * Jira uses escape to toggle the collapsed editor\r\n         * stop the event propagation when the picker is open\r\n         */\r\n        if (window.event) {\r\n            window.event.stopPropagation();\r\n        }\r\n        return dismissCommand()(state, dispatch);\r\n    }, list);\r\n    bindKeymapWithCommand(space.common, function (state, dispatch) {\r\n        var pluginState = pluginKey$1.getState(state);\r\n        if (pluginState && pluginState.active) {\r\n            return selectSingleItemOrDismiss('space')(state, dispatch);\r\n        }\r\n        return false;\r\n    }, list);\r\n    return keymap(list);\r\n}\n\nfunction isBody(elem) {\r\n    return elem === document.body;\r\n}\r\nfunction isTextNode(elem) {\r\n    return elem && elem.nodeType === 3;\r\n}\r\n/**\r\n * Decides if given fitHeight fits below or above the target taking boundaries into account.\r\n */\r\nfunction getVerticalPlacement(target, boundariesElement, fitHeight, alignY, forcePlacement) {\r\n    if (forcePlacement && alignY) {\r\n        return alignY;\r\n    }\r\n    if (!fitHeight) {\r\n        return 'bottom';\r\n    }\r\n    if (isTextNode(target)) {\r\n        target = target.parentElement;\r\n    }\r\n    var boundariesClientRect = boundariesElement.getBoundingClientRect();\r\n    var boundariesHeight = boundariesClientRect.height;\r\n    var boundariesTop = isBody(boundariesElement)\r\n        ? 0\r\n        : boundariesClientRect.top;\r\n    var _a = target.getBoundingClientRect(), targetTop = _a.top, targetHeight = _a.height;\r\n    var spaceAbove = targetTop - (boundariesTop - boundariesElement.scrollTop);\r\n    var spaceBelow = boundariesTop + boundariesHeight - (targetTop + targetHeight);\r\n    if (spaceBelow >= fitHeight || spaceBelow >= spaceAbove) {\r\n        return 'bottom';\r\n    }\r\n    return 'top';\r\n}\r\n/**\r\n * Decides if given fitWidth fits to the left or to the right of the target taking boundaries into account.\r\n */\r\nfunction getHorizontalPlacement(target, boundariesElement, fitWidth, alignX, forcePlacement) {\r\n    if (forcePlacement && alignX) {\r\n        return alignX;\r\n    }\r\n    if (!fitWidth) {\r\n        return alignX || 'left';\r\n    }\r\n    if (isTextNode(target)) {\r\n        target = target.parentElement;\r\n    }\r\n    var _a = target.getBoundingClientRect(), targetLeft = _a.left, targetWidth = _a.width;\r\n    var _b = boundariesElement.getBoundingClientRect(), boundariesLeft = _b.left, boundariesWidth = _b.width;\r\n    var spaceLeft = targetLeft - boundariesLeft + targetWidth;\r\n    var spaceRight = boundariesLeft + boundariesWidth - targetLeft;\r\n    if (alignX && spaceLeft > fitWidth && spaceRight > fitWidth) {\r\n        return alignX;\r\n    }\r\n    else if (spaceRight >= fitWidth || (spaceRight >= spaceLeft && !alignX)) {\r\n        return 'left';\r\n    }\r\n    return 'right';\r\n}\r\nfunction calculatePlacement(target, boundariesElement, fitWidth, fitHeight, alignX, alignY, forcePlacement) {\r\n    return [\r\n        getVerticalPlacement(target, boundariesElement, fitHeight, alignY, forcePlacement),\r\n        getHorizontalPlacement(target, boundariesElement, fitWidth, alignX, forcePlacement),\r\n    ];\r\n}\r\nvar calculateHorizontalPlacement = function (_a) {\r\n    var placement = _a.placement, targetLeft = _a.targetLeft, targetRight = _a.targetRight, targetWidth = _a.targetWidth, isPopupParentBody = _a.isPopupParentBody, popupOffsetParentLeft = _a.popupOffsetParentLeft, popupOffsetParentRight = _a.popupOffsetParentRight, popupOffsetParentScrollLeft = _a.popupOffsetParentScrollLeft, popupOffsetParentClientWidth = _a.popupOffsetParentClientWidth, popupClientWidth = _a.popupClientWidth, offset = _a.offset, _b = _a.allowOutOfBounds, allowOutOfBounds = _b === void 0 ? false : _b;\r\n    var position = {};\r\n    if (placement === 'left') {\r\n        position.left = Math.ceil(targetLeft -\r\n            popupOffsetParentLeft +\r\n            (isPopupParentBody ? 0 : popupOffsetParentScrollLeft) +\r\n            offset[0]);\r\n    }\r\n    else if (placement === 'center') {\r\n        position.left = Math.ceil(targetLeft -\r\n            popupOffsetParentLeft +\r\n            (isPopupParentBody ? 0 : popupOffsetParentScrollLeft) +\r\n            offset[0] +\r\n            targetWidth / 2 -\r\n            popupClientWidth / 2);\r\n    }\r\n    else if (placement === 'end') {\r\n        var left = Math.ceil(targetRight -\r\n            popupOffsetParentLeft +\r\n            (isPopupParentBody ? 0 : popupOffsetParentScrollLeft) +\r\n            offset[0]);\r\n        position.left = left;\r\n    }\r\n    else {\r\n        position.right = Math.ceil(popupOffsetParentRight -\r\n            targetRight -\r\n            (isPopupParentBody ? 0 : popupOffsetParentScrollLeft) +\r\n            offset[0]);\r\n    }\r\n    if (!allowOutOfBounds) {\r\n        if (position.left !== undefined) {\r\n            position.left = getPopupXInsideParent(position.left, popupClientWidth, popupOffsetParentClientWidth);\r\n        }\r\n        if (position.right !== undefined) {\r\n            position.right = getPopupXInsideParent(position.right, popupClientWidth, popupOffsetParentClientWidth);\r\n        }\r\n    }\r\n    return position;\r\n};\r\nvar getPopupXInsideParent = function (x, popupClientWidth, popupOffsetParentClientWidth) {\r\n    // minimum distance the popup can be from the edge of its parent\r\n    var minPopupMargin = 1;\r\n    // prevent going too far right\r\n    if (popupOffsetParentClientWidth < x + popupClientWidth) {\r\n        x = popupOffsetParentClientWidth - popupClientWidth - minPopupMargin;\r\n    }\r\n    // prevent going too far left\r\n    return Math.max(minPopupMargin, x);\r\n};\r\nvar calculateVerticalStickBottom = function (_a) {\r\n    var target = _a.target, targetTop = _a.targetTop, targetHeight = _a.targetHeight, popup = _a.popup, offset = _a.offset, position = _a.position;\r\n    var scrollParent = findOverflowScrollParent(target);\r\n    var newPos = __assign({}, position);\r\n    if (scrollParent) {\r\n        var topOffsetTop = targetTop - scrollParent.getBoundingClientRect().top;\r\n        var targetEnd = targetHeight + topOffsetTop;\r\n        if (scrollParent.clientHeight - targetEnd <=\r\n            popup.clientHeight + offset[1] * 2 &&\r\n            topOffsetTop < scrollParent.clientHeight) {\r\n            var scroll_1 = targetEnd - scrollParent.clientHeight + offset[1] * 2;\r\n            var top_1 = newPos.top || 0;\r\n            top_1 = top_1 - (scroll_1 + popup.clientHeight);\r\n            newPos.top = top_1;\r\n        }\r\n    }\r\n    return newPos;\r\n};\r\nvar calculateVerticalStickTop = function (_a) {\r\n    var target = _a.target, targetTop = _a.targetTop, targetHeight = _a.targetHeight, popupOffsetParentHeight = _a.popupOffsetParentHeight, popupOffsetParent = _a.popupOffsetParent, offset = _a.offset, position = _a.position, placement = _a.placement;\r\n    var scrollParent = findOverflowScrollParent(target);\r\n    var newPos = __assign({}, position);\r\n    if (scrollParent) {\r\n        var scrollParentTop = scrollParent.getBoundingClientRect().top;\r\n        var topBoundary = targetTop - scrollParentTop;\r\n        var scrollParentScrollTop = scrollParent.scrollTop;\r\n        if (topBoundary < 0) {\r\n            var isBelowNodeBoundary = targetTop +\r\n                (scrollParentScrollTop - scrollParentTop) +\r\n                targetHeight +\r\n                offset[1] <\r\n                scrollParentScrollTop;\r\n            if (placement === 'top') {\r\n                if (isBelowNodeBoundary) {\r\n                    newPos.bottom =\r\n                        popupOffsetParentHeight -\r\n                            (topBoundary + popupOffsetParent.scrollTop + targetHeight);\r\n                }\r\n                else {\r\n                    newPos.bottom = topBoundary + (newPos.bottom || 0);\r\n                }\r\n            }\r\n            if (placement === 'start') {\r\n                if (isBelowNodeBoundary) {\r\n                    newPos.top = topBoundary + popupOffsetParent.scrollTop + targetHeight;\r\n                }\r\n                else {\r\n                    newPos.top = Math.abs(topBoundary) + (newPos.top || 0) + offset[1];\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return newPos;\r\n};\r\nvar calculateVerticalPlacement = function (_a) {\r\n    var placement = _a.placement, targetTop = _a.targetTop, targetHeight = _a.targetHeight, isPopupParentBody = _a.isPopupParentBody, popupOffsetParentHeight = _a.popupOffsetParentHeight, popupOffsetParentTop = _a.popupOffsetParentTop, popupOffsetParentScrollTop = _a.popupOffsetParentScrollTop, borderBottomWidth = _a.borderBottomWidth, offset = _a.offset;\r\n    var position = {};\r\n    if (placement === 'top') {\r\n        position.bottom = Math.ceil(popupOffsetParentHeight -\r\n            (targetTop - popupOffsetParentTop) -\r\n            (isPopupParentBody ? 0 : popupOffsetParentScrollTop) -\r\n            borderBottomWidth +\r\n            offset[1]);\r\n    }\r\n    else if (placement === 'start') {\r\n        position.top = Math.ceil(targetTop -\r\n            popupOffsetParentTop -\r\n            offset[1] +\r\n            (isPopupParentBody ? 0 : popupOffsetParentScrollTop));\r\n    }\r\n    else {\r\n        var top_2 = Math.ceil(targetTop -\r\n            popupOffsetParentTop +\r\n            targetHeight +\r\n            (isPopupParentBody ? 0 : popupOffsetParentScrollTop) -\r\n            borderBottomWidth +\r\n            offset[1]);\r\n        position.top = top_2;\r\n    }\r\n    return position;\r\n};\r\n/**\r\n * Calculates relative coordinates for placing popup along with the target.\r\n * Uses placement from calculatePlacement.\r\n */\r\nfunction calculatePosition(_a) {\r\n    var placement = _a.placement, target = _a.target, popup = _a.popup, offset = _a.offset, stick = _a.stick, _b = _a.allowOutOfBounds, allowOutOfBounds = _b === void 0 ? false : _b, rect = _a.rect;\r\n    var position = {};\r\n    if (!target || !popup || !popup.offsetParent) {\r\n        return position;\r\n    }\r\n    if (isTextNode(target)) {\r\n        target = target.parentElement;\r\n    }\r\n    var popupOffsetParent = popup.offsetParent;\r\n    var offsetParentStyle = popupOffsetParent.style;\r\n    var borderBottomWidth = 0;\r\n    if (offsetParentStyle && offsetParentStyle.borderBottomWidth) {\r\n        borderBottomWidth = parseInt(offsetParentStyle.borderBottomWidth, 10);\r\n    }\r\n    var verticalPlacement = placement[0], horizontalPlacement = placement[1];\r\n    var _c = rect ? rect : popupOffsetParent.getBoundingClientRect(), popupOffsetParentTop = _c.top, popupOffsetParentLeft = _c.left, popupOffsetParentRight = _c.right, popupOffsetParentHeight = _c.height;\r\n    var _d = target.getBoundingClientRect(), targetTop = _d.top, targetLeft = _d.left, targetRight = _d.right, targetHeight = _d.height, targetWidth = _d.width;\r\n    var isPopupParentBody = isBody(popupOffsetParent);\r\n    var verticalPosition = calculateVerticalPlacement({\r\n        placement: verticalPlacement,\r\n        targetTop: targetTop,\r\n        isPopupParentBody: isPopupParentBody,\r\n        popupOffsetParentHeight: popupOffsetParentHeight,\r\n        popupOffsetParentTop: popupOffsetParentTop,\r\n        popupOffsetParentScrollTop: popupOffsetParent.scrollTop || 0,\r\n        targetHeight: targetHeight,\r\n        borderBottomWidth: borderBottomWidth,\r\n        offset: offset,\r\n    });\r\n    position = __assign(__assign({}, position), verticalPosition);\r\n    if ((verticalPlacement === 'top' || verticalPlacement === 'start') && stick) {\r\n        position = calculateVerticalStickTop({\r\n            target: target,\r\n            targetTop: targetTop,\r\n            targetHeight: targetHeight,\r\n            popupOffsetParentHeight: popupOffsetParentHeight,\r\n            popupOffsetParent: popupOffsetParent,\r\n            popup: popup,\r\n            offset: offset,\r\n            position: position,\r\n            placement: verticalPlacement,\r\n        });\r\n    }\r\n    if (verticalPlacement !== 'top' && verticalPlacement !== 'start' && stick) {\r\n        position = calculateVerticalStickBottom({\r\n            target: target,\r\n            targetTop: targetTop,\r\n            targetHeight: targetHeight,\r\n            popup: popup,\r\n            offset: offset,\r\n            position: position,\r\n        });\r\n    }\r\n    var horizontalPosition = calculateHorizontalPlacement({\r\n        placement: horizontalPlacement,\r\n        targetLeft: targetLeft,\r\n        targetRight: targetRight,\r\n        targetWidth: targetWidth,\r\n        isPopupParentBody: isPopupParentBody,\r\n        popupOffsetParentLeft: popupOffsetParentLeft,\r\n        popupOffsetParentRight: popupOffsetParentRight,\r\n        popupOffsetParentScrollLeft: popupOffsetParent.scrollLeft || 0,\r\n        popupOffsetParentClientWidth: popup.offsetParent.clientWidth,\r\n        popupClientWidth: popup.clientWidth || 0,\r\n        offset: offset,\r\n        allowOutOfBounds: allowOutOfBounds,\r\n    });\r\n    position = __assign(__assign({}, position), horizontalPosition);\r\n    return position;\r\n}\r\nfunction validatePosition(popup) {\r\n    // popup.offsetParent does not exist if the popup element is not mounted\r\n    if (!popup || !popup.offsetParent) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n/**\r\n * Traverse DOM Tree upwards looking for popup parents with \"overflow: scroll\".\r\n */\r\nfunction findOverflowScrollParent(popup) {\r\n    var parent = popup;\r\n    if (!parent) {\r\n        return false;\r\n    }\r\n    while ((parent = parent.parentElement)) {\r\n        // IE11 on Window 8 doesn't show styles from CSS when accessing through element.style property.\r\n        var style = window.getComputedStyle(parent);\r\n        if (style.overflow === 'scroll' ||\r\n            style.overflowX === 'scroll' ||\r\n            style.overflowY === 'scroll' ||\r\n            parent.classList.contains('fabric-editor-popup-scroll-parent')) {\r\n            return parent;\r\n        }\r\n    }\r\n    return false;\r\n}\n\n// import { akEditorFloatingPanelZIndex } from '@atlaskit/editor-shared-styles';\r\nvar akEditorFloatingPanelZIndex = 10;\r\nvar Popup = /** @class */ (function (_super) {\r\n    __extends(Popup, _super);\r\n    function Popup() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = {\r\n            overflowScrollParent: false,\r\n            validPosition: true,\r\n        };\r\n        _this.placement = ['', ''];\r\n        _this.handleRef = function (popup) {\r\n            if (!popup) {\r\n                return;\r\n            }\r\n            _this.initPopup(popup);\r\n        };\r\n        _this.scheduledUpdatePosition = rafSchedule(function (props) {\r\n            return _this.updatePosition(props);\r\n        });\r\n        _this.onResize = function () { return _this.scheduledUpdatePosition(_this.props); };\r\n        return _this;\r\n    }\r\n    /**\r\n     * Calculates new popup position\r\n     */\r\n    Popup.prototype.updatePosition = function (props, state) {\r\n        if (props === void 0) { props = this.props; }\r\n        if (state === void 0) { state = this.state; }\r\n        var target = props.target, fitHeight = props.fitHeight, fitWidth = props.fitWidth, boundariesElement = props.boundariesElement, offset = props.offset, onPositionCalculated = props.onPositionCalculated, onPlacementChanged = props.onPlacementChanged, alignX = props.alignX, alignY = props.alignY, stick = props.stick, forcePlacement = props.forcePlacement, allowOutOfBounds = props.allowOutOfBounds, rect = props.rect;\r\n        var popup = state.popup;\r\n        if (!target || !popup) {\r\n            return;\r\n        }\r\n        var placement = calculatePlacement(target, boundariesElement || document.body, fitWidth, fitHeight, alignX, alignY, forcePlacement);\r\n        if (onPlacementChanged && this.placement.join('') !== placement.join('')) {\r\n            onPlacementChanged(placement);\r\n            this.placement = placement;\r\n        }\r\n        var position = calculatePosition({\r\n            placement: placement,\r\n            popup: popup,\r\n            target: target,\r\n            stick: stick,\r\n            offset: offset,\r\n            allowOutOfBounds: allowOutOfBounds,\r\n            rect: rect,\r\n        });\r\n        position = onPositionCalculated ? onPositionCalculated(position) : position;\r\n        this.setState({\r\n            position: position,\r\n            validPosition: validatePosition(target),\r\n        });\r\n    };\r\n    Popup.prototype.cannotSetPopup = function (popup, target, overflowScrollParent) {\r\n        /**\r\n         * Check whether:\r\n         * 1. Popup's offset targets which means whether or not its possible to correctly position popup along with given target.\r\n         * 2. Popup is inside \"overflow: scroll\" container, but its offset parent isn't.\r\n         *\r\n         * Currently Popup isn't capable of position itself correctly in case 2,\r\n         * Add \"position: relative\" to \"overflow: scroll\" container or to some other FloatingPanel wrapper inside it.\r\n         */\r\n        return (!target ||\r\n            (document.body.contains(target) &&\r\n                popup.offsetParent &&\r\n                !popup.offsetParent.contains(target)) ||\r\n            (overflowScrollParent &&\r\n                !overflowScrollParent.contains(popup.offsetParent)));\r\n    };\r\n    /**\r\n     * Popup initialization.\r\n     * Checks whether it's possible to position popup along given target, and if it's not throws an error.\r\n     */\r\n    Popup.prototype.initPopup = function (popup) {\r\n        var _this = this;\r\n        var target = this.props.target;\r\n        var overflowScrollParent = findOverflowScrollParent(popup);\r\n        if (this.cannotSetPopup(popup, target, overflowScrollParent)) {\r\n            return;\r\n        }\r\n        this.setState({ popup: popup, overflowScrollParent: overflowScrollParent }, function () { return _this.scheduledUpdatePosition(_this.props); });\r\n    };\r\n    Popup.prototype.UNSAFE_componentWillReceiveProps = function (newProps) {\r\n        // We are delaying `updatePosition` otherwise it happens before the children\r\n        // get rendered and we end up with a wrong position\r\n        this.scheduledUpdatePosition(newProps);\r\n    };\r\n    Popup.prototype.componentDidMount = function () {\r\n        window.addEventListener('resize', this.onResize);\r\n        var stick = this.props.stick;\r\n        if (stick) {\r\n            this.scrollElement = findOverflowScrollParent(this.props.target);\r\n        }\r\n        else {\r\n            this.scrollElement = this.props.scrollableElement;\r\n        }\r\n        if (this.scrollElement) {\r\n            this.scrollElement.addEventListener('scroll', this.onResize);\r\n        }\r\n    };\r\n    Popup.prototype.componentWillUnmount = function () {\r\n        window.removeEventListener('resize', this.onResize);\r\n        if (this.scrollElement) {\r\n            this.scrollElement.removeEventListener('scroll', this.onResize);\r\n        }\r\n        this.scheduledUpdatePosition.cancel();\r\n    };\r\n    Popup.prototype.renderPopup = function () {\r\n        var position = this.state.position;\r\n        var shouldRenderPopup = this.props.shouldRenderPopup;\r\n        if (shouldRenderPopup && !shouldRenderPopup(position || {})) {\r\n            return null;\r\n        }\r\n        return (React.createElement(\"div\", { ref: this.handleRef, style: __assign({ position: 'absolute', zIndex: this.props.zIndex || akEditorFloatingPanelZIndex }, position), \"aria-label\": this.props.ariaLabel || 'Popup', \"data-editor-popup\": true }, this.props.children));\r\n    };\r\n    Popup.prototype.render = function () {\r\n        var _a = this.props, target = _a.target, mountTo = _a.mountTo;\r\n        var validPosition = this.state.validPosition;\r\n        if (!target || !validPosition) {\r\n            return null;\r\n        }\r\n        if (mountTo) {\r\n            return createPortal(this.renderPopup(), mountTo);\r\n        }\r\n        // Without mountTo property renders popup as is,\r\n        // which means it will be cropped by \"overflow: hidden\" container.\r\n        return this.renderPopup();\r\n    };\r\n    Popup.defaultProps = {\r\n        offset: [0, 0],\r\n        allowOutOfBound: false,\r\n    };\r\n    return Popup;\r\n}(React.Component));\n\n/*\r\n  These theme values are expressed as functions so that if we decide to make\r\n  them dependent on props in the future, it wouldn't require a significant\r\n  refactor everywhere they are being used.\r\n*/\r\nvar borderRadius = function () { return 3; };\r\nvar gridSize = function () { return 8; };\r\nvar fontSize = function () { return 14; };\r\nvar fontSizeSmall = function () { return 11; };\r\n// export const skeletonShimmer = () =>\r\n//   ({\r\n//     css: {\r\n//       backgroundColor: skeletonColor(),\r\n//       animationDuration: '1.5s',\r\n//       animationIterationCount: 'infinite',\r\n//       animationTimingFunction: 'linear',\r\n//       animationDirection: 'alternate',\r\n//     },\r\n//     keyframes: {\r\n//       from: {\r\n//         backgroundColor: skeletonColor(),\r\n//       },\r\n//       to: {\r\n//         backgroundColor: N30A,\r\n//       },\r\n//     },\r\n//   } as const);\n\n// If a generic is used here, props can be inferred never and passed up (even with defaults)\r\nfunction divide(fn, divisor) {\r\n    return function (props) { return fn(props) / divisor; };\r\n}\n\nvar setCurrentIndex = function (currentIndex) { return function (state, dispatch) {\r\n    if (dispatch) {\r\n        dispatch(state.tr.setMeta(pluginKey$1, {\r\n            action: ACTIONS.SET_CURRENT_INDEX,\r\n            params: { currentIndex: currentIndex },\r\n        }));\r\n    }\r\n    return true;\r\n}; };\n\nvar themeNamespace = '@atlaskit-shared-theme/item';\r\n// Used for Group titles and Item descriptions\r\nvar compactSmallFontSize = 10;\r\nvar compactLineHeight = 1.2;\r\nvar gridSize$1 = gridSize();\r\nvar defaultTheme = {\r\n    afterItemSpacing: {\r\n        compact: gridSize(),\r\n        default: gridSize(),\r\n    },\r\n    beforeItemSpacing: {\r\n        compact: gridSize(),\r\n        default: gridSize(),\r\n    },\r\n    borderRadius: borderRadius(),\r\n    focus: {\r\n        outline: B100,\r\n    },\r\n    height: {\r\n        compact: 0,\r\n        default: 0,\r\n    },\r\n    width: {\r\n        compact: 'auto',\r\n        default: 'auto',\r\n    },\r\n    padding: {\r\n        default: {\r\n            bottom: gridSize() / 2,\r\n            left: gridSize() / 2,\r\n            right: gridSize() / 2,\r\n            top: gridSize() / 2,\r\n        },\r\n        compact: {\r\n            bottom: gridSize(),\r\n            left: gridSize(),\r\n            right: gridSize(),\r\n            top: gridSize(),\r\n        },\r\n    },\r\n    default: {\r\n        background: background,\r\n        text: text$1,\r\n        secondaryText: N200,\r\n    },\r\n    selected: {\r\n        background: backgroundActive,\r\n        text: N500,\r\n        secondaryText: N200,\r\n    },\r\n    active: {\r\n        background: backgroundActive,\r\n        text: textActive,\r\n        secondaryText: N200,\r\n    },\r\n    hover: {\r\n        background: backgroundHover,\r\n        text: textHover,\r\n        secondaryText: N200,\r\n    },\r\n    disabled: {\r\n        background: N0,\r\n        text: N200,\r\n        secondaryText: N200,\r\n    },\r\n    // same as hover in this case\r\n    dragging: {\r\n        background: N20,\r\n        text: N800,\r\n        secondaryText: N200,\r\n    },\r\n};\r\nvar isValidCssValue = function (value) {\r\n    return value !== undefined && value !== null && value !== '';\r\n};\r\n// Returns the theme that contains the requested theme key(s), preferring the user-supplied\r\n// theme if it is provided.\r\nvar themeWithKeys = function (maybeTheme, key, parentKey) {\r\n    if (parentKey) {\r\n        return maybeTheme &&\r\n            maybeTheme[parentKey] &&\r\n            isValidCssValue(maybeTheme[parentKey][key])\r\n            ? maybeTheme\r\n            : defaultTheme;\r\n    }\r\n    return maybeTheme && isValidCssValue(maybeTheme[key])\r\n        ? maybeTheme\r\n        : defaultTheme;\r\n};\r\n// Returns the theme value for the requested key(s), falling back to the default theme if the\r\n// user-supplied theme doesn't exist or doesn't contain the requested key(s)\r\nvar getThemeStyle = function (maybeTheme, key, parentKey) {\r\n    var theme = themeWithKeys(maybeTheme, key, parentKey);\r\n    return parentKey ? theme[parentKey][key] : theme[key];\r\n};\n\nvar getItemState = function (stateName) { return function (_a) {\r\n    var theme = _a.theme;\r\n    var stateStyles = getThemeStyle(theme[themeNamespace], stateName);\r\n    return css(templateObject_1$2 || (templateObject_1$2 = __makeTemplateObject([\"\\n    background-color: \", \";\\n    color: \", \";\\n    fill: \", \";\\n    text-decoration: none;\\n\\n    &:focus {\\n      color: \", \";\\n    }\\n  \"], [\"\\n    background-color: \", \";\\n    color: \", \";\\n    fill: \", \";\\n    text-decoration: none;\\n\\n    &:focus {\\n      color: \", \";\\n    }\\n  \"])), stateStyles.background, stateStyles.text, stateStyles.background, stateStyles.text);\r\n}; };\r\nvar getPadding = function (_a) {\r\n    var isCompact = _a.isCompact, theme = _a.theme, description = _a.description;\r\n    var paddingKey = isCompact ? 'compact' : 'default';\r\n    var _b = getThemeStyle(theme[themeNamespace], paddingKey, 'padding'), _c = _b.bottom, bottom = _c === void 0 ? 0 : _c, _d = _b.left, left = _d === void 0 ? 0 : _d, _e = _b.right, right = _e === void 0 ? 0 : _e, _f = _b.top, top = _f === void 0 ? 0 : _f;\r\n    var adjustedTop = typeof top === 'function' ? top() : top;\r\n    var adjustedBottom = typeof bottom === 'function' ? bottom() : bottom;\r\n    // Subtract the 1px padding-bottom added to the content and description elements\r\n    // to maintain original height\r\n    adjustedTop = Math.max(description ? adjustedTop - 1 : adjustedTop, 0);\r\n    adjustedBottom = Math.max(adjustedBottom - 1, 0);\r\n    return css(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"\\n    padding: \", \"px \", \"px \", \"px \", \"px;\\n  \"], [\"\\n    padding: \", \"px \", \"px \", \"px \", \"px;\\n  \"])), adjustedTop, right, adjustedBottom, left);\r\n};\r\nvar getHeightStyles = function (_a) {\r\n    var isCompact = _a.isCompact, theme = _a.theme;\r\n    var heightKey = isCompact ? 'compact' : 'default';\r\n    var height = getThemeStyle(theme[themeNamespace], heightKey, 'height');\r\n    return height\r\n        ? css(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"\\n        height: \", \"px;\\n      \"], [\"\\n        height: \", \"px;\\n      \"])), height) : '';\r\n};\r\nvar getWidthStyles = function (_a) {\r\n    var isCompact = _a.isCompact, theme = _a.theme;\r\n    var widthKey = isCompact ? 'compact' : 'default';\r\n    var width = getThemeStyle(theme[themeNamespace], widthKey, 'width');\r\n    if (!width) {\r\n        return '';\r\n    }\r\n    return typeof width === 'number'\r\n        ? css(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"\\n        width: \", \"px;\\n      \"], [\"\\n        width: \", \"px;\\n      \"])), width) : css(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"\\n        width: \", \";\\n      \"], [\"\\n        width: \", \";\\n      \"])), width);\r\n};\r\nvar getInteractiveStyles = function (_a) {\r\n    var theme = _a.theme, isDisabled = _a.isDisabled, isDragging = _a.isDragging, isSelected = _a.isSelected;\r\n    if (isDragging) {\r\n        return css(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"\\n      \", \" box-shadow: 0 4px 8px -2px \", \",\\n        0 0 1px \", \";\\n    \"], [\"\\n      \",\r\n            \" box-shadow: 0 4px 8px -2px \", \",\\n        0 0 1px \", \";\\n    \"])), getItemState('dragging'), N60A, N60A);\r\n    }\r\n    var standardFocus = css(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"\\n    &:focus {\\n      box-shadow: 0 0 0 2px\\n        \", \" inset;\\n      text-decoration: none;\\n    }\\n  \"], [\"\\n    &:focus {\\n      box-shadow: 0 0 0 2px\\n        \", \" inset;\\n      text-decoration: none;\\n    }\\n  \"])), getThemeStyle(theme[themeNamespace], 'outline', 'focus'));\r\n    if (isDisabled) {\r\n        return css(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"\\n      cursor: not-allowed;\\n      \", \"\\n      \", \";\\n    \"], [\"\\n      cursor: not-allowed;\\n      \", \"\\n      \", \";\\n    \"])), getItemState('disabled'), standardFocus);\r\n    }\r\n    if (isSelected) {\r\n        return css(templateObject_9 || (templateObject_9 = __makeTemplateObject([\"\\n      \", \" &:hover {\\n        \", \";\\n      }\\n\\n      &:active {\\n        \", \";\\n      }\\n\\n      \", \";\\n    \"], [\"\\n      \", \" &:hover {\\n        \", \";\\n      }\\n\\n      &:active {\\n        \", \";\\n      }\\n\\n      \", \";\\n    \"])), getItemState('selected'), getItemState('hover'), getItemState('active'), standardFocus);\r\n    }\r\n    return css(templateObject_10 || (templateObject_10 = __makeTemplateObject([\"\\n    &:hover {\\n      \", \";\\n    }\\n\\n    &:active {\\n      \", \";\\n    }\\n\\n    \", \";\\n  \"], [\"\\n    &:hover {\\n      \", \";\\n    }\\n\\n    &:active {\\n      \", \";\\n    }\\n\\n    \", \";\\n  \"])), getItemState('hover'), getItemState('active'), standardFocus);\r\n};\r\nvar ItemBase = function (_a) {\r\n    var theme = _a.theme;\r\n    return css(templateObject_11 || (templateObject_11 = __makeTemplateObject([\"\\n  && {\\n    align-items: center;\\n    border-radius: \", \"px;\\n    box-sizing: border-box;\\n    cursor: pointer;\\n    display: \", \";\\n    flex: none;\\n    \", \" \", \" \", \" \", \" \", \" &:focus {\\n      /* focus shadow drawn by getInteractiveStyles */\\n\\n      outline: none;\\n      /* relative position prevents bgcolor of a hovered element from\\n      obfuscating focus ring of a focused sibling element */\\n      position: relative;\\n    }\\n  }\\n\"], [\"\\n  && {\\n    align-items: center;\\n    border-radius: \", \"px;\\n    box-sizing: border-box;\\n    cursor: pointer;\\n    display: \", \";\\n    flex: none;\\n    \",\r\n        \" \", \" \", \" \", \" \", \" &:focus {\\n      /* focus shadow drawn by getInteractiveStyles */\\n\\n      outline: none;\\n      /* relative position prevents bgcolor of a hovered element from\\n      obfuscating focus ring of a focused sibling element */\\n      position: relative;\\n    }\\n  }\\n\"])), getThemeStyle(theme[themeNamespace], 'borderRadius'), function (_a) {\r\n        var isHidden = _a.isHidden;\r\n        return (isHidden ? 'none' : 'flex');\r\n    }, getItemState('default'), getPadding, getInteractiveStyles, getHeightStyles, getWidthStyles);\r\n};\r\nvar styledRootElement = function (_a) {\r\n    var href = _a.href, linkComponent = _a.linkComponent;\r\n    if (linkComponent) {\r\n        return styled(linkComponent)(templateObject_12 || (templateObject_12 = __makeTemplateObject([\"\\n      \", \";\\n    \"], [\"\\n      \", \";\\n    \"])), ItemBase);\r\n    }\r\n    if (href) {\r\n        return styled.a(templateObject_13 || (templateObject_13 = __makeTemplateObject([\"\\n      \", \";\\n    \"], [\"\\n      \", \";\\n    \"])), ItemBase);\r\n    }\r\n    return styled.span(templateObject_14 || (templateObject_14 = __makeTemplateObject([\"\\n    \", \";\\n  \"], [\"\\n    \", \";\\n  \"])), ItemBase);\r\n};\r\nvar templateObject_1$2, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9, templateObject_10, templateObject_11, templateObject_12, templateObject_13, templateObject_14;\n\n// Checkbox/Radio wrapper -- sits left of the children\r\nvar InputWrapper = styled.span(templateObject_1$3 || (templateObject_1$3 = __makeTemplateObject([\"\\n  display: flex;\\n  margin: 0 2px;\\n\"], [\"\\n  display: flex;\\n  margin: 0 2px;\\n\"])));\r\n// Elements injected before/after the children\r\nvar BeforeAfterBase = styled.span(templateObject_2$1 || (templateObject_2$1 = __makeTemplateObject([\"\\n  align-items: center;\\n  display: flex;\\n  flex-shrink: 0;\\n  /* Fix windows line-height issue */\\n  padding-bottom: 1px;\\n\"], [\"\\n  align-items: center;\\n  display: flex;\\n  flex-shrink: 0;\\n  /* Fix windows line-height issue */\\n  padding-bottom: 1px;\\n\"])));\r\nvar getBeforeSpacing = function (_a) {\r\n    var isCompact = _a.isCompact, theme = _a.theme;\r\n    var spaceKey = isCompact ? 'compact' : 'default';\r\n    var space = getThemeStyle(theme[themeNamespace], spaceKey, 'beforeItemSpacing');\r\n    return css(templateObject_3$1 || (templateObject_3$1 = __makeTemplateObject([\"\\n    margin-right: \", \"px;\\n  \"], [\"\\n    margin-right: \", \"px;\\n  \"])), space);\r\n};\r\nvar Before = styled(BeforeAfterBase)(templateObject_4$1 || (templateObject_4$1 = __makeTemplateObject([\"\\n  \", \";\\n\"], [\"\\n  \", \";\\n\"])), getBeforeSpacing);\r\nvar getAfterSpacing = function (_a) {\r\n    var isCompact = _a.isCompact, theme = _a.theme;\r\n    var spaceKey = isCompact ? 'compact' : 'default';\r\n    var space = getThemeStyle(theme[themeNamespace], spaceKey, 'afterItemSpacing');\r\n    return css(templateObject_5$1 || (templateObject_5$1 = __makeTemplateObject([\"\\n    margin-left: \", \"px;\\n  \"], [\"\\n    margin-left: \", \"px;\\n  \"])), space);\r\n};\r\nvar After = styled(BeforeAfterBase)(templateObject_6$1 || (templateObject_6$1 = __makeTemplateObject([\"\\n  \", \";\\n\"], [\"\\n  \", \";\\n\"])), getAfterSpacing);\r\n// Alignment and layout for the children\r\nvar ContentWrapper = styled.span(templateObject_7$1 || (templateObject_7$1 = __makeTemplateObject([\"\\n  display: flex;\\n  flex-direction: column;\\n  flex-grow: 1;\\n  margin: 0;\\n  overflow: hidden;\\n\\n  &:first-child {\\n    margin: 0;\\n  }\\n\"], [\"\\n  display: flex;\\n  flex-direction: column;\\n  flex-grow: 1;\\n  margin: 0;\\n  overflow: hidden;\\n\\n  &:first-child {\\n    margin: 0;\\n  }\\n\"])));\r\nvar Content = styled.span(templateObject_8$1 || (templateObject_8$1 = __makeTemplateObject([\"\\n  display: block;\\n  flex: 1 1 auto;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: \", \";\\n  line-height: \", \";\\n  /* Fix windows line-height issue */\\n  padding-bottom: 1px;\\n\"], [\"\\n  display: block;\\n  flex: 1 1 auto;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: \", \";\\n  line-height: \", \";\\n  /* Fix windows line-height issue */\\n  padding-bottom: 1px;\\n\"])), function (_a) {\r\n    var allowMultiline = _a.allowMultiline;\r\n    return allowMultiline ? 'normal' : 'nowrap';\r\n}, 16 / fontSize());\r\nvar getColorStyle = function (_a) {\r\n    var isDisabled = _a.isDisabled, theme = _a.theme;\r\n    if (isDisabled) {\r\n        return css(templateObject_9$1 || (templateObject_9$1 = __makeTemplateObject([\"\\n      color: \", \";\\n    \"], [\"\\n      color: \",\r\n            \";\\n    \"])), getThemeStyle(theme[themeNamespace], 'secondaryText', 'disabled'));\r\n    }\r\n    return css(templateObject_10$1 || (templateObject_10$1 = __makeTemplateObject([\"\\n    color: \", \";\\n\\n    /* This detects hover on the grandparent. Saves us having to maintain isHovered\\n       state in the grandparent. */\\n    *:hover > * > & {\\n      color: \", \";\\n    }\\n\\n    *:active > * > & {\\n      color: \", \";\\n    }\\n  \"], [\"\\n    color: \", \";\\n\\n    /* This detects hover on the grandparent. Saves us having to maintain isHovered\\n       state in the grandparent. */\\n    *:hover > * > & {\\n      color: \",\r\n        \";\\n    }\\n\\n    *:active > * > & {\\n      color: \",\r\n        \";\\n    }\\n  \"])), getThemeStyle(theme[themeNamespace], 'secondaryText', 'default'), function () {\r\n        return getThemeStyle(theme[themeNamespace], 'secondaryText', 'hover');\r\n    }, function () {\r\n        return getThemeStyle(theme[themeNamespace], 'secondaryText', 'active');\r\n    });\r\n};\r\nvar getDescriptionFontStyles = function (_a) {\r\n    var isCompact = _a.isCompact;\r\n    var descriptionFontSize = isCompact\r\n        ? compactSmallFontSize\r\n        : fontSizeSmall();\r\n    var lineHeight = isCompact ? compactLineHeight : 14 / descriptionFontSize;\r\n    return css(templateObject_11$1 || (templateObject_11$1 = __makeTemplateObject([\"\\n    font-size: \", \"px;\\n    line-height: \", \";\\n    /* Fix windows line-height issue */\\n    padding-bottom: 1px;\\n  \"], [\"\\n    font-size: \", \"px;\\n    line-height: \", \";\\n    /* Fix windows line-height issue */\\n    padding-bottom: 1px;\\n  \"])), descriptionFontSize, lineHeight);\r\n};\r\n// Description is a block element below the children, like a subtitle\r\nvar Description = styled.span(templateObject_12$1 || (templateObject_12$1 = __makeTemplateObject([\"\\n  flex: 1 1 auto;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n  \", \";\\n  \", \";\\n\"], [\"\\n  flex: 1 1 auto;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n  \", \";\\n  \", \";\\n\"])), getColorStyle, getDescriptionFontStyles);\r\nvar templateObject_1$3, templateObject_2$1, templateObject_3$1, templateObject_4$1, templateObject_5$1, templateObject_6$1, templateObject_7$1, templateObject_8$1, templateObject_9$1, templateObject_10$1, templateObject_11$1, templateObject_12$1;\n\nvar Item = /** @class */ (function (_super) {\r\n    __extends(Item, _super);\r\n    function Item(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.setRef = function (ref) {\r\n            _this.ref = ref;\r\n        };\r\n        _this.href = function () { return (_this.props.isDisabled ? null : _this.props.href); };\r\n        // The type of element rendered at the root of render() can vary based on the `href`\r\n        // and `linkComponent` props provided. We generate this component here to avoid re-\r\n        // generating the component inside render(). This is for performance reasons, and also\r\n        // allows us to avoid generating a new `ref` for the root element each render().\r\n        _this.rootComponent = styledRootElement({\r\n            href: _this.href(),\r\n            linkComponent: props.linkComponent,\r\n        });\r\n        _this.ref = React.createRef();\r\n        return _this;\r\n    }\r\n    Item.prototype.componentDidMount = function () {\r\n        if (this.ref && this.props.autoFocus) {\r\n            //@ts-ignore\r\n            this.ref.focus();\r\n        }\r\n    };\r\n    Item.prototype.render = function () {\r\n        var _this = this;\r\n        var _a = this.props, onClick = _a.onClick, onKeyDown = _a.onKeyDown, isCompact = _a.isCompact, isDisabled = _a.isDisabled, isDragging = _a.isDragging, isHidden = _a.isHidden, isSelected = _a.isSelected, onMouseEnter = _a.onMouseEnter, onMouseLeave = _a.onMouseLeave, role = _a.role, dnd = _a.dnd, otherProps = __rest(_a, [\"onClick\", \"onKeyDown\", \"isCompact\", \"isDisabled\", \"isDragging\", \"isHidden\", \"isSelected\", \"onMouseEnter\", \"onMouseLeave\", \"role\", \"dnd\"]);\r\n        var Root = this.rootComponent;\r\n        var dragHandleProps = (dnd && dnd.dragHandleProps) || null;\r\n        var patchedEventHandlers = {\r\n            onClick: function (event) {\r\n                // rbd will use event.preventDefault() to block clicks that are used\r\n                // as a part of the drag and drop lifecycle.\r\n                if (event.defaultPrevented) {\r\n                    return;\r\n                }\r\n                if (!isDisabled && onClick) {\r\n                    onClick(event);\r\n                }\r\n            },\r\n            onMouseDown: function (event) {\r\n                // rbd 11.x support\r\n                if (dragHandleProps && dragHandleProps.onMouseDown) {\r\n                    dragHandleProps.onMouseDown(event);\r\n                }\r\n                // We want to prevent the item from getting focus when clicked\r\n                event.preventDefault();\r\n            },\r\n            onKeyDown: function (event) {\r\n                // swallowing keyboard events on the element while dragging\r\n                // rbd should already be doing this - but we are being really clear here\r\n                if (isDragging) {\r\n                    return;\r\n                }\r\n                // rbd 11.x support\r\n                if (dragHandleProps && dragHandleProps.onKeyDown) {\r\n                    dragHandleProps.onKeyDown(event);\r\n                }\r\n                // if default is prevented - do not fire other handlers\r\n                // this can happen if the event is used for drag and drop by rbd\r\n                if (event.defaultPrevented) {\r\n                    return;\r\n                }\r\n                // swallowing event if disabled\r\n                if (isDisabled) {\r\n                    return;\r\n                }\r\n                if (!onKeyDown) {\r\n                    return;\r\n                }\r\n                onKeyDown(event);\r\n            },\r\n        };\r\n        var patchedInnerRef = function (ref) {\r\n            _this.setRef(ref);\r\n            // give rbd the inner ref too\r\n            if (dnd && dnd.ref) {\r\n                dnd.ref(ref);\r\n            }\r\n        };\r\n        return (React.createElement(Root, __assign({ \"aria-disabled\": isDisabled, href: this.href(), isCompact: isCompact, isDisabled: isDisabled, isDragging: isDragging, isHidden: isHidden, isSelected: isSelected, onMouseEnter: onMouseEnter, onMouseLeave: onMouseLeave, role: role, tabIndex: isDisabled || isHidden || this.props.href ? null : 0, target: this.props.target, title: this.props.title, ref: patchedInnerRef }, (dnd && dnd.draggableProps), dragHandleProps, patchedEventHandlers, otherProps),\r\n            !!this.props.elemBefore && (React.createElement(Before, { isCompact: isCompact }, this.props.elemBefore)),\r\n            React.createElement(ContentWrapper, null,\r\n                React.createElement(Content, { allowMultiline: this.props.shouldAllowMultiline }, this.props.children),\r\n                !!this.props.description && (React.createElement(Description, { isCompact: this.props.isCompact, isDisabled: this.props.isDisabled }, this.props.description))),\r\n            !!this.props.elemAfter && (React.createElement(After, { isCompact: isCompact }, this.props.elemAfter))));\r\n    };\r\n    Item.defaultProps = {\r\n        autoFocus: false,\r\n        description: '',\r\n        isCompact: false,\r\n        isDisabled: false,\r\n        isHidden: false,\r\n        role: 'button',\r\n        shouldAllowMultiline: false,\r\n    };\r\n    return Item;\r\n}(React.Component));\n\nvar getPadding$1 = function (_a) {\r\n    var isCompact = _a.isCompact, theme = _a.theme;\r\n    var paddingType = isCompact ? 'compact' : 'default';\r\n    var _b = getThemeStyle(theme[themeNamespace], paddingType, 'padding'), _c = _b.bottom, bottom = _c === void 0 ? 0 : _c, _d = _b.left, left = _d === void 0 ? 0 : _d, _e = _b.right, right = _e === void 0 ? 0 : _e, _f = _b.top, top = _f === void 0 ? 0 : _f;\r\n    return css(templateObject_1$4 || (templateObject_1$4 = __makeTemplateObject([\"\\n    padding: \", \"px \", \"px \", \"px \", \"px;\\n  \"], [\"\\n    padding: \", \"px \", \"px \", \"px \", \"px;\\n  \"])), top, right, bottom, left);\r\n};\r\n// eslint-disable-next-line import/prefer-default-export\r\nvar GroupTitle = styled.div(templateObject_2$2 || (templateObject_2$2 = __makeTemplateObject([\"\\n  align-items: center;\\n  color: \", \";\\n  display: flex;\\n  flex: 1 1 auto;\\n  \", \";\\n\"], [\"\\n  align-items: center;\\n  color: \",\r\n    \";\\n  display: flex;\\n  flex: 1 1 auto;\\n  \", \";\\n\"])), function (_a) {\r\n    var theme = _a.theme;\r\n    return getThemeStyle(theme[themeNamespace], 'secondaryText', 'default');\r\n}, getPadding$1);\r\nGroupTitle.displayName = 'ItemGroupTitle';\r\nvar GroupTitleAfter = styled.div(templateObject_3$2 || (templateObject_3$2 = __makeTemplateObject([\"\\n  flex: 0 0 auto;\\n  margin-right: -\", \"px;\\n\"], [\"\\n  flex: 0 0 auto;\\n  margin-right: -\", \"px;\\n\"])), gridSize$1 / 2);\r\nGroupTitleAfter.displayName = 'ItemGroupTitleAfter';\r\nvar GroupTitleText = styled.div(templateObject_4$2 || (templateObject_4$2 = __makeTemplateObject([\"\\n  flex: 1 1 auto;\\n  font-size: \", \"px;\\n  line-height: 1;\\n  text-transform: uppercase;\\n  /* Required for children to truncate */\\n  min-width: 0;\\n\"], [\"\\n  flex: 1 1 auto;\\n  font-size: \", \"px;\\n  line-height: 1;\\n  text-transform: uppercase;\\n  /* Required for children to truncate */\\n  min-width: 0;\\n\"])), fontSizeSmall);\r\nGroupTitleText.displayName = 'ItemGroupTitleText';\r\nvar templateObject_1$4, templateObject_2$2, templateObject_3$2, templateObject_4$2;\n\nvar ItemGroup = /** @class */ (function (_super) {\r\n    __extends(ItemGroup, _super);\r\n    function ItemGroup() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    ItemGroup.prototype.render = function () {\r\n        var _a;\r\n        var _b = this.props, children = _b.children, elemAfter = _b.elemAfter, isCompact = _b.isCompact, title = _b.title, label = _b.label, innerRef = _b.innerRef, role = _b.role;\r\n        var ariaLabel = (_a = label !== null && label !== void 0 ? label : title) !== null && _a !== void 0 ? _a : '';\r\n        return (React.createElement(\"div\", { \"aria-label\": ariaLabel.toString(), role: role, ref: innerRef },\r\n            title ? (React.createElement(GroupTitle, { \"aria-hidden\": \"true\", isCompact: isCompact },\r\n                React.createElement(GroupTitleText, null, title),\r\n                elemAfter ? (React.createElement(GroupTitleAfter, null, elemAfter)) : null)) : null,\r\n            children));\r\n    };\r\n    ItemGroup.defaultProps = {\r\n        role: 'group',\r\n    };\r\n    return ItemGroup;\r\n}(React.Component));\n\n// import { akEditorMobileMaxWidth } from '@atlaskit/editor-shared-styles';\r\nvar akEditorMobileMaxWidth = 0;\r\n// Taken from the style of inline dialog components\r\nvar dropShadow = css(templateObject_1$5 || (templateObject_1$5 = __makeTemplateObject([\"\\n  box-shadow: 0 0 1px rgba(9, 30, 66, 0.31),\\n    0 4px 8px -2px rgba(9, 30, 66, 0.25);\\n\"], [\"\\n  box-shadow: 0 0 1px rgba(9, 30, 66, 0.31),\\n    0 4px 8px -2px rgba(9, 30, 66, 0.25);\\n\"])));\r\nvar Shortcut = styled.div(templateObject_2$3 || (templateObject_2$3 = __makeTemplateObject([\"\\n  background-color: rgba(223, 225, 229, 0.5); /* N60 at 50% */\\n  color: \", \";\\n  border-radius: \", \"px;\\n  padding: 4px;\\n  line-height: 12px;\\n  font-size: 11.67px;\\n  align-self: flex-end;\\n  @media (max-width: \", \"px) {\\n    display: none;\\n  }\\n\"], [\"\\n  background-color: rgba(223, 225, 229, 0.5); /* N60 at 50% */\\n  color: \", \";\\n  border-radius: \", \"px;\\n  padding: 4px;\\n  line-height: 12px;\\n  font-size: 11.67px;\\n  align-self: flex-end;\\n  @media (max-width: \", \"px) {\\n    display: none;\\n  }\\n\"])), N100, borderRadius(), akEditorMobileMaxWidth);\r\nvar CellColourPreview = styled.div(templateObject_3$3 || (templateObject_3$3 = __makeTemplateObject([\"\\n  &::before {\\n    background: \", \";\\n  }\\n\"], [\"\\n  &::before {\\n    background: \", \";\\n  }\\n\"])), function (props) { return props.selectedColor; });\r\nvar templateObject_1$5, templateObject_2$3, templateObject_3$3;\n\nfunction IconFallback(_a) {\r\n    var _b = _a.label, label = _b === void 0 ? '' : _b;\r\n    return (React.createElement(\"svg\", { \"aria-label\": label, width: 40, height: 40 },\r\n        React.createElement(\"defs\", null,\r\n            React.createElement(\"linearGradient\", { x1: \"-26.046%\", y1: \"100%\", x2: \"62.626%\", y2: \"0%\", id: \"fallback-a\" },\r\n                React.createElement(\"stop\", { stopColor: \"#B3BAC5\", offset: \"0%\" }),\r\n                React.createElement(\"stop\", { stopColor: \"#A5ADBA\", offset: \"100%\" }))),\r\n        React.createElement(\"g\", { fill: \"none\", fillRule: \"evenodd\" },\r\n            React.createElement(\"path\", { fill: \"#FFF\", d: \"M0 0h40v40H0z\" }),\r\n            React.createElement(\"path\", { fill: \"#DFE1E6\", d: \"M20 16h12v12H20z\" }),\r\n            React.createElement(\"path\", { fill: \"url(#fallback-a)\", d: \"M8 16h12v12H8z\" }),\r\n            React.createElement(\"path\", { d: \"M20 16c-4 .5-6.029 2.5-6.086 6-.057 3.5-2.028 5.5-5.914 6h12V16z\", fill: \"#A5ADBA\" }),\r\n            React.createElement(\"path\", { fill: \"#B3BAC5\", d: \"M17.5 13h5v3h-5z\" }),\r\n            React.createElement(\"path\", { fill: \"#A5ADBA\", d: \"M10 13h5v3h-5z\" }),\r\n            React.createElement(\"path\", { fill: \"#DFE1E6\", d: \"M25 13h5v3h-5z\" }))));\r\n}\n\nvar _a;\r\nvar hidden = { overflow: 'hidden' };\r\nvar itemTheme = (_a = {},\r\n    _a[themeNamespace] = {\r\n        padding: {\r\n            default: {\r\n                bottom: 12,\r\n                left: 12,\r\n                right: 12,\r\n                top: 12,\r\n            },\r\n        },\r\n        beforeItemSpacing: {\r\n            default: function () { return 12; },\r\n        },\r\n        borderRadius: function () { return 0; },\r\n        hover: {\r\n            // background: colors.transparent, transparent is not a thing\r\n            text: text$1,\r\n            secondaryText: N200,\r\n        },\r\n        selected: {\r\n            background: N20,\r\n            text: N800,\r\n            secondaryText: N200,\r\n        },\r\n    },\r\n    _a);\r\nvar ItemIcon = styled.div(templateObject_1$6 || (templateObject_1$6 = __makeTemplateObject([\"\\n  width: 40px;\\n  height: 40px;\\n  overflow: hidden;\\n  border: 1px solid rgba(223, 225, 229, 0.5); /* N60 at 50% */\\n  border-radius: \", \"px;\\n  box-sizing: border-box;\\n\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n\\n  div {\\n    width: 40px;\\n    height: 40px;\\n  }\\n\"], [\"\\n  width: 40px;\\n  height: 40px;\\n  overflow: hidden;\\n  border: 1px solid rgba(223, 225, 229, 0.5); /* N60 at 50% */\\n  border-radius: \", \"px;\\n  box-sizing: border-box;\\n\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n\\n  div {\\n    width: 40px;\\n    height: 40px;\\n  }\\n\"])), borderRadius());\r\nvar ItemBody = styled.div(templateObject_2$4 || (templateObject_2$4 = __makeTemplateObject([\"\\n  display: flex;\\n  flex-direction: row;\\n  flex-wrap: nowrap;\\n  justify-content: space-between;\\n  line-height: 1.4;\\n\"], [\"\\n  display: flex;\\n  flex-direction: row;\\n  flex-wrap: nowrap;\\n  justify-content: space-between;\\n  line-height: 1.4;\\n\"])));\r\nvar ItemText = styled.div(templateObject_3$4 || (templateObject_3$4 = __makeTemplateObject([\"\\n  white-space: initial;\\n  .item-description {\\n    font-size: 11.67px;\\n    color: \", \";\\n    margin-top: 4px;\\n  }\\n\"], [\"\\n  white-space: initial;\\n  .item-description {\\n    font-size: 11.67px;\\n    color: \", \";\\n    margin-top: 4px;\\n  }\\n\"])), N200);\r\nvar ItemAfter = styled.div(templateObject_4$3 || (templateObject_4$3 = __makeTemplateObject([\"\\n  flex: 0 0 auto;\\n\"], [\"\\n  flex: 0 0 auto;\\n\"])));\r\nvar fallbackIcon = function (label) {\r\n    return React.createElement(IconFallback, { label: label });\r\n};\r\nfunction scrollIntoViewIfNeeded(element) {\r\n    var offsetTop = element.offsetTop, offsetHeight = element.offsetHeight, offsetParent = element.offsetParent;\r\n    var _a = offsetParent, offsetParentHeight = _a.offsetHeight, scrollTop = _a.scrollTop;\r\n    var direction = offsetTop + offsetHeight > offsetParentHeight + scrollTop\r\n        ? 1\r\n        : scrollTop > offsetTop\r\n            ? -1\r\n            : 0;\r\n    if (direction !== 0 && offsetParent) {\r\n        offsetParent.scrollTop =\r\n            direction === 1\r\n                ? offsetTop + offsetHeight - offsetParentHeight\r\n                : offsetTop;\r\n    }\r\n}\r\nfunction TypeAheadItemsList(_a) {\r\n    var items = _a.items, currentIndex = _a.currentIndex, insertByIndex = _a.insertByIndex, setCurrentIndex = _a.setCurrentIndex;\r\n    if (!Array.isArray(items)) {\r\n        return null;\r\n    }\r\n    return (React.createElement(ThemeProvider, { theme: itemTheme },\r\n        React.createElement(ItemGroup, null, items.map(function (item, index) { return (React.createElement(TypeAheadItemComponent, { key: item.key || item.title, item: item, index: index, currentIndex: currentIndex, insertByIndex: insertByIndex, setCurrentIndex: setCurrentIndex })); }))));\r\n}\r\nvar TypeAheadItemComponent = /** @class */ (function (_super) {\r\n    __extends(TypeAheadItemComponent, _super);\r\n    function TypeAheadItemComponent(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.insertByIndex = function () {\r\n            _this.props.insertByIndex(_this.props.index);\r\n        };\r\n        _this.setCurrentIndex = function () {\r\n            if (!_this.isSelected(_this.props)) {\r\n                _this.props.setCurrentIndex(_this.props.index);\r\n            }\r\n        };\r\n        _this.handleRef = function (ref) {\r\n            // For some reason, this works quite well without this..\r\n            // let hasRef = (ref: any): ref is { ref: HTMLElement } => ref && ref.ref;\r\n            // this.setState({ ref: hasRef(ref) ? ref.ref : ref });\r\n        };\r\n        _this.ref = React.createRef();\r\n        return _this;\r\n    }\r\n    TypeAheadItemComponent.prototype.shouldComponentUpdate = function (nextProps) {\r\n        return this.isSelected(this.props) !== this.isSelected(nextProps);\r\n    };\r\n    TypeAheadItemComponent.prototype.isSelected = function (props) {\r\n        return props.index === props.currentIndex;\r\n    };\r\n    TypeAheadItemComponent.prototype.componentDidUpdate = function () {\r\n        if (this.props.index === this.props.currentIndex && this.ref && this.ref.current) {\r\n            scrollIntoViewIfNeeded(this.ref.current);\r\n        }\r\n    };\r\n    TypeAheadItemComponent.prototype.render = function () {\r\n        var item = this.props.item;\r\n        return item.render ? (React.createElement(\"div\", { onMouseMove: this.setCurrentIndex, \r\n            // ref={this.handleRef}\r\n            style: hidden },\r\n            React.createElement(item.render, { onClick: this.insertByIndex, onHover: this.setCurrentIndex, isSelected: this.isSelected(this.props) }))) : (React.createElement(Item, { onClick: this.insertByIndex, onMouseMove: this.setCurrentIndex, elemBefore: React.createElement(ItemIcon, null, item.icon ? item.icon() : fallbackIcon(item.title)), isSelected: this.isSelected(this.props), \"aria-describedby\": item.title, ref: this.handleRef },\r\n            React.createElement(ItemBody, null,\r\n                React.createElement(ItemText, null,\r\n                    React.createElement(\"div\", { className: \"item-title\" }, item.title),\r\n                    item.description && (React.createElement(\"div\", { className: \"item-description\" }, item.description))),\r\n                React.createElement(ItemAfter, null, item.keyshortcut && React.createElement(Shortcut, null, item.keyshortcut)))));\r\n    };\r\n    return TypeAheadItemComponent;\r\n}(React.Component));\r\nvar templateObject_1$6, templateObject_2$4, templateObject_3$4, templateObject_4$3;\n\n// import { akEditorFloatingDialogZIndex } from '@atlaskit/editor-shared-styles';\r\nvar akEditorFloatingDialogZIndex = 410;\r\nvar TypeAheadContent = styled.div(templateObject_1$7 || (templateObject_1$7 = __makeTemplateObject([\"\\n  background: \", \";\\n  border-radius: \", \"px;\\n  box-shadow: 0 0 1px \", \", 0 4px 8px -2px \", \";\\n  padding: \", \"px 0;\\n  width: 320px;\\n  max-height: 380px; /* ~5.5 visibile items */\\n  overflow-y: auto;\\n  -ms-overflow-style: -ms-autohiding-scrollbar;\\n  position: relative;\\n\"], [\"\\n  background: \", \";\\n  border-radius: \", \"px;\\n  box-shadow: 0 0 1px \", \", 0 4px 8px -2px \", \";\\n  padding: \", \"px 0;\\n  width: 320px;\\n  max-height: 380px; /* ~5.5 visibile items */\\n  overflow-y: auto;\\n  -ms-overflow-style: -ms-autohiding-scrollbar;\\n  position: relative;\\n\"])), N0, borderRadius(), N60A, N50A, divide(gridSize, 2));\r\nvar TypeAhead = /** @class */ (function (_super) {\r\n    __extends(TypeAhead, _super);\r\n    function TypeAhead() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.composing = false;\r\n        _this.handleKeyPress = function () {\r\n            // When user starts typing, they are not using their mouse\r\n            // Marks as composing, to prevent false positive mouse events\r\n            _this.composing = true;\r\n        };\r\n        _this.handleMouseMove = function () {\r\n            // User is actively moving mouse, hence can enable mouse events again\r\n            _this.composing = false;\r\n        };\r\n        _this.componentDidMount = function () {\r\n            window.addEventListener('keypress', _this.handleKeyPress);\r\n            window.addEventListener('mousemove', _this.handleMouseMove);\r\n        };\r\n        _this.componentWillUnmount = function () {\r\n            window.removeEventListener('keypress', _this.handleKeyPress);\r\n            window.removeEventListener('mousemove', _this.handleMouseMove);\r\n        };\r\n        _this.insertByIndex = function (index) {\r\n            selectByIndex(index)(_this.props.editorView.state, _this.props.editorView.dispatch);\r\n        };\r\n        _this.setCurrentIndex = function (index) {\r\n            if (_this.composing) {\r\n                // User is typing, mouse events are false positives\r\n                return;\r\n            }\r\n            if (index !== _this.props.currentIndex) {\r\n                setCurrentIndex(index)(_this.props.editorView.state, _this.props.editorView.dispatch);\r\n            }\r\n        };\r\n        return _this;\r\n    }\r\n    TypeAhead.prototype.render = function () {\r\n        var _a = this.props, active = _a.active, items = _a.items, isLoading = _a.isLoading, anchorElement = _a.anchorElement, currentIndex = _a.currentIndex, popupsMountPoint = _a.popupsMountPoint, popupsBoundariesElement = _a.popupsBoundariesElement, popupsScrollableElement = _a.popupsScrollableElement, highlight = _a.highlight;\r\n        if (!active || !anchorElement || !items || !items.length) {\r\n            return null;\r\n        }\r\n        return (React.createElement(Popup, { zIndex: akEditorFloatingDialogZIndex, target: anchorElement, mountTo: popupsMountPoint, boundariesElement: popupsBoundariesElement, scrollableElement: popupsScrollableElement, fitHeight: 300, fitWidth: 340, offset: [0, 8] },\r\n            React.createElement(TypeAheadContent, { className: \"fabric-editor-typeahead\" },\r\n                highlight,\r\n                Array.isArray(items) ? (React.createElement(TypeAheadItemsList, { insertByIndex: this.insertByIndex, setCurrentIndex: this.setCurrentIndex, items: items, currentIndex: currentIndex })) : !items && isLoading ? ('loading...') : ('no items'))));\r\n    };\r\n    TypeAhead.displayName = 'TypeAhead';\r\n    return TypeAhead;\r\n}(React.Component));\r\nvar templateObject_1$7;\n\nvar typeAheadPlugin = function () { return ({\r\n    name: 'typeAhead',\r\n    marks: function () {\r\n        return [{ name: 'typeAheadQuery', mark: typeAheadQuery }];\r\n    },\r\n    pmPlugins: function (typeAhead) {\r\n        if (typeAhead === void 0) { typeAhead = []; }\r\n        return [\r\n            {\r\n                name: 'typeAhead',\r\n                plugin: function (_a) {\r\n                    var dispatch = _a.dispatch;\r\n                    return createPlugin(dispatch, typeAhead);\r\n                },\r\n            },\r\n            {\r\n                name: 'typeAheadInputRule',\r\n                plugin: function (_a) {\r\n                    var schema = _a.schema;\r\n                    return inputRulePlugin(schema, typeAhead);\r\n                },\r\n            },\r\n            {\r\n                name: 'typeAheadKeymap',\r\n                plugin: function () { return keymapPlugin$1(); },\r\n            },\r\n        ];\r\n    },\r\n    contentComponent: function (_a) {\r\n        var editorView = _a.editorView, popupsMountPoint = _a.popupsMountPoint, popupsBoundariesElement = _a.popupsBoundariesElement, popupsScrollableElement = _a.popupsScrollableElement;\r\n        return (React.createElement(WithPluginState, { plugins: {\r\n                typeAhead: pluginKey$1,\r\n            }, render: function (_a) {\r\n                var _b = _a.typeAhead, typeAhead = _b === void 0 ? createInitialPluginState() : _b;\r\n                if (typeAhead.typeAheadHandler &&\r\n                    typeAhead.typeAheadHandler.headless) {\r\n                    return null;\r\n                }\r\n                var queryMarkPos = typeAhead.queryMarkPos;\r\n                var domRef = null;\r\n                if (queryMarkPos !== null) {\r\n                    // temporary fix to avoid page crash until it is fixed properly\r\n                    try {\r\n                        domRef = editorView.domAtPos(queryMarkPos);\r\n                    }\r\n                    catch (ex) {\r\n                        return null;\r\n                    }\r\n                }\r\n                var anchorElement = domRef\r\n                    ? domRef.node.childNodes[domRef.offset]\r\n                    : undefined;\r\n                return (React.createElement(TypeAhead, { editorView: editorView, popupsMountPoint: popupsMountPoint, popupsBoundariesElement: popupsBoundariesElement, popupsScrollableElement: popupsScrollableElement, anchorElement: anchorElement, active: typeAhead.active, isLoading: !!typeAhead.itemsLoader, items: typeAhead.items, currentIndex: typeAhead.currentIndex, highlight: typeAhead.highlight }));\r\n            } }));\r\n    },\r\n}); };\n\nvar Preset = /** @class */ (function () {\r\n    function Preset() {\r\n        this.plugins = [];\r\n    }\r\n    Preset.prototype.add = function (plugin) {\r\n        this.plugins.push(plugin);\r\n        return this;\r\n    };\r\n    Preset.prototype.has = function (plugin) {\r\n        return this.plugins.some(function (pluginPreset) {\r\n            if (Array.isArray(pluginPreset)) {\r\n                return pluginPreset[0] === plugin;\r\n            }\r\n            return pluginPreset === plugin;\r\n        });\r\n    };\r\n    Preset.prototype.getEditorPlugins = function (excludes) {\r\n        var editorPlugins = this.processEditorPlugins();\r\n        return this.removeExcludedPlugins(editorPlugins, excludes);\r\n    };\r\n    Preset.prototype.processEditorPlugins = function () {\r\n        var cache = new Map();\r\n        this.plugins.forEach(function (pluginEntry) {\r\n            if (Array.isArray(pluginEntry)) {\r\n                var fn = pluginEntry[0], options = pluginEntry[1];\r\n                cache.set(fn, options);\r\n            }\r\n            else {\r\n                /**\r\n                 * Prevent usage of same plugin twice without override.\r\n                 * [\r\n                 *  plugin1,\r\n                 *  [plugin1, { option1: value }],\r\n                 *  plugin1, // This will throw\r\n                 * ]\r\n                 */\r\n                if (cache.has(pluginEntry) && cache.get(pluginEntry) === undefined) {\r\n                    throw new Error(pluginEntry + \" is already included!\");\r\n                }\r\n                cache.set(pluginEntry, undefined);\r\n            }\r\n        });\r\n        var plugins = [];\r\n        cache.forEach(function (options, fn) {\r\n            plugins.push(fn(options));\r\n        });\r\n        return plugins;\r\n    };\r\n    Preset.prototype.removeExcludedPlugins = function (plugins, excludes) {\r\n        if (excludes) {\r\n            return plugins.filter(function (plugin) { return !plugin || !excludes.has(plugin.name); });\r\n        }\r\n        return plugins;\r\n    };\r\n    return Preset;\r\n}());\n\n/**\r\n * Maps EditorProps to EditorPlugins\r\n */\r\nfunction createPluginsList(props, prevProps) {\r\n    var preset = new Preset();\r\n    preset.add(basePlugin);\r\n    preset.add(blockQuotePlugin);\r\n    preset.add(quickInsertPlugin);\r\n    preset.add(typeAheadPlugin);\r\n    return preset.getEditorPlugins();\r\n}\n\nfunction createSchema(editorConfig) {\r\n    var createdMarks = fixExcludes(editorConfig.marks.sort(sortByOrder('marks')).reduce(function (acc, mark) {\r\n        acc[mark.name] = mark.mark;\r\n        return acc;\r\n    }, {}));\r\n    var createdNodes = editorConfig.nodes.sort(sortByOrder('nodes')).reduce(function (acc, node) {\r\n        acc[node.name] = node.node;\r\n        return acc;\r\n    }, {});\r\n    return new Schema({ nodes: createdNodes, marks: createdMarks });\r\n}\n\nvar ReactEditorView = /** @class */ (function (_super) {\r\n    __extends(ReactEditorView, _super);\r\n    function ReactEditorView(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        // ProseMirror is instantiated prior to the initial React render cycle,\r\n        // so we allow transactions by default, to avoid discarding the initial one.\r\n        _this.canDispatchTransactions = true;\r\n        _this.createEditorState = function (options) {\r\n            if (_this.editorView) {\r\n                /**\r\n                 * There's presently a number of issues with changing the schema of a\r\n                 * editor inflight. A significant issue is that we lose the ability\r\n                 * to keep track of a user's history as the internal plugin state\r\n                 * keeps a list of Steps to undo/redo (which are tied to the schema).\r\n                 * Without a good way to do work around this, we prevent this for now.\r\n                 */\r\n                // eslint-disable-next-line no-console\r\n                console.warn('The editor does not support changing the schema dynamically.');\r\n                return _this.editorState;\r\n            }\r\n            _this.config = processPluginsList(_this.getPlugins(options.props.editorProps, undefined));\r\n            var schema = createSchema(_this.config);\r\n            var plugins = createPMPlugins({\r\n                schema: schema,\r\n                dispatch: _this.dispatch,\r\n                editorConfig: _this.config,\r\n                eventDispatcher: _this.eventDispatcher,\r\n                providerFactory: options.props.providerFactory,\r\n                portalProviderAPI: _this.props.portalProviderAPI,\r\n            });\r\n            var doc;\r\n            // Workaround for ED-3507: When media node is the last element, scrollIntoView throws an error\r\n            var patchedSelection =  undefined;\r\n            return EditorState.create({\r\n                schema: schema,\r\n                plugins: plugins,\r\n                doc: doc,\r\n                selection: patchedSelection,\r\n            });\r\n        };\r\n        _this.reconfigureState = function (props) {\r\n            if (!_this.editorView) {\r\n                return;\r\n            }\r\n            // We cannot currently guarantee when all the portals will have re-rendered during a reconfigure\r\n            // so we blur here to stop ProseMirror from trying to apply selection to detached nodes or\r\n            // nodes that haven't been re-rendered to the document yet.\r\n            if (_this.editorView.dom instanceof HTMLElement && _this.editorView.hasFocus()) {\r\n                _this.editorView.dom.blur();\r\n            }\r\n            _this.config = processPluginsList(_this.getPlugins(props.editorProps, _this.props.editorProps));\r\n            var state = _this.editorState;\r\n            var plugins = createPMPlugins({\r\n                schema: state.schema,\r\n                dispatch: _this.dispatch,\r\n                editorConfig: _this.config,\r\n                eventDispatcher: _this.eventDispatcher,\r\n                providerFactory: props.providerFactory,\r\n                portalProviderAPI: props.portalProviderAPI,\r\n            });\r\n            var newState = state.reconfigure({ plugins: plugins });\r\n            // need to update the state first so when the view builds the nodeviews it is\r\n            // using the latest plugins\r\n            _this.editorView.updateState(newState);\r\n            return _this.editorView.update(__assign(__assign({}, _this.editorView.props), { state: newState }));\r\n        };\r\n        _this.dispatchTransaction = function (transaction) {\r\n            if (!_this.editorView) {\r\n                return;\r\n            }\r\n             startMeasure(\"\\uD83E\\uDD89 ReactEditorView::dispatchTransaction\");\r\n            var nodes = findChangedNodesFromTransaction(transaction);\r\n            var changedNodesValid = validateNodes(nodes);\r\n            if (changedNodesValid) {\r\n                var oldEditorState = _this.editorView.state;\r\n                // go ahead and update the state now we know the transaction is good\r\n                 startMeasure(\"\\uD83E\\uDD89 EditorView::state::apply\");\r\n                var editorState = _this.editorView.state.apply(transaction);\r\n                 stopMeasure(\"\\uD83E\\uDD89 EditorView::state::apply\");\r\n                if (editorState === oldEditorState) {\r\n                    return;\r\n                }\r\n                 startMeasure(\"\\uD83E\\uDD89 EditorView::updateState\");\r\n                _this.editorView.updateState(editorState);\r\n                 stopMeasure(\"\\uD83E\\uDD89 EditorView::updateState\");\r\n                _this.editorState = editorState;\r\n            }\r\n            else {\r\n                var invalidNodes = nodes\r\n                    .filter(function (node) { return !validNode(node); })\r\n                    .map(function (node) { return getDocStructure(node); });\r\n                {\r\n                    console.error('Invalid nodes in transaction');\r\n                    console.log(transaction);\r\n                    console.log(invalidNodes);\r\n                }\r\n            }\r\n            \r\n                stopMeasure(\"\\uD83E\\uDD89 ReactEditorView::dispatchTransaction\", function () { });\r\n        };\r\n        _this.getDirectEditorProps = function (state) {\r\n            return {\r\n                state: state || _this.editorState,\r\n                dispatchTransaction: function (tr) {\r\n                    // Block stale transactions:\r\n                    // Prevent runtime exceptions from async transactions that would attempt to\r\n                    // update the DOM after React has unmounted the Editor.\r\n                    if (_this.canDispatchTransactions) {\r\n                        _this.dispatchTransaction(tr);\r\n                    }\r\n                },\r\n                // Disables the contentEditable attribute of the editor if the editor is disabled\r\n                editable: function (_state) { return true; },\r\n                attributes: { 'data-gramm': 'false' },\r\n            };\r\n        };\r\n        _this.handleEditorViewRef = function (node) {\r\n            if (!_this.editorView && node) {\r\n                _this.createEditorView(node);\r\n                var view = _this.editorView;\r\n                _this.props.onEditorCreated({\r\n                    view: view,\r\n                    config: _this.config,\r\n                    eventDispatcher: _this.eventDispatcher,\r\n                });\r\n                if (_this.props.editorProps.shouldFocus) {\r\n                    _this.focusTimeoutId = handleEditorFocus(view);\r\n                }\r\n                // Force React to re-render so consumers get a reference to the editor view\r\n                _this.forceUpdate();\r\n            }\r\n            else if (_this.editorView && !node) {\r\n                // When the appearance is changed, React will call handleEditorViewRef with node === null\r\n                // to destroy the old EditorView, before calling this method again with node === div to\r\n                // create the new EditorView\r\n                _this.props.onEditorDestroyed({\r\n                    view: _this.editorView,\r\n                    config: _this.config,\r\n                    eventDispatcher: _this.eventDispatcher,\r\n                });\r\n                _this.editorView.destroy(); // Destroys the dom node & all node views\r\n                _this.editorView = undefined;\r\n            }\r\n        };\r\n        _this.editor = (React.createElement(\"div\", { className: getUAPrefix(), key: \"ProseMirror\", ref: _this.handleEditorViewRef }));\r\n        _this.eventDispatcher = new EventDispatcher();\r\n        _this.dispatch = createDispatch(_this.eventDispatcher);\r\n        _this.editorState = _this.createEditorState({\r\n            props: props,\r\n            replaceDoc: true,\r\n        });\r\n        return _this;\r\n    }\r\n    ReactEditorView.prototype.componentDidMount = function () {\r\n        // Transaction dispatching is already enabled by default prior to\r\n        // mounting, but we reset it here, just in case the editor view\r\n        // instance is ever recycled (mounted again after unmounting) with\r\n        // the same key.\r\n        // Although storing mounted state is an anti-pattern in React,\r\n        // we do so here so that we can intercept and abort asynchronous\r\n        // ProseMirror transactions when a dismount is imminent.\r\n        this.canDispatchTransactions = true;\r\n    };\r\n    /**\r\n     * Clean up any non-PM resources when the editor is unmounted\r\n     */\r\n    ReactEditorView.prototype.componentWillUnmount = function () {\r\n        // We can ignore any transactions from this point onwards.\r\n        // This serves to avoid potential runtime exceptions which could arise\r\n        // from an async dispatched transaction after it's unmounted.\r\n        // this.canDispatchTransactions = false;\r\n        this.eventDispatcher.destroy();\r\n        clearTimeout(this.focusTimeoutId);\r\n        if (this.editorView) {\r\n            // Destroy the state if the Editor is being unmounted\r\n            var editorState_1 = this.editorView.state;\r\n            editorState_1.plugins.forEach(function (plugin) {\r\n                var state = plugin.getState(editorState_1);\r\n                if (state && state.destroy) {\r\n                    state.destroy();\r\n                }\r\n            });\r\n        }\r\n        // this.editorView will be destroyed when React unmounts in handleEditorViewRef\r\n    };\r\n    // Helper to allow tests to inject plugins directly\r\n    ReactEditorView.prototype.getPlugins = function (editorProps, prevEditorProps) {\r\n        return createPluginsList();\r\n    };\r\n    ReactEditorView.prototype.createEditorView = function (element) {\r\n        // Creates the editor-view from this.editorState. If an editor has been mounted\r\n        // previously, this will contain the previous state of the editor.\r\n        this.editorView = new EditorView({ mount: element }, this.getDirectEditorProps());\r\n        applyDevTools(this.editorView);\r\n    };\r\n    ReactEditorView.prototype.render = function () {\r\n        return this.props.render\r\n            ? this.props.render({\r\n                editor: this.editor,\r\n                view: this.editorView,\r\n                config: this.config,\r\n                eventDispatcher: this.eventDispatcher,\r\n            })\r\n            : this.editor;\r\n    };\r\n    return ReactEditorView;\r\n}(React.Component));\r\nfunction handleEditorFocus(view) {\r\n    if (view.hasFocus()) {\r\n        return;\r\n    }\r\n    return window.setTimeout(function () {\r\n        view.focus();\r\n    }, 0);\r\n}\n\nvar EditorActions = /** @class */ (function () {\r\n    function EditorActions() {\r\n        this.listeners = [];\r\n    }\r\n    EditorActions.from = function (view, eventDispatcher, transformer) {\r\n        var editorActions = new EditorActions();\r\n        editorActions._privateRegisterEditor(view, eventDispatcher, transformer);\r\n        return editorActions;\r\n    };\r\n    //#region private\r\n    // This method needs to be public for context based helper components.\r\n    EditorActions.prototype._privateGetEditorView = function () {\r\n        return this.editorView;\r\n    };\r\n    EditorActions.prototype._privateGetEventDispatcher = function () {\r\n        return this.eventDispatcher;\r\n    };\r\n    // This method needs to be public for EditorContext component.\r\n    EditorActions.prototype._privateRegisterEditor = function (editorView, eventDispatcher, contentTransformer) {\r\n        this.contentTransformer = contentTransformer;\r\n        this.eventDispatcher = eventDispatcher;\r\n        if (!this.editorView && editorView) {\r\n            this.editorView = editorView;\r\n            this.listeners.forEach(function (cb) { return cb(editorView, eventDispatcher); });\r\n        }\r\n        else if (this.editorView !== editorView) {\r\n            throw new Error(\"Editor has already been registered! It's not allowed to re-register editor with the new Editor instance.\");\r\n        }\r\n        if (this.contentTransformer) {\r\n            this.contentEncode = this.contentTransformer.encode.bind(this.contentTransformer);\r\n        }\r\n    };\r\n    // This method needs to be public for EditorContext component.\r\n    EditorActions.prototype._privateUnregisterEditor = function () {\r\n        this.editorView = undefined;\r\n        this.contentTransformer = undefined;\r\n        this.contentEncode = undefined;\r\n        this.eventDispatcher = undefined;\r\n    };\r\n    EditorActions.prototype._privateSubscribe = function (cb) {\r\n        // If editor is registered and somebody is trying to add a listener,\r\n        // just call it first.\r\n        if (this.editorView && this.eventDispatcher) {\r\n            cb(this.editorView, this.eventDispatcher);\r\n        }\r\n        this.listeners.push(cb);\r\n    };\r\n    EditorActions.prototype._privateUnsubscribe = function (cb) {\r\n        this.listeners = this.listeners.filter(function (c) { return c !== cb; });\r\n    };\r\n    //#endregion\r\n    EditorActions.prototype.focus = function () {\r\n        if (!this.editorView || this.editorView.hasFocus()) {\r\n            return false;\r\n        }\r\n        this.editorView.focus();\r\n        this.editorView.dispatch(this.editorView.state.tr.scrollIntoView());\r\n        return true;\r\n    };\r\n    EditorActions.prototype.blur = function () {\r\n        if (!this.editorView || !this.editorView.hasFocus()) {\r\n            return false;\r\n        }\r\n        this.editorView.dom.blur();\r\n        return true;\r\n    };\r\n    EditorActions.prototype.clear = function () {\r\n        if (!this.editorView) {\r\n            return false;\r\n        }\r\n        var editorView = this.editorView;\r\n        var state = editorView.state;\r\n        var tr = editorView.state.tr\r\n            .setSelection(TextSelection.create(state.doc, 0, state.doc.nodeSize - 2))\r\n            .deleteSelection();\r\n        editorView.dispatch(tr);\r\n        return true;\r\n    };\r\n    // async __temporaryFixForConfigPanel() {\r\n    //   const { editorView } = this;\r\n    //   if (!editorView) {\r\n    //     return;\r\n    //   }\r\n    //   __temporaryFixForConfigPanel(editorView);\r\n    // }\r\n    EditorActions.prototype.appendText = function (text) {\r\n        if (!this.editorView || !text) {\r\n            return false;\r\n        }\r\n        var state = this.editorView.state;\r\n        var lastChild = state.doc.lastChild;\r\n        if (lastChild && lastChild.type !== state.schema.nodes.paragraph) {\r\n            return false;\r\n        }\r\n        var tr = state.tr.insertText(text).scrollIntoView();\r\n        this.editorView.dispatch(tr);\r\n        return true;\r\n    };\r\n    return EditorActions;\r\n}());\n\nvar EditorContext = /** @class */ (function (_super) {\r\n    __extends(EditorContext, _super);\r\n    function EditorContext(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.editorActions = props.editorActions || new EditorActions();\r\n        return _this;\r\n    }\r\n    EditorContext.prototype.getChildContext = function () {\r\n        return {\r\n            editorActions: this.editorActions,\r\n        };\r\n    };\r\n    EditorContext.prototype.render = function () {\r\n        return React.Children.only(this.props.children);\r\n    };\r\n    EditorContext.childContextTypes = {\r\n        editorActions: PropTypes.object,\r\n    };\r\n    return EditorContext;\r\n}(React.Component));\n\nvar PortalProviderAPI = /** @class */ (function (_super) {\r\n    __extends(PortalProviderAPI, _super);\r\n    function PortalProviderAPI() {\r\n        var _this = _super.call(this) || this;\r\n        _this.portals = new Map();\r\n        _this.setContext = function (context) {\r\n            _this.context = context;\r\n        };\r\n        return _this;\r\n    }\r\n    PortalProviderAPI.prototype.render = function (children, container, hasReactContext) {\r\n        if (hasReactContext === void 0) { hasReactContext = false; }\r\n        this.portals.set(container, { children: children, hasReactContext: hasReactContext });\r\n        var wrappedChildren = children();\r\n        unstable_renderSubtreeIntoContainer(this.context, wrappedChildren, container);\r\n    };\r\n    // TODO: until https://product-fabric.atlassian.net/browse/ED-5013\r\n    // we (unfortunately) need to re-render to pass down any updated context.\r\n    // selectively do this for nodeviews that opt-in via `hasReactContext`\r\n    PortalProviderAPI.prototype.forceUpdate = function () {\r\n        var _this = this;\r\n        this.portals.forEach(function (portal, container) {\r\n            if (!portal.hasReactContext) {\r\n                return;\r\n            }\r\n            var wrappedChildren = portal.children();\r\n            unstable_renderSubtreeIntoContainer(_this.context, wrappedChildren, container);\r\n        });\r\n    };\r\n    PortalProviderAPI.prototype.remove = function (container) {\r\n        this.portals.delete(container);\r\n        // There is a race condition that can happen caused by Prosemirror vs React,\r\n        // where Prosemirror removes the container from the DOM before React gets\r\n        // around to removing the child from the container\r\n        // This will throw a NotFoundError: The node to be removed is not a child of this node\r\n        // Both Prosemirror and React remove the elements asynchronously, and in edge\r\n        // cases Prosemirror beats React\r\n        try {\r\n            unmountComponentAtNode(container);\r\n        }\r\n        catch (error) {\r\n            console.warn('Race condition in PortalProviderAPI where PM removed DOM node before React unmounted it');\r\n        }\r\n    };\r\n    return PortalProviderAPI;\r\n}(EventDispatcher));\n\nvar PortalProvider = /** @class */ (function (_super) {\r\n    __extends(PortalProvider, _super);\r\n    function PortalProvider(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.portalProviderAPI = new PortalProviderAPI();\r\n        return _this;\r\n    }\r\n    PortalProvider.prototype.render = function () {\r\n        return this.props.render(this.portalProviderAPI);\r\n    };\r\n    PortalProvider.prototype.componentDidUpdate = function () {\r\n        this.portalProviderAPI.forceUpdate();\r\n    };\r\n    PortalProvider.displayName = 'PortalProvider';\r\n    return PortalProvider;\r\n}(React.Component));\n\nvar PortalRenderer = /** @class */ (function (_super) {\r\n    __extends(PortalRenderer, _super);\r\n    function PortalRenderer(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.handleUpdate = function (portals) { return _this.setState({ portals: portals }); };\r\n        props.portalProviderAPI.setContext(_this);\r\n        props.portalProviderAPI.on('update', _this.handleUpdate);\r\n        _this.state = { portals: new Map() };\r\n        return _this;\r\n    }\r\n    PortalRenderer.prototype.render = function () {\r\n        var portals = this.state.portals;\r\n        return (React.createElement(React.Fragment, null, Array.from(portals.entries()).map(function (_a) {\r\n            var container = _a[0], children = _a[1];\r\n            return createPortal(children, container);\r\n        })));\r\n    };\r\n    return PortalRenderer;\r\n}(React.Component));\n\nfunction isUndefined(x) {\r\n    return x === undefined;\r\n}\r\nvar ProviderFactory = /** @class */ (function () {\r\n    function ProviderFactory() {\r\n        this.providers = new Map();\r\n        this.subscribers = new Map();\r\n    }\r\n    ProviderFactory.create = function (providers) {\r\n        var providerFactory = new ProviderFactory();\r\n        var keys = Object.keys(providers);\r\n        keys.forEach(function (name) {\r\n            providerFactory.setProvider(name, providers[name]);\r\n        });\r\n        return providerFactory;\r\n    };\r\n    ProviderFactory.prototype.destroy = function () {\r\n        this.providers.clear();\r\n        this.subscribers.clear();\r\n    };\r\n    ProviderFactory.prototype.isEmpty = function () {\r\n        return !this.providers.size && !this.subscribers.size;\r\n    };\r\n    ProviderFactory.prototype.setProvider = function (name, provider) {\r\n        // Do not trigger notifyUpdate if provider is the same.\r\n        if (this.providers.get(name) === provider) {\r\n            return;\r\n        }\r\n        if (!isUndefined(provider)) {\r\n            this.providers.set(name, provider);\r\n        }\r\n        else {\r\n            this.providers.delete(name);\r\n        }\r\n        this.notifyUpdated(name, provider);\r\n    };\r\n    ProviderFactory.prototype.removeProvider = function (name) {\r\n        this.providers.delete(name);\r\n        this.notifyUpdated(name);\r\n    };\r\n    ProviderFactory.prototype.subscribe = function (name, handler) {\r\n        var handlers = this.subscribers.get(name) || [];\r\n        handlers.push(handler);\r\n        this.subscribers.set(name, handlers);\r\n        var provider = this.providers.get(name);\r\n        if (provider) {\r\n            handler(name, provider);\r\n        }\r\n    };\r\n    ProviderFactory.prototype.unsubscribe = function (name, handler) {\r\n        var handlers = this.subscribers.get(name);\r\n        if (!handlers) {\r\n            return;\r\n        }\r\n        var index = handlers.indexOf(handler);\r\n        if (index !== -1) {\r\n            handlers.splice(index, 1);\r\n        }\r\n        if (handlers.length === 0) {\r\n            this.subscribers.delete(name);\r\n        }\r\n        else {\r\n            this.subscribers.set(name, handlers);\r\n        }\r\n    };\r\n    ProviderFactory.prototype.unsubscribeAll = function (name) {\r\n        var handlers = this.subscribers.get(name);\r\n        if (!handlers) {\r\n            return;\r\n        }\r\n        this.subscribers.delete(name);\r\n    };\r\n    ProviderFactory.prototype.hasProvider = function (name) {\r\n        return this.providers.has(name);\r\n    };\r\n    ProviderFactory.prototype.notifyUpdated = function (name, provider) {\r\n        var handlers = this.subscribers.get(name);\r\n        if (!handlers) {\r\n            return;\r\n        }\r\n        handlers.forEach(function (handler) {\r\n            handler(name, provider);\r\n        });\r\n    };\r\n    return ProviderFactory;\r\n}());\n\n/*\r\n * From Modernizr\r\n * Returns the kind of transitionevent available for the element\r\n */\r\nfunction whichTransitionEvent() {\r\n    var el = document.createElement('fakeelement');\r\n    var transitions = {\r\n        transition: 'transitionend',\r\n        MozTransition: 'transitionend',\r\n        OTransition: 'oTransitionEnd',\r\n        WebkitTransition: 'webkitTransitionEnd',\r\n    };\r\n    for (var t in transitions) {\r\n        if (el.style[t] !== undefined) {\r\n            // Use a generic as the return type because TypeScript doesnt know\r\n            // about cross browser features, so we cast here to align to the\r\n            // standard Event spec and propagate the type properly to the callbacks\r\n            // of `addEventListener` and `removeEventListener`.\r\n            return transitions[t];\r\n        }\r\n    }\r\n    return;\r\n}\n\nvar PluginsComponentsWrapper = styled.div(templateObject_1$8 || (templateObject_1$8 = __makeTemplateObject([\"\\n  display: flex;\\n\"], [\"\\n  display: flex;\\n\"])));\r\nvar PluginSlot = /** @class */ (function (_super) {\r\n    __extends(PluginSlot, _super);\r\n    function PluginSlot() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.transitionEvent = whichTransitionEvent();\r\n        _this.forceComponentUpdate = function (event) {\r\n            // Only trigger an update if the transition is on a property containing `width`\r\n            // This will cater for media and the content area itself currently.\r\n            if (event.propertyName.includes('width')) {\r\n                _this.forceUpdate();\r\n            }\r\n        };\r\n        _this.removeModeChangeListener = function (contentAreaRef) {\r\n            if (contentAreaRef && _this.transitionEvent) {\r\n                contentAreaRef.removeEventListener(_this.transitionEvent, _this.forceComponentUpdate);\r\n            }\r\n        };\r\n        _this.addModeChangeListener = function (contentAreaRef) {\r\n            if (contentAreaRef && _this.transitionEvent) {\r\n                /**\r\n                 * Update the plugin components once the transition\r\n                 * to full width / default mode completes\r\n                 */\r\n                contentAreaRef.addEventListener(_this.transitionEvent, _this.forceComponentUpdate);\r\n            }\r\n        };\r\n        return _this;\r\n    }\r\n    PluginSlot.prototype.shouldComponentUpdate = function (nextProps) {\r\n        var _a = this.props, editorView = _a.editorView, editorActions = _a.editorActions, items = _a.items, providerFactory = _a.providerFactory, eventDispatcher = _a.eventDispatcher, popupsMountPoint = _a.popupsMountPoint, popupsBoundariesElement = _a.popupsBoundariesElement, popupsScrollableElement = _a.popupsScrollableElement, containerElement = _a.containerElement, disabled = _a.disabled;\r\n        return !(nextProps.editorView === editorView &&\r\n            nextProps.editorActions === editorActions &&\r\n            nextProps.items === items &&\r\n            nextProps.providerFactory === providerFactory &&\r\n            nextProps.eventDispatcher === eventDispatcher &&\r\n            nextProps.popupsMountPoint === popupsMountPoint &&\r\n            nextProps.popupsBoundariesElement === popupsBoundariesElement &&\r\n            nextProps.popupsScrollableElement === popupsScrollableElement &&\r\n            nextProps.containerElement === containerElement &&\r\n            nextProps.disabled === disabled);\r\n    };\r\n    PluginSlot.prototype.componentDidMount = function () {\r\n        this.addModeChangeListener(this.props.contentAreaRef);\r\n    };\r\n    PluginSlot.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {\r\n        if (this.props.contentAreaRef !== nextProps.contentAreaRef) {\r\n            this.removeModeChangeListener(this.props.contentAreaRef);\r\n            this.addModeChangeListener(nextProps.contentAreaRef);\r\n        }\r\n    };\r\n    PluginSlot.prototype.componentWillUnmount = function () {\r\n        this.removeModeChangeListener(this.props.contentAreaRef);\r\n    };\r\n    PluginSlot.prototype.render = function () {\r\n        var _a = this.props, items = _a.items, editorView = _a.editorView, editorActions = _a.editorActions, eventDispatcher = _a.eventDispatcher, providerFactory = _a.providerFactory, appearance = _a.appearance, popupsMountPoint = _a.popupsMountPoint, popupsBoundariesElement = _a.popupsBoundariesElement, popupsScrollableElement = _a.popupsScrollableElement, containerElement = _a.containerElement, disabled = _a.disabled;\r\n        if (!items || !editorView) {\r\n            return null;\r\n        }\r\n        return (React.createElement(PluginsComponentsWrapper, null, items.map(function (component, key) {\r\n            var props = { key: key };\r\n            var element = component({\r\n                editorView: editorView,\r\n                editorActions: editorActions,\r\n                eventDispatcher: eventDispatcher,\r\n                providerFactory: providerFactory,\r\n                appearance: appearance,\r\n                popupsMountPoint: popupsMountPoint || undefined,\r\n                popupsBoundariesElement: popupsBoundariesElement,\r\n                popupsScrollableElement: popupsScrollableElement,\r\n                containerElement: containerElement,\r\n                disabled: disabled,\r\n            });\r\n            return element && React.cloneElement(element, props);\r\n        })));\r\n    };\r\n    PluginSlot.displayName = 'PluginSlot';\r\n    return PluginSlot;\r\n}(React.Component));\r\nvar templateObject_1$8;\n\nfunction Toolbar(props) {\r\n    // Iterate over primaryToolbarComponents here\r\n    return (React.createElement(Container, null,\r\n        React.createElement(TopRow, null)));\r\n}\r\nvar Container = styled.div(templateObject_1$9 || (templateObject_1$9 = __makeTemplateObject([\"\\n  background: snow;\\n  border: 1px solid black;\\n  border-bottom: 0;\\n  padding: 10px;\\n  & > h2 {\\n    margin: 0 0 5px 0;\\n  }\\n\"], [\"\\n  background: snow;\\n  border: 1px solid black;\\n  border-bottom: 0;\\n  padding: 10px;\\n  & > h2 {\\n    margin: 0 0 5px 0;\\n  }\\n\"])));\r\nvar TopRow = styled.div(templateObject_2$5 || (templateObject_2$5 = __makeTemplateObject([\"\\n  display: flex;\\n\"], [\"\\n  display: flex;\\n\"])));\r\nvar templateObject_1$9, templateObject_2$5;\n\nfunction FullPage(props) {\r\n    var className = props.className, editorDOMElement = props.editorDOMElement;\r\n    var popupsRef = useRef(null);\r\n    var contentAreaRef = useRef(null);\r\n    return (React.createElement(Container$1, { className: className + \" popups-wrapper\" },\r\n        React.createElement(Popups, { className: \"popups\", ref: popupsRef }),\r\n        React.createElement(Toolbar, null),\r\n        React.createElement(ContentArea, { ref: contentAreaRef },\r\n            React.createElement(PluginSlot, { editorView: props.editorView, editorActions: props.editorActions, eventDispatcher: props.eventDispatcher, providerFactory: props.providerFactory, appearance: props.appearance, items: props.contentComponents, contentAreaRef: contentAreaRef.current, popupsMountPoint: popupsRef.current, \r\n                // popupsBoundariesElement={props.popupsBoundariesElement}\r\n                // popupsScrollableElement={props.popupsScrollableElement}\r\n                disabled: false, containerElement: null }),\r\n            editorDOMElement)));\r\n}\r\nvar Container$1 = styled.div(templateObject_1$a || (templateObject_1$a = __makeTemplateObject([\"\\n  position: relative;\\n\"], [\"\\n  position: relative;\\n\"])));\r\nvar Popups = styled.div(templateObject_2$6 || (templateObject_2$6 = __makeTemplateObject([\"\\n  z-index: 9999;\\n\"], [\"\\n  z-index: 9999;\\n\"])));\r\nvar ContentArea = styled.div(templateObject_3$5 || (templateObject_3$5 = __makeTemplateObject([\"\\n  border: 1px solid black;\\n  & > .ProseMirror {\\n    min-height: 140px;\\n    overflow-wrap: break-word;\\n    outline: none;\\n    padding: 10px;\\n    white-space: pre-wrap;\\n  }\\n\"], [\"\\n  border: 1px solid black;\\n  & > .ProseMirror {\\n    min-height: 140px;\\n    overflow-wrap: break-word;\\n    outline: none;\\n    padding: 10px;\\n    white-space: pre-wrap;\\n  }\\n\"])));\r\nvar templateObject_1$a, templateObject_2$6, templateObject_3$5;\n\nfunction quickInsertProviderFactory() {\r\n    return {\r\n        getItems: function () {\r\n            return new Promise(function (resolve) {\r\n                window.setTimeout(function () { return resolve(quickInsertItems); }, 1000);\r\n            });\r\n        },\r\n    };\r\n}\r\nvar quickInsertItems = [\r\n    {\r\n        title: 'Minimum width extension',\r\n        icon: function () { return React.createElement(DevIcon, { label: \"dev\" }); },\r\n        action: function (insert) {\r\n            return insert({\r\n                type: 'extension',\r\n                attrs: {\r\n                    extensionType: 'com.atlassian.confluence.macro.core',\r\n                    extensionKey: 'block-layout-eh',\r\n                    text: 'Minimum width block extension demo',\r\n                    parameters: {\r\n                        style: { minWidth: 400 },\r\n                    },\r\n                },\r\n            });\r\n        },\r\n    },\r\n    {\r\n        title: 'Lorem ipsum',\r\n        icon: function () { return React.createElement(DevIcon, { label: \"dev\" }); },\r\n        action: function (insert) {\r\n            return insert({\r\n                type: 'paragraph',\r\n                content: [],\r\n            }).insertText('Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean mi nisl, venenatis eget auctor vitae, venenatis quis lorem. Suspendisse maximus tortor vel dui tincidunt cursus. Vestibulum magna nibh, auctor non auctor id, finibus vitae orci. Nulla viverra ipsum et nunc fringilla ultricies. Pellentesque vitae felis molestie justo finibus accumsan. Suspendisse potenti. Nulla facilisi. Integer dignissim quis velit quis elementum. Sed sit amet varius ante. Duis vestibulum porta augue eu laoreet. Morbi id risus et augue sollicitudin aliquam. In et ligula dolor. Nam ac aliquet diam.');\r\n        },\r\n    },\r\n];\n\n// An interesting feature whose purpose I'm not completely sure what is\r\n// https://bitbucket.org/atlassian/atlassian-frontend-mirror/src/master/editor/editor-common/src/extensions/\r\n// extensionProvider: any\r\nvar components = {\r\n    'full-page': FullPage,\r\n};\r\nfunction Editor(props) {\r\n    var _a = props.appearance, appearance = _a === void 0 ? 'full-page' : _a, quickInsert = props.quickInsert;\r\n    var editorActions = useState(new EditorActions())[0];\r\n    var providerFactory = useState(new ProviderFactory())[0];\r\n    var quickInsertProvider = useState(Promise.resolve(quickInsertProviderFactory()))[0];\r\n    var Component = useMemo(function () { return components[appearance]; }, [appearance]);\r\n    useEffect(function () {\r\n        handleProviders();\r\n    }, []);\r\n    function handleProviders() {\r\n        if (quickInsertProvider) {\r\n            providerFactory.setProvider('quickInsertProvider', quickInsertProvider);\r\n        }\r\n    }\r\n    function onEditorCreated(instance) {\r\n        editorActions._privateRegisterEditor(instance.view, instance.eventDispatcher);\r\n    }\r\n    function onEditorDestroyed(_instance) {\r\n        editorActions._privateUnregisterEditor();\r\n    }\r\n    return (React.createElement(EditorContext, { editorActions: editorActions },\r\n        React.createElement(PortalProvider, { render: function (portalProviderAPI) { return (React.createElement(React.Fragment, null,\r\n                React.createElement(ReactEditorView, { editorProps: props, providerFactory: providerFactory, portalProviderAPI: portalProviderAPI, onEditorCreated: onEditorCreated, onEditorDestroyed: onEditorDestroyed, render: function (_a) {\r\n                        var editor = _a.editor, view = _a.view, eventDispatcher = _a.eventDispatcher, config = _a.config;\r\n                        return (React.createElement(Component, { appearance: appearance, editorActions: editorActions, editorDOMElement: editor, editorView: view, providerFactory: providerFactory, eventDispatcher: eventDispatcher, contentComponents: config.contentComponents, primaryToolbarComponents: config.primaryToolbarComponents }));\r\n                    } }),\r\n                React.createElement(PortalRenderer, { portalProviderAPI: portalProviderAPI }))); } })));\r\n}\n\nexport default Editor;\nexport { Editor };\n","import * as React from 'react'\nimport styled from 'styled-components'\n\nimport { Editor } from 'atlassian'\n\nimport { PageHeader } from '../components/PageHeader'\n\ninterface IProps {\n  className?: string\n}\n\nexport function AtlassianPage(props: IProps) {\n  const { className } = props\n  return (\n    <Container className={className}>\n      <PageHeader>\n        <Editor performanceTracking/>\n      </PageHeader>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n`\n","import * as React from 'react'\nimport { BrowserRouter, Redirect, Switch } from 'react-router-dom'\n\nimport { WrappedRoute } from './components/WrappedRoute'\n\nimport { FrontPage } from './pages/FrontPage'\nimport { MinimalPage } from './pages/MinimalPage'\nimport { AtlassianPage } from './pages/AtlassianPage'\n\nexport const Routes = () => (\n  <BrowserRouter basename={process.env.PUBLIC_URL}>\n    <Switch>\n      <WrappedRoute exact path=\"/\" component={FrontPage}/>\n      <WrappedRoute exact path=\"/minimal\" component={MinimalPage}/>\n      <WrappedRoute exact path=\"/atlassian\" component={AtlassianPage}/>\n      <Redirect to=\"/\" />\n    </Switch>\n  </BrowserRouter>\n)\n","import * as React from 'react'\nimport { render } from 'react-dom'\n\nimport { Routes } from './routes'\n\nrender(\n  <Routes />,\n  document.getElementById('root')\n)\n"],"sourceRoot":""}